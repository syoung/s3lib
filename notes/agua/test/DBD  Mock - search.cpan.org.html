<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- saved from url=(0079)http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#A_Word_of_Warning -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link rel="stylesheet" href="./DBD  Mock - search.cpan.org_files/style.css" type="text/css">
<style>
.styleswitch {
  text-align: right;
}
</style>


<script type="text/javascript" src="./DBD  Mock - search.cpan.org_files/jquery.min.js"></script>
<script type="text/javascript" src="./DBD  Mock - search.cpan.org_files/jquery.cookie.js"></script>
<script type="text/javascript" src="./DBD  Mock - search.cpan.org_files/sh_main.min.js"></script>
<script type="text/javascript" src="./DBD  Mock - search.cpan.org_files/sh_perl.min.js"></script>
<script type="text/javascript" src="./DBD  Mock - search.cpan.org_files/jquery.styleswitch.js"></script>

<link rel="stylesheet" href="./DBD  Mock - search.cpan.org_files/print.css" type="text/css" media="print">
  <link rel="alternate" type="application/rss+xml" title="RSS 1.0" href="http://search.cpan.org/uploads.rdf">
  <link rel="search" href="http://st.pimg.net/tucs/opensearch.xml" type="application/opensearchdescription+xml" title="SearchCPAN">
  <title>DBD::Mock - search.cpan.org</title>
 <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3528438-1']);
    _gaq.push(["_setCustomVar",2,"Distribution","DBD-Mock",3]);
    _gaq.push(["_setCustomVar",5,"Release","DBD-Mock-1.39",3]);
    _gaq.push(["_setCustomVar",3,"Module","DBD::Mock",3]);
    _gaq.push(["_setCustomVar",1,"Author","DROLSKY",3]);
    _gaq.push(['_trackPageview']);
  </script>
 <link rel="stylesheet" type="text/css" href="./DBD  Mock - search.cpan.org_files/sh_none.min.css" id="theme0.39136326243169606"></head>
 <body id="cpansearch">
<center><div class="logo"><a href="http://search.cpan.org/"><img src="./DBD  Mock - search.cpan.org_files/cpan_banner.png" alt="CPAN"></a></div></center>
<div class="menubar">
 <a href="http://search.cpan.org/">Home</a>
 <a href="http://search.cpan.org/author/">Authors</a>
 <a href="http://search.cpan.org/recent">Recent</a>
 <a href="http://log.perl.org/cpansearch/">News</a>
 <a href="http://search.cpan.org/mirror">Mirrors</a>
 <a href="http://search.cpan.org/faq.html">FAQ</a>
 <a href="http://search.cpan.org/feedback">Feedback</a>
</div>
<form method="get" action="http://search.cpan.org/search" name="f" class="searchbox">
<input type="text" name="query" value="" size="35">
<br>in <select name="mode">
 <option value="all">All</option>
 <option value="module">Modules</option>
 <option value="dist">Distributions</option>
 <option value="author">Authors</option>
</select>&nbsp;<input type="submit" value="CPAN Search">
</form>


 <a name="_top"></a>
  <div class="path">
<div id="permalink" class="noprint"><a href="http://search.cpan.org/perldoc?DBD::Mock">permalink</a></div>
  <a href="http://search.cpan.org/~drolsky/">Dave Rolsky</a> &gt;
  <a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/">DBD-Mock-1.39</a> &gt;
  DBD::Mock
 </div>

<div class="noprint" style="float:right;align:left;width:19ex">
<a href="http://hexten.net/cpan-faces/"><img src="./DBD  Mock - search.cpan.org_files/1401e7f176d9e13ad2a9380ecd1f18f6" width="80" height="80" style="float:right"></a>
<br style="clear:both">
<p style="text-align:right">Download:<br> <a href="http://search.cpan.org/CPAN/authors/id/D/DR/DROLSKY/DBD-Mock-1.39.tar.gz">DBD-Mock-1.39.tar.gz</a></p>
<p style="text-align:right"><a href="http://deps.cpantesters.org/?module=DBD%3A%3AMock;perl=latest">Dependencies</a></p>
<p style="text-align:right"><a href="http://www.annocpan.org/~DROLSKY/DBD-Mock-1.39/lib/DBD/Mock.pm">Annotate this POD
(1)
</a></p>

<div style="float:right">
<div class="box" style="width:150px">
<h1 class="t5">CPAN RT</h1>
<div style="margin:2px">
<table style="margin-left:auto;margin-right:auto">
<tbody><tr><td>New&nbsp;</td><td style="text-align:right"> 7</td></tr>
<tr><td>Open&nbsp;</td><td style="text-align:right"> 1</td></tr>
</tbody></table>
<a href="https://rt.cpan.org/Public/Dist/Display.html?Name=DBD-Mock">View/Report Bugs</a><br>
</div>
</div>

</div>
</div>
  Module Version:  1.39 &nbsp;
<span class="noprint">
  <a href="http://search.cpan.org/src/DROLSKY/DBD-Mock-1.39/lib/DBD/Mock.pm">Source</a> &nbsp;
</span>
<a name="___top"></a>
<div class="pod">
<div class="toc">
<div class="indexgroup">
<ul class="indexList indexList1">
  <li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#NAME">NAME</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#SYNOPSIS">SYNOPSIS</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#DESCRIPTION">DESCRIPTION</a>
  <ul class="indexList indexList2">
    <li class="indexItem indexItem2"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#How_does_it_work?">How does it work?</a>
    </li><li class="indexItem indexItem2"><a href="./DBD  Mock - search.cpan.org_files/DBD  Mock - search.cpan.org.html">A Word of Warning</a>
  </li></ul>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#DBD::Mock">DBD::Mock</a>
  <ul class="indexList indexList2">
    <li class="indexItem indexItem2"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#Database_Driver_Properties">Database Driver Properties</a>
    </li><li class="indexItem indexItem2"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#Database_Handle_Properties">Database Handle Properties</a>
    </li><li class="indexItem indexItem2"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#Database_Driver_Methods">Database Driver Methods</a>
    </li><li class="indexItem indexItem2"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#Statement_Handle_Properties">Statement Handle Properties</a>
  </li></ul>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#DBD::Mock::Pool">DBD::Mock::Pool</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#DBD::Mock::StatementTrack">DBD::Mock::StatementTrack</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#DBD::Mock::StatementTrack::Iterator">DBD::Mock::StatementTrack::Iterator</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#DBD::Mock::Session">DBD::Mock::Session</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#EXPERIMENTAL_FUNCTIONALITY">EXPERIMENTAL FUNCTIONALITY</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#BUGS">BUGS</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#TO_DO">TO DO</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#CODE_COVERAGE">CODE COVERAGE</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#SEE_ALSO">SEE ALSO</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#DISCUSSION_GROUP">DISCUSSION GROUP</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#COPYRIGHT">COPYRIGHT</a>
  </li><li class="indexItem indexItem1"><a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#AUTHORS">AUTHORS</a>
</li></ul>
</div>
</div>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="NAME">NAME <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>DBD::Mock - Mock database driver for testing</p>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="SYNOPSIS">SYNOPSIS <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<pre class="sh_perl sh_sourceCode"> <span class="sh_keyword">use</span> DBI<span class="sh_symbol">;</span>

 <span class="sh_comment"># connect to your as normal, using 'Mock' as your driver name</span>
 <span class="sh_keyword">my</span> <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span> <span class="sh_string">'DBI:Mock:'</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_string">''</span> <span class="sh_symbol">)</span>
               <span class="sh_symbol">||</span> <span class="sh_keyword">die</span> <span class="sh_string">"Cannot create handle: $DBI::errstr\n"</span><span class="sh_symbol">;</span>

 <span class="sh_comment"># create a statement handle as normal and execute with parameters</span>
 <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT this, that FROM foo WHERE id = ?'</span> <span class="sh_symbol">);</span>
 <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">(</span> <span class="sh_number">15</span> <span class="sh_symbol">);</span>

 <span class="sh_comment"># Now query the statement handle as to what has been done with it</span>
 <span class="sh_keyword">my</span> <span class="sh_variable">$mock_params</span> <span class="sh_symbol">=</span> <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_params<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
 <span class="sh_keyword">print</span> <span class="sh_string">"Used statement: "</span><span class="sh_symbol">,</span> <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_statement<span class="sh_cbracket">}</span><span class="sh_symbol">,</span> <span class="sh_string">"\n"</span><span class="sh_symbol">,</span>
       <span class="sh_string">"Bound parameters: "</span><span class="sh_symbol">,</span> <span class="sh_keyword">join</span><span class="sh_symbol">(</span> <span class="sh_string">', '</span><span class="sh_symbol">,</span> @<span class="sh_cbracket">{</span> <span class="sh_variable">$params</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">),</span> <span class="sh_string">"\n"</span><span class="sh_symbol">;</span></pre>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="DESCRIPTION">DESCRIPTION <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>Testing with databases can be tricky. If you are developing a system married to a single database then you can make some assumptions about your environment and ask the user to provide relevant connection information. But if you need to test a framework that uses DBI, particularly a framework that uses different types of persistence schemes, then it may be more useful to simply verify what the framework is trying to do -- ensure the right SQL is generated and that the correct parameters are bound. <code>DBD::Mock</code> makes it easy to just modify your configuration (presumably held outside your code) and just use it instead of <code>DBD::Foo</code> (like <a href="http://search.cpan.org/perldoc?DBD%3A%3APg" class="podlinkpod">DBD::Pg</a> or <a href="http://search.cpan.org/perldoc?DBD%3A%3Amysql" class="podlinkpod">DBD::mysql</a>) in your framework.</p>

<p>There is no distinct area where using this module makes sense. (Some people may successfully argue that this is a solution looking for a problem...) Indeed, if you can assume your users have something like <a href="http://search.cpan.org/perldoc?DBD%3A%3AAnyData" class="podlinkpod">DBD::AnyData</a> or <a href="http://search.cpan.org/perldoc?DBD%3A%3ASQLite" class="podlinkpod">DBD::SQLite</a> or if you do not mind creating a dependency on them then it makes far more sense to use these legitimate driver implementations and test your application in the real world -- at least as much of the real world as you can create in your tests...</p>

<p>And if your database handle exists as a package variable or something else easily replaced at test-time then it may make more sense to use <a href="http://search.cpan.org/perldoc?Test%3A%3AMockObject" class="podlinkpod">Test::MockObject</a> to create a fully dynamic handle. There is an excellent article by chromatic about using <a href="http://search.cpan.org/perldoc?Test%3A%3AMockObject" class="podlinkpod">Test::MockObject</a> in this and other ways, strongly recommended. (See <a href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#SEE_ALSO" class="podlinkpod">"SEE ALSO"</a> for a link)</p>

<h2><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="How_does_it_work?">How does it work?</a></h2>

<p><code>DBD::Mock</code> comprises a set of classes used by DBI to implement a database driver. But instead of connecting to a datasource and manipulating data found there it tracks all the calls made to the database handle and any created statement handles. You can then inspect them to ensure what you wanted to happen actually happened. For instance, say you have a configuration file with your database connection information:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_symbol">[</span>DBI<span class="sh_symbol">]</span>
  dsn      <span class="sh_symbol">=</span> DBI<span class="sh_symbol">:</span>Pg<span class="sh_symbol">:</span>dbname<span class="sh_symbol">=</span>myapp
  user     <span class="sh_symbol">=</span> foo
  password <span class="sh_symbol">=</span> bar</pre>

<p>And this file is read in at process startup and the handle stored for other procedures to use:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">package</span> ObjectDirectory<span class="sh_symbol">;</span>

  <span class="sh_keyword">my</span> <span class="sh_symbol">(</span> <span class="sh_variable">$DBH</span> <span class="sh_symbol">);</span>

  <span class="sh_keyword">sub</span> run_at_startup <span class="sh_cbracket">{</span>
     <span class="sh_keyword">my</span> <span class="sh_symbol">(</span> <span class="sh_variable">$class</span><span class="sh_symbol">,</span> <span class="sh_variable">$config</span> <span class="sh_symbol">)</span> <span class="sh_symbol">=</span> <span class="sh_variable">@_</span><span class="sh_symbol">;</span>
     <span class="sh_variable">$config</span> <span class="sh_symbol">||=</span> <span class="sh_function">read_configuration</span><span class="sh_symbol">(</span> <span class="sh_symbol">...</span> <span class="sh_symbol">);</span>
     <span class="sh_keyword">my</span> <span class="sh_variable">$dsn</span>  <span class="sh_symbol">=</span> <span class="sh_variable">$config</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>DBI<span class="sh_cbracket">}{</span>dsn<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
     <span class="sh_keyword">my</span> <span class="sh_variable">$user</span> <span class="sh_symbol">=</span> <span class="sh_variable">$config</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>DBI<span class="sh_cbracket">}{</span>user<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
     <span class="sh_keyword">my</span> <span class="sh_variable">$pass</span> <span class="sh_symbol">=</span> <span class="sh_variable">$config</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>DBI<span class="sh_cbracket">}{</span>password<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
     <span class="sh_variable">$DBH</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span> <span class="sh_variable">$dsn</span><span class="sh_symbol">,</span> <span class="sh_variable">$user</span><span class="sh_symbol">,</span> <span class="sh_variable">$pass</span> <span class="sh_symbol">)</span> <span class="sh_symbol">||</span> <span class="sh_keyword">die</span> <span class="sh_symbol">...;</span>
  <span class="sh_cbracket">}</span>

  <span class="sh_keyword">sub</span> get_database_handle <span class="sh_cbracket">{</span>
     <span class="sh_keyword">return</span> <span class="sh_variable">$DBH</span><span class="sh_symbol">;</span>
  <span class="sh_cbracket">}</span></pre>

<p>A procedure might use it like this (ignoring any error handling for the moment):</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">package</span> My<span class="sh_symbol">::</span>UserActions<span class="sh_symbol">;</span>

  <span class="sh_keyword">sub</span> fetch_user <span class="sh_cbracket">{</span>
     <span class="sh_keyword">my</span> <span class="sh_symbol">(</span> <span class="sh_variable">$class</span><span class="sh_symbol">,</span> <span class="sh_variable">$login</span> <span class="sh_symbol">)</span> <span class="sh_symbol">=</span> <span class="sh_variable">@_</span><span class="sh_symbol">;</span>
     <span class="sh_keyword">my</span> <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> ObjectDirectory<span class="sh_symbol">-&gt;</span>get_database_handle<span class="sh_symbol">;</span>
     <span class="sh_keyword">my</span> <span class="sh_variable">$sql</span> <span class="sh_symbol">=</span> <span class="sh_keyword">q</span><span class="sh_cbracket">{</span>
         SELECT login_name<span class="sh_symbol">,</span> first_name<span class="sh_symbol">,</span> last_name<span class="sh_symbol">,</span> creation_date<span class="sh_symbol">,</span> num_logins
           FROM users
          WHERE login_name <span class="sh_symbol">=</span> <span class="sh_symbol">?</span>
     <span class="sh_cbracket">}</span><span class="sh_symbol">;</span>
     <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_variable">$sql</span> <span class="sh_symbol">);</span>
     <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">(</span> <span class="sh_variable">$login</span> <span class="sh_symbol">);</span>
     <span class="sh_keyword">my</span> <span class="sh_variable">$row</span> <span class="sh_symbol">=</span> <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span>fetchrow_arrayref<span class="sh_symbol">;</span>
     <span class="sh_keyword">return</span> <span class="sh_symbol">(</span> <span class="sh_variable">$row</span> <span class="sh_symbol">)</span> <span class="sh_symbol">?</span> User<span class="sh_symbol">-&gt;</span><span class="sh_function">new</span><span class="sh_symbol">(</span> <span class="sh_variable">$row</span> <span class="sh_symbol">)</span> <span class="sh_symbol">:</span> <span class="sh_keyword">undef</span><span class="sh_symbol">;</span>
  <span class="sh_cbracket">}</span></pre>

<p>So for the purposes of our tests we just want to ensure that:</p>

<dl>
<dt><a name="1"></a><a name="1._The_right_SQL_is_being_executed">1. The right SQL is being executed</a></dt>

<dd>
</dd><dt><a name="2"></a><a name="2._The_right_parameters_are_bound">2. The right parameters are bound</a></dt>
</dl>

<p>Assume whether the SQL actually <b>works</b> or not is irrelevant for this test :-)</p>

<p>To do that our test might look like:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">my</span> <span class="sh_variable">$config</span> <span class="sh_symbol">=</span> ObjectDirectory<span class="sh_symbol">-&gt;</span><span class="sh_function">read_configuration</span><span class="sh_symbol">(</span> <span class="sh_symbol">...</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$config</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>DBI<span class="sh_cbracket">}{</span>dsn<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_string">'DBI:Mock:'</span><span class="sh_symbol">;</span>
  ObjectDirectory<span class="sh_symbol">-&gt;</span><span class="sh_function">run_at_startup</span><span class="sh_symbol">(</span> <span class="sh_variable">$config</span> <span class="sh_symbol">);</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$login_name</span> <span class="sh_symbol">=</span> <span class="sh_string">'foobar'</span><span class="sh_symbol">;</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$user</span> <span class="sh_symbol">=</span> My<span class="sh_symbol">::</span>UserActions<span class="sh_symbol">-&gt;</span><span class="sh_function">fetch_user</span><span class="sh_symbol">(</span> <span class="sh_variable">$login_name</span> <span class="sh_symbol">);</span>

  <span class="sh_comment"># Get the handle from ObjectDirectory;</span>
  <span class="sh_comment"># this is the same handle used in the</span>
  <span class="sh_comment"># 'fetch_user()' procedure above</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> ObjectDirectory<span class="sh_symbol">-&gt;</span><span class="sh_function">get_database_handle</span><span class="sh_symbol">();</span>

  <span class="sh_comment"># Ask the database handle for the history</span>
  <span class="sh_comment"># of all statements executed against it</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$history</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_all_history<span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># Now query that history record to</span>
  <span class="sh_comment"># see if our expectations match reality</span>
  <span class="sh_function">is</span><span class="sh_symbol">(</span><span class="sh_function">scalar</span><span class="sh_symbol">(</span>@<span class="sh_cbracket">{</span><span class="sh_variable">$history</span><span class="sh_cbracket">}</span><span class="sh_symbol">),</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_string">'Correct number of statements executed'</span> <span class="sh_symbol">;</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$login_st</span> <span class="sh_symbol">=</span> <span class="sh_variable">$history</span><span class="sh_symbol">-&gt;[</span><span class="sh_number">0</span><span class="sh_symbol">];</span>
  <span class="sh_function">like</span><span class="sh_symbol">(</span><span class="sh_variable">$login_st</span><span class="sh_symbol">-&gt;</span>statement<span class="sh_symbol">,</span>
      <span class="sh_keyword">qr</span><span class="sh_regexp">/SELECT login_name.*FROM users WHERE login_name = ?/</span>sm<span class="sh_symbol">,</span>
      <span class="sh_string">'Correct statement generated'</span> <span class="sh_symbol">);</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$params</span> <span class="sh_symbol">=</span> <span class="sh_variable">$login_st</span><span class="sh_symbol">-&gt;</span>bound_params<span class="sh_symbol">;</span>
  <span class="sh_function">is</span><span class="sh_symbol">(</span><span class="sh_function">scalar</span><span class="sh_symbol">(</span>@<span class="sh_cbracket">{</span><span class="sh_variable">$params</span><span class="sh_cbracket">}</span><span class="sh_symbol">),</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_string">'Correct number of parameters bound'</span><span class="sh_symbol">);</span>
  <span class="sh_function">is</span><span class="sh_symbol">(</span><span class="sh_variable">$params</span><span class="sh_symbol">-&gt;[</span><span class="sh_number">0</span><span class="sh_symbol">],</span> <span class="sh_variable">$login_name</span><span class="sh_symbol">,</span> <span class="sh_string">'Correct value for parameter 1'</span> <span class="sh_symbol">);</span>

  <span class="sh_comment"># Reset the handle for future operations</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_clear_history<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span></pre>

<p>The list of properties and what they return is listed below. But in an overall view:</p>

<ul>
<li>A database handle contains the history of all statements created against it. Other properties set for the handle (e.g., 'PrintError', 'RaiseError') are left alone and can be queried as normal, but they do not affect anything. (A future feature may track the sequence/history of these assignments but if there is no demand it probably will not get implemented.)</li>

<li>A statement handle contains the statement it was prepared with plus all bound parameters or parameters passed via <code>execute()</code>. It can also contain predefined results for the statement handle to 'fetch', track how many fetches were called and what its current record is.</li>
</ul>

<h2><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="A_Word_of_Warning">A Word of Warning</a></h2>

<p>This may be an incredibly naive implementation of a DBD. But it works for me ...</p>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="DBD::Mock">DBD::Mock <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>Since this is a normal DBI statement handle we need to expose our tracking information as properties (accessed like a hash) rather than methods.</p>

<h2><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="Database_Driver_Properties">Database Driver Properties</a></h2>

<dl>
<dt><a name="mock_connect_fail"><b>mock_connect_fail</b></a></dt>

<dd>
<p>This is a boolean property which when set to true (<code>1</code>) will not allow DBI to connect. This can be used to simulate a DSN error or authentication failure. This can then be set back to false (<code>0</code>) to resume normal DBI operations. Here is an example of how this works:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_comment"># install the DBD::Mock driver</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$drh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">install_driver</span><span class="sh_symbol">(</span><span class="sh_string">'Mock'</span><span class="sh_symbol">);</span>

  <span class="sh_variable">$drh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_connect_fail<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># this connection will fail</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span><span class="sh_string">'dbi:Mock:'</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">)</span> <span class="sh_symbol">||</span> <span class="sh_keyword">die</span> <span class="sh_string">"Cannot connect"</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># this connection will throw an exception</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span><span class="sh_string">'dbi:Mock:'</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> RaiseError <span class="sh_symbol">=&gt;</span> <span class="sh_number">1</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>

  <span class="sh_variable">$drh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_connect_fail<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># this will work now ...</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(...);</span></pre>

<p>This feature is conceptually different from the 'mock_can_connect' attribute of the <code>$dbh</code> in that it has a driver-wide scope, where 'mock_can_connect' is handle-wide scope. It also only prevents the initial connection, any <code>$dbh</code> handles created prior to setting 'mock_connect_fail' to true (<code>1</code>) will still go on working just fine.</p>

</dd><dt><a name="mock_data_sources"><b>mock_data_sources</b></a></dt>

<dd>
<p>This is an ARRAY reference which holds fake data sources which are returned by the Driver and Database Handle's <code>data_source()</code> method.</p>

</dd><dt><a name="mock_add_data_sources"><b>mock_add_data_sources</b></a></dt>

<dd>
<p>This takes a string and adds it to the 'mock_data_sources' attribute.</p>
</dd>
</dl>

<h2><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="Database_Handle_Properties">Database Handle Properties</a></h2>

<dl>
<dt><a name="mock_all_history"><b>mock_all_history</b></a></dt>

<dd>
<p>Returns an array reference with all history (a.k.a. <code>DBD::Mock::StatementTrack</code>) objects created against the database handle in the order they were created. Each history object can then report information about the SQL statement used to create it, the bound parameters, etc..</p>

</dd><dt><a name="mock_all_history_iterator"><b>mock_all_history_iterator</b></a></dt>

<dd>
<p>Returns a <code>DBD::Mock::StatementTrack::Iterator</code> object which will iterate through the current set of <code>DBD::Mock::StatementTrack</code> object in the history. See the <b>DBD::Mock::StatementTrack::Iterator</b> documentation below for more information.</p>

</dd><dt><a name="mock_clear_history"><b>mock_clear_history</b></a></dt>

<dd>
<p>If set to a true value all previous statement history operations will be erased. This <b>includes</b> the history of currently open handles, so if you do something like:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">my</span> <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> <span class="sh_function">get_handle</span><span class="sh_symbol">(</span> <span class="sh_symbol">...</span> <span class="sh_symbol">);</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_symbol">...</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_clear_history<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span>
  <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">(</span> <span class="sh_string">'Foo'</span> <span class="sh_symbol">);</span></pre>

<p>You will have no way to learn from the database handle that the statement parameter 'Foo' was bound.</p>

<p>This is useful mainly to ensure you can isolate the statement histories from each other. A typical sequence will look like:</p>

<pre class="sh_perl sh_sourceCode">    set handle to framework
    perform operations
    analyze mock database handle
    reset mock database handle history
    perform more operations
    analyze mock database handle
    reset mock database handle history
    <span class="sh_symbol">...</span></pre>

</dd><dt><a name="mock_can_connect"><b>mock_can_connect</b></a></dt>

<dd>
<p>This statement allows you to simulate a downed database connection. This is useful in testing how your application/tests will perform in the face of some kind of catastrophic event such as a network outage or database server failure. It is a simple boolean value which defaults to on, and can be set like this:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_comment"># turn the database off</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_can_connect<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># turn it back on again</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_can_connect<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">1</span><span class="sh_symbol">;</span></pre>

<p>The statement handle checks this value as well, so something like this will fail in the expected way:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span> <span class="sh_string">'DBI:Mock:'</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_string">''</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_can_connect<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># blows up!</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_keyword">eval</span> <span class="sh_cbracket">{</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT foo FROM bar'</span> <span class="sh_symbol">)</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>
  <span class="sh_keyword">if</span> <span class="sh_symbol">(</span> $@ <span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
     <span class="sh_comment"># Here, $DBI::errstr = 'No connection present'</span>
  <span class="sh_cbracket">}</span></pre>

<p>Turning off the database after a statement prepare will fail on the statement <code>execute()</code>, which is hopefully what you would expect:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span> <span class="sh_string">'DBI:Mock:'</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_string">''</span> <span class="sh_symbol">);</span>

  <span class="sh_comment"># ok!</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_keyword">eval</span> <span class="sh_cbracket">{</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT foo FROM bar'</span> <span class="sh_symbol">)</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_can_connect<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># blows up!</span>
  <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span>execute<span class="sh_symbol">;</span></pre>

<p>Similarly:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span> <span class="sh_string">'DBI:Mock:'</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_string">''</span> <span class="sh_symbol">);</span>

  <span class="sh_comment"># ok!</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_keyword">eval</span> <span class="sh_cbracket">{</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT foo FROM bar'</span> <span class="sh_symbol">)</span> <span class="sh_cbracket">}</span><span class="sh_symbol">);</span>

  <span class="sh_comment"># ok!</span>
  <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span>execute<span class="sh_symbol">;</span>

  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_can_connect<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># blows up!</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$row</span> <span class="sh_symbol">=</span> <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span>fetchrow_arrayref<span class="sh_symbol">;</span></pre>

<p>Note: The handle attribute <code>Active</code> and the handle method <code>ping</code> will behave according to the value of <code>mock_can_connect</code>. So if <code>mock_can_connect</code> were to be set to 0 (or off), then both <code>Active</code> and <code>ping</code> would return false values (or 0).</p>

</dd><dt><a name="mock_add_resultset"></a><a name="mock_add_resultset(_\@resultset_|_\%sql_and_resultset_)"><b>mock_add_resultset( \@resultset | \%sql_and_resultset )</b></a></dt>

<dd>
<p>This stocks the database handle with a record set, allowing you to seed data for your application to see if it works properly.. Each recordset is a simple arrayref of arrays with the first arrayref being the fieldnames used. Every time a statement handle is created it asks the database handle if it has any resultsets available and if so uses it.</p>

<p>Here is a sample usage, partially from the test suite:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">my</span> <span class="sh_variable">@user_results</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>
    <span class="sh_symbol">[</span> <span class="sh_string">'login'</span><span class="sh_symbol">,</span> <span class="sh_string">'first_name'</span><span class="sh_symbol">,</span> <span class="sh_string">'last_name'</span> <span class="sh_symbol">],</span>
    <span class="sh_symbol">[</span> <span class="sh_string">'cwinters'</span><span class="sh_symbol">,</span> <span class="sh_string">'Chris'</span><span class="sh_symbol">,</span> <span class="sh_string">'Winters'</span> <span class="sh_symbol">],</span>
    <span class="sh_symbol">[</span> <span class="sh_string">'bflay'</span><span class="sh_symbol">,</span> <span class="sh_string">'Bobby'</span><span class="sh_symbol">,</span> <span class="sh_string">'Flay'</span> <span class="sh_symbol">],</span>
    <span class="sh_symbol">[</span> <span class="sh_string">'alincoln'</span><span class="sh_symbol">,</span> <span class="sh_string">'Abe'</span><span class="sh_symbol">,</span> <span class="sh_string">'Lincoln'</span> <span class="sh_symbol">],</span>
  <span class="sh_symbol">);</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">@generic_results</span> <span class="sh_symbol">=</span> <span class="sh_symbol">(</span>
    <span class="sh_symbol">[</span> <span class="sh_string">'foo'</span><span class="sh_symbol">,</span> <span class="sh_string">'bar'</span> <span class="sh_symbol">],</span>
    <span class="sh_symbol">[</span> <span class="sh_string">'this_one'</span><span class="sh_symbol">,</span> <span class="sh_string">'that_one'</span> <span class="sh_symbol">],</span>
    <span class="sh_symbol">[</span> <span class="sh_string">'this_two'</span><span class="sh_symbol">,</span> <span class="sh_string">'that_two'</span> <span class="sh_symbol">],</span>
  <span class="sh_symbol">);</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$dbh</span> <span class="sh_symbol">=</span> DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span> <span class="sh_string">'DBI:Mock:'</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_string">''</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_resultset<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_symbol">\</span><span class="sh_variable">@user_results</span><span class="sh_symbol">;</span>    <span class="sh_comment"># add first resultset</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_resultset<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_symbol">\</span><span class="sh_variable">@generic_results</span><span class="sh_symbol">;</span> <span class="sh_comment"># add second resultset</span>
  <span class="sh_keyword">my</span> <span class="sh_symbol">(</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">);</span>
  <span class="sh_keyword">eval</span> <span class="sh_cbracket">{</span>
     <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT login, first_name, last_name FROM foo'</span> <span class="sh_symbol">);</span>
     <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">();</span>
  <span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># this will fetch rows from the first resultset...</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$row1</span> <span class="sh_symbol">=</span> <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span>fetchrow_arrayref<span class="sh_symbol">;</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$user1</span> <span class="sh_symbol">=</span> User<span class="sh_symbol">-&gt;</span><span class="sh_function">new</span><span class="sh_symbol">(</span> login <span class="sh_symbol">=&gt;</span> <span class="sh_variable">$row</span><span class="sh_symbol">-&gt;[</span><span class="sh_number">0</span><span class="sh_symbol">],</span>
                        first <span class="sh_symbol">=&gt;</span> <span class="sh_variable">$row</span><span class="sh_symbol">-&gt;[</span><span class="sh_number">1</span><span class="sh_symbol">],</span>
                        <span class="sh_keyword">last</span>  <span class="sh_symbol">=&gt;</span> <span class="sh_variable">$row</span><span class="sh_symbol">-&gt;[</span><span class="sh_number">2</span><span class="sh_symbol">]</span> <span class="sh_symbol">);</span>
  <span class="sh_function">is</span><span class="sh_symbol">(</span> <span class="sh_variable">$user1</span><span class="sh_symbol">-&gt;</span>full_name<span class="sh_symbol">,</span> <span class="sh_string">'Chris Winters'</span> <span class="sh_symbol">);</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$row2</span> <span class="sh_symbol">=</span> <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span>fetchrow_arrayref<span class="sh_symbol">;</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$user2</span> <span class="sh_symbol">=</span> User<span class="sh_symbol">-&gt;</span><span class="sh_function">new</span><span class="sh_symbol">(</span> login <span class="sh_symbol">=&gt;</span> <span class="sh_variable">$row</span><span class="sh_symbol">-&gt;[</span><span class="sh_number">0</span><span class="sh_symbol">],</span>
                        first <span class="sh_symbol">=&gt;</span> <span class="sh_variable">$row</span><span class="sh_symbol">-&gt;[</span><span class="sh_number">1</span><span class="sh_symbol">],</span>
                        <span class="sh_keyword">last</span>  <span class="sh_symbol">=&gt;</span> <span class="sh_variable">$row</span><span class="sh_symbol">-&gt;[</span><span class="sh_number">2</span><span class="sh_symbol">]</span> <span class="sh_symbol">);</span>
  <span class="sh_function">is</span><span class="sh_symbol">(</span> <span class="sh_variable">$user2</span><span class="sh_symbol">-&gt;</span>full_name<span class="sh_symbol">,</span> <span class="sh_string">'Bobby Flay'</span> <span class="sh_symbol">);</span>
  <span class="sh_symbol">...</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$sth_generic</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT foo, bar FROM baz'</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$sth_generic</span><span class="sh_symbol">-&gt;</span>execute<span class="sh_symbol">;</span>

  <span class="sh_comment"># this will fetch rows from the second resultset...</span>
  <span class="sh_keyword">my</span> <span class="sh_variable">$row</span> <span class="sh_symbol">=</span> <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span>fetchrow_arrayref<span class="sh_symbol">;</span></pre>

<p>You can also associate a resultset with a particular SQL statement instead of adding them in the order they will be fetched:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_resultset<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_cbracket">{</span>
     sql     <span class="sh_symbol">=&gt;</span> <span class="sh_string">'SELECT foo, bar FROM baz'</span><span class="sh_symbol">,</span>
     results <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[</span>
         <span class="sh_symbol">[</span> <span class="sh_string">'foo'</span><span class="sh_symbol">,</span> <span class="sh_string">'bar'</span> <span class="sh_symbol">],</span>
         <span class="sh_symbol">[</span> <span class="sh_string">'this_one'</span><span class="sh_symbol">,</span> <span class="sh_string">'that_one'</span> <span class="sh_symbol">],</span>
         <span class="sh_symbol">[</span> <span class="sh_string">'this_two'</span><span class="sh_symbol">,</span> <span class="sh_string">'that_two'</span> <span class="sh_symbol">],</span>
     <span class="sh_symbol">],</span>
  <span class="sh_cbracket">}</span><span class="sh_symbol">;</span></pre>

<p>This will return the given results when the statement 'SELECT foo, bar FROM baz' is prepared. Note that they will be returned <b>every time</b> the statement is prepared, not just the first. It should also be noted that if you want, for some reason, to change the result set bound to a particular SQL statement, all you need to do is add the result set again with the same SQL statement and DBD::Mock will overwrite it.</p>

<p>It should also be noted that the <code>rows</code> method will return the number of records stocked in the result set. So if your code/application makes use of the <code>$sth-&gt;rows</code> method for things like UPDATE and DELETE calls you should stock the result set like so:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_resultset<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_cbracket">{</span>
     sql     <span class="sh_symbol">=&gt;</span> <span class="sh_string">'UPDATE foo SET baz = 1, bar = 2'</span><span class="sh_symbol">,</span>
     <span class="sh_comment"># this will appear to have updated 3 rows</span>
     results <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[[</span> <span class="sh_string">'rows'</span> <span class="sh_symbol">],</span> <span class="sh_symbol">[],</span> <span class="sh_symbol">[],</span> <span class="sh_symbol">[]],</span>
  <span class="sh_cbracket">}</span><span class="sh_symbol">;</span>

  <span class="sh_comment"># or ...</span>

  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_resultset<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_cbracket">{</span>
     sql     <span class="sh_symbol">=&gt;</span> <span class="sh_string">'DELETE FROM foo WHERE bar = 2'</span><span class="sh_symbol">,</span>
     <span class="sh_comment"># this will appear to have deleted 1 row</span>
     results <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[[</span> <span class="sh_string">'rows'</span> <span class="sh_symbol">],</span> <span class="sh_symbol">[]],</span>
  <span class="sh_cbracket">}</span><span class="sh_symbol">;</span></pre>

<p>Now I admit this is not the most elegant way to go about this, but it works for me for now, and until I can come up with a better method, or someone sends me a patch ;) it will do for now.</p>

<p>If you want a given statement to fail, you will have to use the hashref method and add a 'failure' key. That key can be handed an arrayref with the error number and error string, in that order. It can also be handed a hashref with two keys - errornum and errorstring. If the 'failure' key has no useful value associated with it, the errornum will be '1' and the errorstring will be 'Unknown error'.</p>

</dd><dt><a name="mock_get_info"><b>mock_get_info</b></a></dt>

<dd>
<p>This attribute can be used to set up values for get_info(). It takes a hashref of attribute_name/value pairs. See <a href="http://search.cpan.org/perldoc?DBI" class="podlinkpod">DBI</a> for more information on the information types and their meaning.</p>

</dd><dt><a name="mock_session"><b>mock_session</b></a></dt>

<dd>
<p>This attribute can be used to set a current DBD::Mock::Session object. For more information on this, see the <a href="http://search.cpan.org/perldoc?DBD%3A%3AMock%3A%3ASession" class="podlinkpod">DBD::Mock::Session</a> docs below. This attribute can also be used to remove the current session from the <code>$dbh</code> simply by setting it to <code>undef</code>.</p>

</dd><dt><a name="mock_last_insert_id"><b>mock_last_insert_id</b></a></dt>

<dd>
<p>This attribute is incremented each time an INSERT statement is passed to <code>prepare</code> on a per-handle basis. It's starting value can be set with the 'mock_start_insert_id' attribute (see below).</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_start_insert_id<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_number">10</span><span class="sh_symbol">;</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span><span class="sh_string">'INSERT INTO Foo (foo, bar) VALUES(?, ?)'</span><span class="sh_symbol">);</span>

  <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">2</span><span class="sh_symbol">);</span>
  <span class="sh_comment"># $dbh-&gt;{mock_last_insert_id} == 10</span>

  <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">(</span><span class="sh_number">3</span><span class="sh_symbol">,</span> <span class="sh_number">4</span><span class="sh_symbol">);</span>
  <span class="sh_comment"># $dbh-&gt;{mock_last_insert_id} == 11</span></pre>

<p>For more examples, please refer to the test file <em>t/025_mock_last_insert_id.t</em>.</p>

</dd><dt><a name="mock_start_insert_id"><b>mock_start_insert_id</b></a></dt>

<dd>
<p>This attribute can be used to set a start value for the 'mock_last_insert_id' attribute. It can also be used to effectively reset the 'mock_last_insert_id' attribute as well.</p>

<p>This attribute also can be used with an ARRAY ref parameter, it's behavior is slightly different in that instead of incrementing the value for every <code>prepare</code> it will only increment for each <code>execute</code>. This allows it to be used over multiple <code>execute</code> calls in a single <code>$sth</code>. It's usage looks like this:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_start_insert_id<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_symbol">[</span> <span class="sh_string">'Foo'</span><span class="sh_symbol">,</span> <span class="sh_number">10</span> <span class="sh_symbol">];</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_start_insert_id<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_symbol">[</span> <span class="sh_string">'Baz'</span><span class="sh_symbol">,</span> <span class="sh_number">20</span> <span class="sh_symbol">];</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$sth1</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span><span class="sh_string">'INSERT INTO Foo (foo, bar) VALUES(?, ?)'</span><span class="sh_symbol">);</span>

  <span class="sh_keyword">my</span> <span class="sh_variable">$sth2</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span><span class="sh_string">'INSERT INTO Baz (baz, buz) VALUES(?, ?)'</span><span class="sh_symbol">);</span>

  <span class="sh_variable">$sth1</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">(</span><span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">2</span><span class="sh_symbol">);</span>
  <span class="sh_comment"># $dbh-&gt;{mock_last_insert_id} == 10</span>

  <span class="sh_variable">$sth2</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">(</span><span class="sh_number">3</span><span class="sh_symbol">,</span> <span class="sh_number">4</span><span class="sh_symbol">);</span>
  <span class="sh_comment"># $dbh-&gt;{mock_last_insert_id} == 20</span></pre>

<p>Note that DBD::Mock's matching of table names in 'INSERT' statements is fairly simple, so if your table names are quoted in the insert statement (<code>INSERT INTO "Foo"</code>) then you need to quote the name for <code>mock_start_insert_id</code>:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_start_insert_id<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_symbol">[</span> <span class="sh_keyword">q</span><span class="sh_string">{"Foo"}</span><span class="sh_symbol">,</span> <span class="sh_number">10</span> <span class="sh_symbol">];</span></pre>

</dd><dt><a name="mock_add_parser"><b>mock_add_parser</b></a></dt>

<dd>
<p>DBI provides some simple parsing capabilities for 'SELECT' statements to ensure that placeholders are bound properly. And typically you may simply want to check after the fact that a statement is syntactically correct, or at least what you expect.</p>

<p>But other times you may want to parse the statement as it is prepared rather than after the fact. There is a hook in this mock database driver for you to provide your own parsing routine or object.</p>

<p>The syntax is simple:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_parser<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_keyword">sub</span> <span class="sh_cbracket">{</span>
     <span class="sh_keyword">my</span> <span class="sh_symbol">(</span> <span class="sh_variable">$sql</span> <span class="sh_symbol">)</span> <span class="sh_symbol">=</span> <span class="sh_variable">@_</span><span class="sh_symbol">;</span>
     <span class="sh_keyword">unless</span> <span class="sh_symbol">(</span> <span class="sh_variable">$sql</span> <span class="sh_symbol">=~</span> <span class="sh_string">/some regex/</span> <span class="sh_symbol">)</span> <span class="sh_cbracket">{</span>
         <span class="sh_keyword">die</span> <span class="sh_string">"does not contain secret fieldname"</span><span class="sh_symbol">;</span>
     <span class="sh_cbracket">}</span>
  <span class="sh_cbracket">}</span><span class="sh_symbol">;</span></pre>

<p>You can also add more than one for a handle. They will be called in order, and the first one to fail will halt the parsing process:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_parser<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_symbol">\&amp;</span>parse_update_sql<span class="sh_symbol">;</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add<span class="sh_symbol">-</span>parser<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_symbol">\&amp;</span>parse_insert_sql<span class="sh_symbol">;</span></pre>

<p>Depending on the 'PrintError' and 'RaiseError' settings in the database handle any parsing errors encountered will issue a <code>warn</code> or <code>die</code>. No matter what the statement handle will be <code>undef</code>.</p>

<p>Instead of providing a subroutine reference you can use an object. The only requirement is that it implements the method <code>parse()</code> and takes a SQL statement as the only argument. So you should be able to do something like the following (untested):</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">my</span> <span class="sh_variable">$parser</span> <span class="sh_symbol">=</span> SQL<span class="sh_symbol">::</span>Parser<span class="sh_symbol">-&gt;</span><span class="sh_function">new</span><span class="sh_symbol">(</span> <span class="sh_string">'mysql'</span><span class="sh_symbol">,</span> <span class="sh_cbracket">{</span> RaiseError <span class="sh_symbol">=&gt;</span> <span class="sh_number">1</span> <span class="sh_cbracket">}</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_parser<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_variable">$parser</span><span class="sh_symbol">;</span></pre>

</dd><dt><a name="mock_data_sources"></a><a name="mock_data_sources_&amp;_mock_add_data_sources"><b>mock_data_sources</b> &amp; <b>mock_add_data_sources</b></a></dt>

<dd>
<p>These properties will dispatch to the Driver's properties of the same name.</p>
</dd>
</dl>

<h2><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="Database_Driver_Methods">Database Driver Methods</a></h2>

<dl>
<dt><a name="last_insert_id"><b>last_insert_id</b></a></dt>

<dd>
<p>This returns the value of <code>mock_last_insert_id</code>.</p>
</dd>
</dl>

<p>In order to capture begin_work(), commit(), and rollback(), DBD::Mock will create statements for them, as if you had issued them in the appropriate SQL command line program. They will go through the standard prepare()-execute() cycle, meaning that any custom SQL parsers will be triggered and DBD::Mock::Session will need to know about these statements.</p>

<dl>
<dt><a name="begin_work"><b>begin_work</b></a></dt>

<dd>
<p>This will create a statement with SQL of "BEGIN WORK" and no parameters.</p>

</dd><dt><a name="commit"><b>commit</b></a></dt>

<dd>
<p>This will create a statement with SQL of "COMMIT" and no parameters.</p>

</dd><dt><a name="rollback"><b>rollback</b></a></dt>

<dd>
<p>This will create a statement with SQL of "ROLLBACK" and no parameters.</p>
</dd>
</dl>

<h2><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="Statement_Handle_Properties">Statement Handle Properties</a></h2>

<dl>
<dt><a name="Active"><b>Active</b></a></dt>

<dd>
<p>Returns true if the handle is a 'SELECT' and has more records to fetch, false otherwise. (From the DBI.)</p>

</dd><dt><a name="mock_statement"><b>mock_statement</b></a></dt>

<dd>
<p>The SQL statement this statement handle was <code>prepare</code>d with. So if the handle were created with:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT * FROM foo'</span> <span class="sh_symbol">);</span></pre>

<p>This would return:</p>

<pre class="sh_perl sh_sourceCode">  SELECT <span class="sh_symbol">*</span> FROM foo</pre>

<p>The original statement is unmodified so if you are checking against it in tests you may want to use a regex rather than a straight equality check. (However if you use a phrasebook to store your SQL externally you are a step ahead...)</p>

</dd><dt><a name="mock_fields"><b>mock_fields</b></a></dt>

<dd>
<p>Fields used by the statement. As said elsewhere we do no analysis or parsing to find these, you need to define them beforehand. That said, you do not actually need this very often.</p>

<p>Note that this returns the same thing as the normal statement property 'FIELD'.</p>

</dd><dt><a name="mock_params"><b>mock_params</b></a></dt>

<dd>
<p>Returns an arrayref of parameters bound to this statement in the order specified by the bind type. For instance, if you created and stocked a handle with:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT * FROM foo WHERE id = ? AND is_active = ?'</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">bind_param</span><span class="sh_symbol">(</span> <span class="sh_number">2</span><span class="sh_symbol">,</span> <span class="sh_string">'yes'</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">bind_param</span><span class="sh_symbol">(</span> <span class="sh_number">1</span><span class="sh_symbol">,</span> <span class="sh_number">7783</span> <span class="sh_symbol">);</span></pre>

<p>This would return:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_symbol">[</span> <span class="sh_number">7738</span><span class="sh_symbol">,</span> <span class="sh_string">'yes'</span> <span class="sh_symbol">]</span></pre>

<p>The same result will occur if you pass the parameters via <code>execute()</code> instead:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">my</span> <span class="sh_variable">$sth</span> <span class="sh_symbol">=</span> <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_function">prepare</span><span class="sh_symbol">(</span> <span class="sh_string">'SELECT * FROM foo WHERE id = ? AND is_active = ?'</span> <span class="sh_symbol">);</span>
  <span class="sh_variable">$sth</span><span class="sh_symbol">-&gt;</span><span class="sh_function">execute</span><span class="sh_symbol">(</span> <span class="sh_number">7783</span><span class="sh_symbol">,</span> <span class="sh_string">'yes'</span> <span class="sh_symbol">);</span></pre>

</dd><dt><a name="mock_records"><b>mock_records</b></a></dt>

<dd>
<p>An arrayref of arrayrefs representing the records the mock statement was stocked with.</p>

</dd><dt><a name="mock_num_records"><b>mock_num_records</b></a></dt>

<dd>
<p>Number of records the mock statement was stocked with; if never stocked it is still 0. (Some weirdos might expect undef...)</p>

</dd><dt><a name="mock_num_rows"><b>mock_num_rows</b></a></dt>

<dd>
<p>This returns the same value as <i>mock_num_records</i>. And is what is returned by the <code>rows</code> method of the statement handle.</p>

</dd><dt><a name="mock_current_record_num"><b>mock_current_record_num</b></a></dt>

<dd>
<p>Current record the statement is on; returns 0 in the instances when you have not yet called <code>execute()</code> and if you have not yet called a <code>fetch</code> method after the execute.</p>

</dd><dt><a name="mock_is_executed"><b>mock_is_executed</b></a></dt>

<dd>
<p>Whether <code>execute()</code> has been called against the statement handle. Returns 'yes' if so, 'no' if not.</p>

</dd><dt><a name="mock_is_finished"><b>mock_is_finished</b></a></dt>

<dd>
<p>Whether <code>finish()</code> has been called against the statement handle. Returns 'yes' if so, 'no' if not.</p>

</dd><dt><a name="mock_is_depleted"><b>mock_is_depleted</b></a></dt>

<dd>
<p>Returns 'yes' if all the records in the recordset have been returned. If no <code>fetch()</code> was executed against the statement, or If no return data was set this will return 'no'.</p>

</dd><dt><a name="mock_my_history"><b>mock_my_history</b></a></dt>

<dd>
<p>Returns a <code>DBD::Mock::StatementTrack</code> object which tracks the actions performed by this statement handle. Most of the actions are separately available from the properties listed above, so you should never need this.</p>
</dd>
</dl>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="DBD::Mock::Pool">DBD::Mock::Pool <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>This module can be used to emulate Apache::DBI style DBI connection pooling. Just as with Apache::DBI, you must enable DBD::Mock::Pool before loading DBI.</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">use</span> DBD<span class="sh_symbol">::</span>Mock <span class="sh_keyword">qw</span><span class="sh_symbol">(</span>Pool<span class="sh_symbol">);</span>
  <span class="sh_comment"># followed by ...</span>
  <span class="sh_keyword">use</span> DBI<span class="sh_symbol">;</span></pre>

<p>While this may not seem to make a lot of sense in a single-process testing scenario, it can be useful when testing code which assumes a multi-process Apache::DBI pooled environment.</p>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="DBD::Mock::StatementTrack">DBD::Mock::StatementTrack <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>Under the hood this module does most of the work with a <code>DBD::Mock::StatementTrack</code> object. This is most useful when you are reviewing multiple statements at a time, otherwise you might want to use the <code>mock_*</code> statement handle attributes instead.</p>

<dl>
<dt><a name="new"></a><a name="new(_%params_)"><b>new( %params )</b></a></dt>

<dd>
<p>Takes the following parameters:</p>

<ul>
<li><b>return_data</b>: Arrayref of return data records</li>

<li><b>fields</b>: Arrayref of field names</li>

<li><b>bound_params</b>: Arrayref of bound parameters</li>
</ul>

</dd><dt><a name="statement"></a><a name="statement_(Statement_attribute_&#39;mock_statement&#39;)"><b>statement</b> (Statement attribute 'mock_statement')</a></dt>

<dd>
<p>Gets/sets the SQL statement used.</p>

</dd><dt><a name="fields"></a><a name="fields_(Statement_attribute_&#39;mock_fields&#39;)"><b>fields</b> (Statement attribute 'mock_fields')</a></dt>

<dd>
<p>Gets/sets the fields to use for this statement.</p>

</dd><dt><a name="bound_params"></a><a name="bound_params_(Statement_attribute_&#39;mock_params&#39;)"><b>bound_params</b> (Statement attribute 'mock_params')</a></dt>

<dd>
<p>Gets/set the bound parameters to use for this statement.</p>

</dd><dt><a name="return_data"></a><a name="return_data_(Statement_attribute_&#39;mock_records&#39;)"><b>return_data</b> (Statement attribute 'mock_records')</a></dt>

<dd>
<p>Gets/sets the data to return when asked (that is, when someone calls 'fetch' on the statement handle).</p>

</dd><dt><a name="current_record_num"></a><a name="current_record_num_(Statement_attribute_&#39;mock_current_record_num&#39;)"><b>current_record_num</b> (Statement attribute 'mock_current_record_num')</a></dt>

<dd>
<p>Gets/sets the current record number.</p>

</dd><dt><a name="is_active"></a><a name="is_active()_(Statement_attribute_&#39;Active&#39;)"><b>is_active()</b> (Statement attribute 'Active')</a></dt>

<dd>
<p>Returns true if the statement is a SELECT and has more records to fetch, false otherwise. (This is from the DBI, see the 'Active' docs under 'ATTRIBUTES COMMON TO ALL HANDLES'.)</p>

</dd><dt><a name="is_executed"></a><a name="is_executed(_$yes_or_no_)_(Statement_attribute_&#39;mock_is_executed&#39;)"><b>is_executed( $yes_or_no )</b> (Statement attribute 'mock_is_executed')</a></dt>

<dd>
<p>Sets the state of the tracker 'executed' flag.</p>

</dd><dt><a name="is_finished"></a><a name="is_finished(_$yes_or_no_)_(Statement_attribute_&#39;mock_is_finished&#39;)"><b>is_finished( $yes_or_no )</b> (Statement attribute 'mock_is_finished')</a></dt>

<dd>
<p>If set to 'yes' tells the tracker that the statement is finished. This resets the current record number to '0' and clears out the array ref of returned records.</p>

</dd><dt><a name="is_depleted"></a><a name="is_depleted()_(Statement_attribute_&#39;mock_is_depleted&#39;)"><b>is_depleted()</b> (Statement attribute 'mock_is_depleted')</a></dt>

<dd>
<p>Returns true if the current record number is greater than the number of records set to return.</p>

</dd><dt><a name="num_fields"><b>num_fields</b></a></dt>

<dd>
<p>Returns the number of fields set in the 'fields' parameter.</p>

</dd><dt><a name="num_rows"><b>num_rows</b></a></dt>

<dd>
<p>Returns the number of records in the current result set.</p>

</dd><dt><a name="num_params"><b>num_params</b></a></dt>

<dd>
<p>Returns the number of parameters set in the 'bound_params' parameter.</p>

</dd><dt><a name="bound_param"></a><a name="bound_param(_$param_num,_$value_)"><b>bound_param( $param_num, $value )</b></a></dt>

<dd>
<p>Sets bound parameter <code>$param_num</code> to <code>$value</code>. Returns the arrayref of currently-set bound parameters. This corresponds to the 'bind_param' statement handle call.</p>

</dd><dt><a name="bound_param_trailing"></a><a name="bound_param_trailing(_@params_)"><b>bound_param_trailing( @params )</b></a></dt>

<dd>
<p>Pushes <code>@params</code> onto the list of already-set bound parameters.</p>

</dd><dt><a name="mark_executed"></a><a name="mark_executed()"><b>mark_executed()</b></a></dt>

<dd>
<p>Tells the tracker that the statement has been executed and resets the current record number to '0'.</p>

</dd><dt><a name="next_record"></a><a name="next_record()"><b>next_record()</b></a></dt>

<dd>
<p>If the statement has been depleted (all records returned) returns undef; otherwise it gets the current recordfor returning, increments the current record number and returns the current record.</p>

</dd><dt><a name="to_string"></a><a name="to_string()"><b>to_string()</b></a></dt>

<dd>
<p>Tries to give an decent depiction of the object state for use in debugging.</p>
</dd>
</dl>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="DBD::Mock::StatementTrack::Iterator">DBD::Mock::StatementTrack::Iterator <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>This object can be used to iterate through the current set of <code>DBD::Mock::StatementTrack</code> objects in the history by fetching the 'mock_all_history_iterator' attribute from a database handle. This object is very simple and is meant to be a convience to make writing long test script easier. Aside from the constructor (<code>new</code>) this object has only one method.</p>

<blockquote>
<p><b>next</b></p>

<p>Calling <code>next</code> will return the next <code>DBD::Mock::StatementTrack</code> object in the history. If there are no more <code>DBD::Mock::StatementTrack</code> objects available, then this method will return false.</p>

<p><b>reset</b></p>

<p>This will reset the internal pointer to the begining of the statement history.</p>
</blockquote>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="DBD::Mock::Session">DBD::Mock::Session <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>The DBD::Mock::Session object is an alternate means of specifying the SQL statements and result sets for DBD::Mock. The idea is that you can specify a complete 'session' of usage, which will be verified through DBD::Mock. Here is an example:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_keyword">my</span> <span class="sh_variable">$session</span> <span class="sh_symbol">=</span> DBD<span class="sh_symbol">::</span>Mock<span class="sh_symbol">::</span>Session<span class="sh_symbol">-&gt;</span><span class="sh_function">new</span><span class="sh_symbol">(</span><span class="sh_string">'my_session'</span> <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">(</span>
        <span class="sh_cbracket">{</span>
            statement <span class="sh_symbol">=&gt;</span> <span class="sh_string">"SELECT foo FROM bar"</span><span class="sh_symbol">,</span> <span class="sh_comment"># as a string</span>
            results   <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[[</span> <span class="sh_string">'foo'</span> <span class="sh_symbol">],</span> <span class="sh_symbol">[</span> <span class="sh_string">'baz'</span> <span class="sh_symbol">]]</span>
        <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
        <span class="sh_cbracket">{</span>
            statement <span class="sh_symbol">=&gt;</span> <span class="sh_keyword">qr</span><span class="sh_regexp">/UPDATE bar SET foo \= \'bar\'/</span><span class="sh_symbol">,</span> <span class="sh_comment"># as a reg-exp</span>
            results   <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[[]]</span>
        <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
        <span class="sh_cbracket">{</span>
            statement <span class="sh_symbol">=&gt;</span> <span class="sh_keyword">sub</span> <span class="sh_cbracket">{</span>  <span class="sh_comment"># as a CODE ref</span>
                    <span class="sh_keyword">my</span> <span class="sh_symbol">(</span><span class="sh_variable">$SQL</span><span class="sh_symbol">,</span> <span class="sh_variable">$state</span><span class="sh_symbol">)</span> <span class="sh_symbol">=</span> <span class="sh_variable">@_</span><span class="sh_symbol">;</span>
                    <span class="sh_keyword">return</span> <span class="sh_variable">$SQL</span> <span class="sh_keyword">eq</span> <span class="sh_string">"SELECT foo FROM bar"</span><span class="sh_symbol">;</span>
                    <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
            results   <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[[</span> <span class="sh_string">'foo'</span> <span class="sh_symbol">],</span> <span class="sh_symbol">[</span> <span class="sh_string">'bar'</span> <span class="sh_symbol">]]</span>
        <span class="sh_cbracket">}</span><span class="sh_symbol">,</span>
        <span class="sh_cbracket">{</span>
            <span class="sh_comment"># with bound parameters</span>
            statement    <span class="sh_symbol">=&gt;</span> <span class="sh_string">"SELECT foo FROM bar WHERE baz = ? AND borg = ?"</span><span class="sh_symbol">,</span>
            <span class="sh_comment"># check exact bound param value,</span>
            <span class="sh_comment"># then check it against regexp</span>
            bound_params <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[</span> <span class="sh_number">10</span><span class="sh_symbol">,</span> <span class="sh_keyword">qr</span><span class="sh_regexp">/\d+/</span> <span class="sh_symbol">],</span>
            results      <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[[</span> <span class="sh_string">'foo'</span> <span class="sh_symbol">],</span> <span class="sh_symbol">[</span> <span class="sh_string">'baz'</span> <span class="sh_symbol">]]</span>
        <span class="sh_cbracket">}</span>
  <span class="sh_symbol">));</span></pre>

<p>As you can see, a session is essentially made up a list of HASH references we call 'states'. Each state has a 'statement' and a set of 'results'. If DBD::Mock finds a session in the 'mock_session' attribute, then it will pass the current <code>$dbh</code> and SQL statement to that DBD::Mock::Session. The SQL statement will be checked against the 'statement' field in the current state. If it passes, then the 'results' of the current state will get feed to DBD::Mock through the 'mock_add_resultset' attribute. We then advance to the next state in the session, and wait for the next call through DBD::Mock. If at any time the SQL statement does not match the current state's 'statement', or the session runs out of available states, an error will be raised (and propagated through the normal DBI error handling based on your values for RaiseError and PrintError).</p>

<p>Also, as can be seen in the the session element, bound parameters can also be supplied and tested. In this statement, the SQL is compared, then when the statement is executed, the bound parameters are also checked. The bound parameters much match in both number of parameters and the parameters themselves, or an error will be raised.</p>

<p>As can also be seen in the example above, 'statement' fields can come in many forms. The simplest is a string, which will be compared using <code>eq</code> against the currently running statement. The next is a reg-exp reference, this too will get compared against the currently running statement. The last option is a CODE ref, this is sort of a catch-all to allow for a wide range of SQL comparison approaches (including using modules like SQL::Statement or SQL::Parser for detailed functional comparisons). The first argument to the CODE ref will be the currently active SQL statement to compare against, the second argument is a reference to the current state HASH (in case you need to alter the results, or store extra information). The CODE is evaluated in boolean context and throws and exception if it is false.</p>

<blockquote>
<p><b>new ($session_name, @session_states)</b></p>

<p>A <code>$session_name</code> can be optionally be specified, along with at least one <code>@session_states</code>. If you don't specify a <code>$session_name</code>, then a default one will be created for you. The <code>@session_states</code> must all be HASH references as well, if this conditions fail, an exception will be thrown.</p>

<p><b>verify_statement ($dbh, $SQL)</b></p>

<p>This will check the <code>$SQL</code> against the current state's 'statement' value, and if it passes will add the current state's 'results' to the <code>$dbh</code>. If for some reason the 'statement' value is bad, not of the prescribed type, an exception is thrown. See above for more details.</p>

<p><b>verify_bound_params ($dbh, $params)</b></p>

<p>If the 'bound_params' slot is available in the current state, this will check the <code>$params</code> against the current state's 'bound_params' value. Both number of parameters and the parameters themselves must match, or an error will be raised.</p>

<p><b>reset</b></p>

<p>Calling this method will reset the state of the session object so that it can be reused.</p>
</blockquote>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="EXPERIMENTAL_FUNCTIONALITY">EXPERIMENTAL FUNCTIONALITY <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>All functionality listed here is highly experimental and should be used with great caution (if at all).</p>

<dl>
<dt><a name="Error"></a><a name="Error_handling_in_mock_add_resultset">Error handling in <i>mock_add_resultset</i></a></dt>

<dd>
<p>We have added experimental erro handling in <i>mock_add_resultset</i> the best example is the test file <em>t/023_statement_failure.t</em>, but it looks something like this:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_variable">$dbh</span><span class="sh_symbol">-&gt;</span><span class="sh_cbracket">{</span>mock_add_resultset<span class="sh_cbracket">}</span> <span class="sh_symbol">=</span> <span class="sh_cbracket">{</span>
      sql <span class="sh_symbol">=&gt;</span> <span class="sh_string">'SELECT foo FROM bar'</span><span class="sh_symbol">,</span>
      results <span class="sh_symbol">=&gt;</span> DBD<span class="sh_symbol">::</span>Mock<span class="sh_symbol">-&gt;</span>NULL_RESULTSET<span class="sh_symbol">,</span>
      failure <span class="sh_symbol">=&gt;</span> <span class="sh_symbol">[</span> <span class="sh_number">5</span><span class="sh_symbol">,</span> <span class="sh_string">'Ooops!'</span> <span class="sh_symbol">],</span>
  <span class="sh_cbracket">}</span><span class="sh_symbol">;</span></pre>

<p>The <code>5</code> is the DBI error number, and <code>'Ooops!'</code> is the error string passed to DBI. This basically allows you to force an error condition to occur when a given SQL statement is execute. We are currently working on allowing more control on the 'when' and 'where' the error happens, look for it in future releases.</p>

</dd><dt><a name="Attribute"></a><a name="Attribute_Aliasing">Attribute Aliasing</a></dt>

<dd>
<p>Basically this feature allows you to alias attributes to other attributes. So for instance, you can alias a commonly expected attribute like 'mysql_insertid' to something DBD::Mock already has like 'mock_last_insert_id'. While you can also just set 'mysql_insertid' yourself, this functionality allows it to take advantage of things like the autoincrementing of the 'mock_last_insert_id' attribute.</p>

<p>Right now this feature is highly experimental, and has been added as a first attempt to automatically handle some of the DBD specific attributes which are commonly used/accessed in DBI programming. The functionality is off by default so as to not cause any issues with backwards compatability, but can easily be turned on and off like this:</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_comment"># turn it on</span>
  <span class="sh_variable">$DBD</span><span class="sh_symbol">::</span>Mock<span class="sh_symbol">::</span>AttributeAliasing<span class="sh_symbol">++;</span>

  <span class="sh_comment"># turn it off</span>
  <span class="sh_variable">$DBD</span><span class="sh_symbol">::</span>Mock<span class="sh_symbol">::</span>AttributeAliasing <span class="sh_symbol">=</span> <span class="sh_number">0</span><span class="sh_symbol">;</span></pre>

<p>Once this is turned on, you will need to choose a database specific attribute aliasing table like so:</p>

<pre class="sh_perl sh_sourceCode">  DBI<span class="sh_symbol">-&gt;</span><span class="sh_function">connect</span><span class="sh_symbol">(</span><span class="sh_string">'dbi:Mock:MySQL'</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">,</span> <span class="sh_string">''</span><span class="sh_symbol">);</span></pre>

<p>The 'MySQL' in the DSN will be picked up and the MySQL specific attribute aliasing will be used.</p>

<p>Right now only MySQL is supported by this feature, and even that support is very minimal. Currently the MySQL <code>$dbh</code> and <code>$sth</code> attributes 'mysql_insertid' are aliased to the <code>$dbh</code> attribute 'mock_last_insert_id'. It is possible to add more aliases though, using the <code>DBD::Mock:_set_mock_attribute_aliases</code> function (see the source code for details).</p>
</dd>
</dl>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="BUGS">BUGS <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<dl>
<dt><a name="Odd"></a><a name="Odd_$dbh_attribute_behavior">Odd $dbh attribute behavior</a></dt>

<dd>
<p>When writing the test suite I encountered some odd behavior with some <code>$dbh</code> attributes. I still need to get deeper into how DBD's work to understand what it is that is actually doing wrong.</p>
</dd>
</dl>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="TO_DO">TO DO <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<dl>
<dt><a name="Make"></a><a name="Make_DBD_specific_handlers">Make DBD specific handlers</a></dt>

<dd>
<p>Each DBD has its own quirks and issues, it would be nice to be able to handle those issues with DBD::Mock in some way. I have an number of ideas already, but little time to sit down and really flesh them out. If you have any suggestions or thoughts, feel free to email me with them.</p>

</dd><dt><a name="Enhance"></a><a name="Enhance_the_DBD::Mock::StatementTrack_object">Enhance the DBD::Mock::StatementTrack object</a></dt>

<dd>
<p>I would like to have the DBD::Mock::StatementTrack object handle more of the mock_* attributes. This would encapsulate much of the mock_* behavior in one place, which would be a good thing.</p>

<p>I would also like to add the ability to bind a subroutine (or possibly an object) to the result set, so that the results can be somewhat more dynamic and allow for a more realistic interaction.</p>
</dd>
</dl>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="CODE_COVERAGE">CODE COVERAGE <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>We use <a href="http://search.cpan.org/perldoc?Devel%3A%3ACover" class="podlinkpod">Devel::Cover</a> to test the code coverage of my tests, below is the <a href="http://search.cpan.org/perldoc?Devel%3A%3ACover" class="podlinkpod">Devel::Cover</a> report on this module test suite.</p>

<pre class="sh_perl sh_sourceCode">  <span class="sh_symbol">----------------------------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span>
  File                           stmt   bran   cond    <span class="sh_keyword">sub</span>    pod   time  total
  <span class="sh_symbol">----------------------------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span>
  blib<span class="sh_string">/lib/DBD/</span>Mock<span class="sh_symbol">.</span>pm           <span class="sh_number">92.0</span>   <span class="sh_number">86.6</span>   <span class="sh_number">77.9</span>   <span class="sh_number">95.3</span>    <span class="sh_number">0.0</span>  <span class="sh_number">100.0</span>   <span class="sh_number">89.5</span>
  Total                          <span class="sh_number">92.0</span>   <span class="sh_number">86.6</span>   <span class="sh_number">77.9</span>   <span class="sh_number">95.3</span>    <span class="sh_number">0.0</span>  <span class="sh_number">100.0</span>   <span class="sh_number">89.5</span>
  <span class="sh_symbol">----------------------------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span> <span class="sh_symbol">------</span></pre>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="SEE_ALSO">SEE ALSO <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p><a href="http://search.cpan.org/perldoc?DBI" class="podlinkpod">DBI</a></p>

<p><a href="http://search.cpan.org/perldoc?DBD%3A%3ANullP" class="podlinkpod">DBD::NullP</a>, which provided a good starting point</p>

<p><a href="http://search.cpan.org/perldoc?Test%3A%3AMockObject" class="podlinkpod">Test::MockObject</a>, which provided the approach</p>

<p><a href="http://search.cpan.org/perldoc?Test%3A%3AMockObject" class="podlinkpod">Test::MockObject</a> article - <a href="http://www.perl.com/pub/a/2002/07/10/tmo.html" class="podlinkurl">http://www.perl.com/pub/a/2002/07/10/tmo.html</a></p>

<p>Perl Code Kata: Testing Databases - <a href="http://www.perl.com/pub/a/2005/02/10/database_kata.html" class="podlinkurl">http://www.perl.com/pub/a/2005/02/10/database_kata.html</a></p>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="DISCUSSION_GROUP">DISCUSSION GROUP <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>We have created a <b>DBD::Mock</b> google group for discussion/questions about this module.</p>

<p><a href="http://groups-beta.google.com/group/DBDMock" class="podlinkurl">http://groups-beta.google.com/group/DBDMock</a></p>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<dl>
<dt><a name="Thanks"></a><a name="Thanks_to_Ryan_Gerry_for_his_patch_in_RT_#26604">Thanks to Ryan Gerry for his patch in RT #26604</a></dt>

<dd>
</dd><dt><a name="Thanks"></a><a name="Thanks_to_Marc_Beyer_for_his_patch_in_RT_#16951">Thanks to Marc Beyer for his patch in RT #16951</a></dt>

<dd>
</dd><dt><a name="Thanks"></a><a name="Thanks_to_Justin_DeVuyst_for_the_mock_connect_fail_idea">Thanks to Justin DeVuyst for the mock_connect_fail idea</a></dt>

<dd>
</dd><dt><a name="Thanks"></a><a name="Thanks_to_Thilo_Planz_for_the_code_for_bind_param_inout">Thanks to Thilo Planz for the code for <code>bind_param_inout</code></a></dt>

<dd>
</dd><dt><a name="Thanks"></a><a name="Thanks_to_Shlomi_Fish_for_help_tracking_down_RT_Bug_#11515">Thanks to Shlomi Fish for help tracking down RT Bug #11515</a></dt>

<dd>
</dd><dt><a name="Thanks"></a><a name="Thanks_to_Collin_Winter_for_the_patch_to_fix_the_begin_work(),_commit()_and_rollback()_methods.">Thanks to Collin Winter for the patch to fix the <code>begin_work()</code>, <code>commit()</code> and <code>rollback()</code> methods.</a></dt>

<dd>
</dd><dt><a>Thanks to Andrew McHarg &lt;amcharg@acm.org&gt; for <code>fetchall_hashref()</code>, <code>fetchrow_hashref()</code> and <code>selectcol_arrayref()</code> methods and tests.</a></dt>

<dd>
</dd><dt><a name="Thanks"></a><a name="Thanks_to_Andrew_W._Gibbs_for_the_mock_last_insert_ids_patch_and_test">Thanks to Andrew W. Gibbs for the <code>mock_last_insert_ids</code> patch and test</a></dt>

<dd>
</dd><dt><a name="Thanks"></a><a name="Thanks_to_Chas_Owens_for_patch_and_test_for_the_mock_can_prepare,_mock_can_execute,_and_mock_can_fetch_features.">Thanks to Chas Owens for patch and test for the <code>mock_can_prepare</code>, <code>mock_can_execute</code>, and <code>mock_can_fetch</code> features.</a></dt>
</dl>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="COPYRIGHT">COPYRIGHT <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>Copyright (C) 2004 Chris Winters &lt;chris@cwinters.com&gt;</p>

<p>Copyright (C) 2004-2007 Stevan Little &lt;stevan@iinteractive.com&gt;</p>

<p>Copyright (C) 2007 Rob Kinyon &lt;rob.kinyon@gmail.com&gt;</p>

<p>This library is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<h1><a class="u" href="http://search.cpan.org/~drolsky/DBD-Mock-1.39/lib/DBD/Mock.pm#___top" title="click to go to top of document" name="AUTHORS">AUTHORS <img alt="^" src="./DBD  Mock - search.cpan.org_files/up.gif"></a></h1>

<p>Chris Winters &lt;chris@cwinters.com&gt;</p>

<p>Stevan Little &lt;stevan@iinteractive.com&gt;</p>

<p>Rob Kinyon &lt;rob.kinyon@gmail.com&gt;</p>

</div>
<!-- This should probably be put in the <div class="footer"></div> -->
<script type="text/javascript">
    $(document).ready(function(){
        var startingStyle = $.cookie('css') ? $.cookie('css') : 'http://st.pimg.net/tucs/css/sh_none.min.css';
        $.fn.styleSwitch(startingStyle);
        $("#styleswitch").val(startingStyle);
        sh_highlightDocument();
        $("#styleswitch").bind(($.browser.msie ? "click" : "change"), function() {
            $.fn.styleSwitch($(this).val());
        });
    });
</script>
<div class="styleswitch">
    syntax highlighting:
    <select id="styleswitch">
        <option value="http://st.pimg.net/tucs/css/sh_none.min.css">no syntax highlighting</option>
        <option value="http://st.pimg.net/tucs/css/sh_acid.min.css">acid</option>
        <option value="http://st.pimg.net/tucs/css/sh_berries-dark.min.css">berries-dark</option>
        <option value="http://st.pimg.net/tucs/css/sh_berries-light.min.css">berries-light</option>
        <option value="http://st.pimg.net/tucs/css/sh_bipolar.min.css">bipolar</option>
        <option value="http://st.pimg.net/tucs/css/sh_blacknblue.min.css">blacknblue</option>
        <option value="http://st.pimg.net/tucs/css/sh_bright.min.css">bright</option>
        <option value="http://st.pimg.net/tucs/css/sh_contrast.min.css">contrast</option>
        <option value="http://st.pimg.net/tucs/css/sh_cpan.min.css">cpan</option>
        <option value="http://st.pimg.net/tucs/css/sh_darkblue.min.css">darkblue</option>
        <option value="http://st.pimg.net/tucs/css/sh_darkness.min.css">darkness</option>
        <option value="http://st.pimg.net/tucs/css/sh_desert.min.css">desert</option>
        <option value="http://st.pimg.net/tucs/css/sh_dull.min.css">dull</option>
        <option value="http://st.pimg.net/tucs/css/sh_easter.min.css">easter</option>
        <option value="http://st.pimg.net/tucs/css/sh_emacs.min.css">emacs</option>
        <option value="http://st.pimg.net/tucs/css/sh_golden.min.css">golden</option>
        <option value="http://st.pimg.net/tucs/css/sh_greenlcd.min.css">greenlcd</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-anjuta.min.css">ide-anjuta</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-codewarrior.min.css">ide-codewarrior</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-devcpp.min.css">ide-devcpp</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-eclipse.min.css">ide-eclipse</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-kdev.min.css">ide-kdev</option>
        <option value="http://st.pimg.net/tucs/css/sh_ide-msvcpp.min.css">ide-msvcpp</option>
        <option value="http://st.pimg.net/tucs/css/sh_kwrite.min.css">kwrite</option>
        <option value="http://st.pimg.net/tucs/css/sh_matlab.min.css">matlab</option>
        <option value="http://st.pimg.net/tucs/css/sh_navy.min.css">navy</option>
        <option value="http://st.pimg.net/tucs/css/sh_nedit.min.css">nedit</option>
        <option value="http://st.pimg.net/tucs/css/sh_neon.min.css">neon</option>
        <option value="http://st.pimg.net/tucs/css/sh_night.min.css">night</option>
        <option value="http://st.pimg.net/tucs/css/sh_pablo.min.css">pablo</option>
        <option value="http://st.pimg.net/tucs/css/sh_peachpuff.min.css">peachpuff</option>
        <option value="http://st.pimg.net/tucs/css/sh_print.min.css">print</option>
        <option value="http://st.pimg.net/tucs/css/sh_rand01.min.css">rand01</option>
	<option value="http://st.pimg.net/tucs/css/sh_solarized-dark.min.css">solarized-dark</option>
	<option value="http://st.pimg.net/tucs/css/sh_solarized-light.min.css">solarized-light</option>
        <option value="http://st.pimg.net/tucs/css/sh_style.min.css">style</option>
        <option value="http://st.pimg.net/tucs/css/sh_the.min.css">the</option>
        <option value="http://st.pimg.net/tucs/css/sh_typical.min.css">typical</option>
        <option value="http://st.pimg.net/tucs/css/sh_vampire.min.css">vampire</option>
        <option value="http://st.pimg.net/tucs/css/sh_vim-dark.min.css">vim-dark</option>
        <option value="http://st.pimg.net/tucs/css/sh_vim.min.css">vim</option>
        <option value="http://st.pimg.net/tucs/css/sh_whatis.min.css">whatis</option>
        <option value="http://st.pimg.net/tucs/css/sh_whitengrey.min.css">whitengrey</option>
        <option value="http://st.pimg.net/tucs/css/sh_zellner.min.css">zellner</option>
    </select>
</div>



<div class="footer"><div class="cpanstats">68693 Uploads, 22706 Distributions
96039 Modules, 9011 Uploaders
</div>
hosted by <a href="http://www.yellowbot.com/">YellowBot</a><br>
<a href="http://www.yellowbot.com/"><img alt="do. tag. write. share." src="./DBD  Mock - search.cpan.org_files/yellowbot_logo.gif"></a>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="./DBD  Mock - search.cpan.org_files/ga.js" type="text/javascript"></script>
<script type="text/javascript" src="./DBD  Mock - search.cpan.org_files/v6test.js"></script>

<script type="text/javascript">
   // v6.target = '';
   if (!v6.target) { v6.only_once = true }
   v6.site = '7A0D89A6-2B82-11DF-B9DA-F61CBD13F020';
   v6.api_server = 'http://ipv4.v6test.develooper.com';
   try {
     v6.test();
   } catch(err) {}
</script>
<script type="text/javascript">
  $(document).ready(function(){
    $("a[href^=http:]").click(function(){
      var href = $(this).attr('href');
      var m = href.match('\/\/([^\/:]+)');
      _gaq.push(['_trackEvent','External',m[1],'Module']);
    });
    $("a[href^=/CPAN/]").click(function(){
      var href = $(this).attr('href');
      _gaq.push(['_trackEvent','Download',href,'Module']);
    });
  });
</script>
<!-- Mon Jun  6 06:24:45 2011 GMT (0.187743902206421) @cpansearch1 -->
 

</body></html>