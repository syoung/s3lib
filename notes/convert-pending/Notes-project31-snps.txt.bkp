Notes-project31-snps.txt



*****  LATER: PROVIDE RIGHTCLICK LINKING TO EMBL AND NCBI USING ccdsInfo TABLE FROM UCSC (SEE ABOVE)
    
    Database: hg19    Primary Table: ccdsInfo    Row Count: 58,516
    Format description: Consensus CDS information, links CCDS ids to NCBI and Hinxton accessions
    field	example	SQL type	info	description
    ccds	CCDS10.1	char(12)	values	CCDS id
    srcDb	H	char(1)	values	source database: N=NCBI, H=Hinxton
    mrnaAcc	ENST00000379268	char(18)	values	mRNA accession (NCBI or Hinxton)
    protAcc	ENSP00000368570	char(18)	values	protein accession (NCBI or Hinxton)
    
    
    Sample Rows
        
    ccds	srcDb	mrnaAcc	protAcc
    CCDS10.1	H	ENST00000379268	ENSP00000368570
    CCDS10.1	N	NM_004195.2	NP_004186.1
    CCDS100.2	H	ENST00000377411	ENSP00000366628
    CCDS100.2	N	NM_024980.4	NP_079256.4
    CCDS1000.1	H	ENST00000368849	ENSP00000357842
    CCDS1000.1	N	NM_020127.2	NP_064512.1
    CCDS10000.1	H	ENST00000339418	ENSP00000339175
    CCDS10000.1	H	ENST00000392568	ENSP00000376349
    CCDS10000.1	N	NM_177533.3	NP_803877.2
    CCDS10000.1	H	OTTHUMT00000074545	OTTHUMP00000163909



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

DE NOVO MULTIPLE ASSEMBLY AROUND SNP SITE, E.G., VELVET








++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Mon May  3 13:58:54 EDT 2010
UCSC'S CORRELATION BETWEEN TABLES (AND DATA POINT VALUES OF FEATURES)

http://genome.ucsc.edu/cgi-bin/hgTables

Correlate table 'CCDS' (ccdsGene)
 	
Select a group, track and table to correlate with:
group:     track: 
table: 
Limit total data points in result:  	  Window data to:    bases
  

Methods

The data points from each table are projected down to the base level. At this level, the two data sets are intersected such that they each have data values at the same bases, resulting in data sets of equal length n. These two data sets (X,Y) are then used in a standard linear correlation function, computing the correlation coefficient: 
r = sxy / (sx * sy)
where sx and sy are the standard deviations of the data sets X and Y, and sxy is the covariance, computed as: 
sxy = ( sum(Xi*Yi) - ((sum(Xi)*sum(Yi))/n) ) / (n - 1)


When available, the data values from a track are used in the calculations. For tracks that do not have data values, such as gene-structured tracks, the data value used in the calculation is 1.0 for bases that are covered by exons and 0.0 at all other positions in the region. For simple tracks that are not gene structures, or data-valued tracks, the calculation uses the value 1.0 over the extent of the item and 0.0 for all other positions in the region.


Known Limitations

The number of bases that can be processed is limited, on the order of about 300,000,000, due to memory and processing time limits. Therefore, large chromosomes, e.g. chr1 on human, cannot be processed entirely. Future improvements are expected to remove this processing limit.

Intersection filters set on the main table browser page will function here, but they will apply to both tables when possible. The various intersection options can produce unusual results. It is probably best to avoid intersections or to use the results of an intersection that have been saved in a custom track.



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Wed May  5 23:00:58 EDT 2010
CREATED filterFile.pl AND REFACTORED Report::SNP FOR QUERY BY report.cgi

1. filterFile.pl
----------------

chmod 755 /nethome/bioinfo/apps/agua/0.4/bin/apps/filterFile.pl \

perl /nethome/bioinfo/apps/agua/0.4/bin/apps/filterFile.pl \
--inputfile /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.filter \
--outputfile /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.filter.fil \
--columns 1,8 \
--values chr22,9 \
--types "eq,>"



2. Report::SNP
--------------

echo {"username":"syoung","sessionId":"1228791394.7868.158","project":"Project1","workflow":"Workflow1","report":"Report1","mode":"filterQuery","class":"Report::SNP","editor":false,"reportCombo":"Report1","workflowCombo":"Workflow1","projectCombo":"Project1","chromosomeCombo":"chr1","speciesCombo":"Human","effectCombo":"Missense","exonicCombo":"Exonic","dbsnpCombo":"dbSNP only","chromosomeCheckbox":false,"effectCheckbox":true,"exonicCheckbox":true,"dbsnpCheckbox":true,"depthCheckbox":true,"variantCheckbox":true,"fileInput":"Project1/Workflow1/out.filter.snp","variantInput":"0.10","depthSpinner":"10.00","totalResult":"3986","chromosomeResult":"3986","variantResult":"3986","depthResult":"326","effectResult":"326","exonicResult":"326","dbsnpResult":"326"} | perl -U report.cgi



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Mon May  3 13:00:58 EDT 2010
IMPLEMENTED Filter::SNP AND CREATED pileupToSnp.pl 


RUN pileupToSnp.pl USING ccdsGene
=================================

chmod 755 /nethome/bioinfo/apps/agua/0.4/bin/apps/pileupToSnp.pl


/nethome/bioinfo/apps/agua/0.4/bin/apps/pileupToSnp.pl \
--inputtype pileup \
--inputfile /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.filter \
--outputfile /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.filter.snp


1. CALCULATE IF SNP IN dbSNP

    

2. CHECK IF SNP IN GENE (WITHIN RIGHT OR LEFT MARGINS)

    IGNORE 'N' POSITIONS
    
    CHECK IF POSITION IN ccdsGene


3. IF IN GENE, CALCULATE POSITION OF SNP
        
    **        UPSTREAM (MARGIN)
    5' UTR
    NON-CODING
    EXONIC
    INTRONIC
    3' UTR
    **        DOWNSTREAM (MARGIN)


4. IF CODING, CALCULATE EFFECT OF SNP 

    MISSENSE
    SYNONYMOUS
    STOP
    START



INPUT FORMAT
------------

    NB: SEE Galaxy PILEUP PARSER
    http://main.g2.bx.psu.edu/root?tool_id=pileup_parser

emacs /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.filter.bkp

    ...
    chr22   16017040        N       A       36      0       49      3       a-2nna-2nna     8_A
    chr22   16017040        *       -NN/-NN 0       0       49      3       -NN     *       2       1       0           0       0
    chr22   16038081        N       T       15      0       51      3       CT-1NT  629
    chr22   16038081        *       -N/-N   0       0       51      3       -N      *       1       2       0           0       0
    chr22   16051270        t       G       36      36      60      3       Ggg     IAI
    chr22   16054071        *       +G/+G   53      159     44      5       +G      *       1       4       0           0       0
    chr22   16061884        t       G       39      39      31      4       Gg^!G^!G        15FF
    chr22   16062193        C       T       36      36      60      3       TTT     I0C
    chr22   16062195        G       T       36      36      60      3       T$TT    I20
    chr22   16066324        c       G       36      36      51      3       G$g^8g  I6I


OUTPUT FORMAT
-------------

EXTENDED PILEUP CONTAINING SNP ANNOTATION

    PILEUP COLUMNS
    
    1. chromosome                      ('chromosome')
    2. 1-based coordinate
    3. reference base
    4. consensus base                   ('variant')
    5. consensus quality                Phred-scaled probability that the consensus is wrong
    6. SNP quality                      Phred-scaled probability that the consensus is identical to the reference. (For SNP calling, SNP quality is of more importance.)
    7. max. mapping quality of reads covering sites
    8. number of reads covering site    ('depth')
    9. read bases
    10. phred33 base qualities
    
    ADDITIONAL COLUMNS
    
    11. snp                             ('rs_***')
    12. snptype                         ('dbsnp')
    13. snpscore
    14. variantfrequency                (calculated from readbases in column 9)
    15. ccds
    16. ccdsstart
    17. ccdstype                        (5-utr|non-coding|exonic|intronic|3-utr)
    18. ccdsnumber                      (CCDS1.1)
    19. ccdsstrand                      (+|-)
    20. referencecodon
    21. variantcodon
    22. referenceaa
    23. variantaa
    24. effect                          (missense|synonymous|stop|start)
    

NB: ^* CHARACTERS IN READ BASES COLUMNS, E.G.: 

        chr22   16066324        c       G       36      36      51      3       G$g^8g  I6I

    '^'     start of a read segment which is a contiguous subsequence on the read separated by `N/S/H' CIGAR operations. The ASCII of the character following `^' minus 33 gives the mapping quality. 

    '$'     end of a read segment.
    
Start and end markers of a read are largely inspired by Phil Green's CALF format. These markers make it possible to reconstruct the read sequences from pileup.





SIMILARITIES WITH EXISTING FILTER

NB: COLUMN NAMES IN TABLE FOR FILTER IN Filter::SNP::filterReport

["chromosome", "variant", "depth", "sense", "exonic", "dbsnp"]


COMPARE TO EXISTING diffs TABLE USED IN Report::SNP:


    CREATE TABLE IF NOT EXISTS diffs
    (
        name                VARCHAR(20),
        chromosome          VARCHAR(20),
        ccdsstart           INT(12),
        ccdsstop            INT(12),
        referencenucleotide VARCHAR(255),
        variantnucleotide   VARCHAR(255),
        depth               INT(6),
        variantfrequency    INT(6),
        chromosomestart     INT(12),
        chromosomestop      INT(12),
        sense               VARCHAR(1),
        referencecodon      VARCHAR(255),
        variantcodon        VARCHAR(255),
        referenceaa         VARCHAR(255),
        variantaa           VARCHAR(255),
        strand              VARCHAR(1),
        snp                 VARCHAR(20),
        score               INT(6),
        dbsnpstrand         VARCHAR(1),
        
        PRIMARY KEY (name, chromosome, ccdsstart, ccdsstop, referencenucleotide, variantnucleotide)
    )



EXAMPLE OF INPUT:

emacs /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.filter.bkp

    ...
    chr22   16017040        N       A       36      0       49      3       a-2nna-2nna     8_A
    chr22   16017040        *       -NN/-NN 0       0       49      3       -NN     *       2       1       0           0       0
    chr22   16038081        N       T       15      0       51      3       CT-1NT  629
    chr22   16038081        *       -N/-N   0       0       51      3       -N      *       1       2       0           0       0
    chr22   16051270        t       G       36      36      60      3       Ggg     IAI
    chr22   16054071        *       +G/+G   53      159     44      5       +G      *       1       4       0           0       0
    chr22   16061884        t       G       39      39      31      4       Gg^!G^!G        15FF
    chr22   16062193        C       T       36      36      60      3       TTT     I0C
    chr22   16062195        G       T       36      36      60      3       T$TT    I20
    chr22   16066324        c       G       36      36      51      3       G$g^8g  I6I
    ...
    chr22   16147716        g       T       36      36      60      3       Tt^~t   G2A
    chr22   16147717        a       C       36      36      60      3       C$cc    I7I
    chr22   16148781        c       T       36      36      28      3       tTt     I2E
    chr22   16152236        T       A       36      36      60      3       aA^hA   CIF
    chr22   16152237        G       T       36      36      60      3       t$TT    FIC
    chr22   16153275        T       C       79      99      25      25      C$G$C$C$CCCcccCCCcCCccCcCcc^!C^0c           I+I*II223BI09X34::1I3>IF6
    chr22   16153698        G       A       13      26      25      5       C$A$aAa *7C)I
    chr22   16155328        *       +G/*    271     1070    28      74      +G      *       2       72      0           0       0
    chr22   16155414        *       -t/-t   193     1653    13      56      -t      *       1       55      0           0       0
    chr22   16155446        *       -a/-a   277     3454    14      91      -a      *       1       90      0           0       0
    chr22   16155839        *       +T/+T   203     1904    18      55      +T      *       1       54      0           0       0
    ...
    chr22   49589714        *       +GGTG/+GGTG     55      624     54      19      +GGTG   *       1       10
    chr22   49589804        *       -GT/*   104     333     57      27      -GT     *       2       25      00
    chr22   49589838        *       +GA/+GA 140     1091    57      34      +GA     *       1       33      00
    chr22   49589896        *       +GT/+GT 152     1461    59      38      +GT     *       3       35      00
    chr22   49589935        *       -C/+T   1       413     50      21      -C      +T      1       2       12
    chr22   49590286        *       +TTG/+TTG       104     839     57      22      +TTG    *       10      10
    chr22   49590324        *       +TTCT/+TTCT     107     863     60      23      +TTCT   *       1       20
    chr22   49590647        *       -aaaa/* 46      743     57      31      -aaaa   *       2       29      00
    chr22   49590719        *       -a/-a   131     1175    56      31      -a      *       2       29      00
    chr22   49591214        *       -GTG/-GTG       52      559     54      18      -GTG    *       1       10


HAPMAP ONLY 500 OF 98,000 SNP 130



sqlite> .schema snp130
CREATE TABLE snp130 (
  bin smallint(5) NOT NULL default 0,
  chrom varchar(31) NOT NULL default '',
  chromStart int(10) NOT NULL default 0,
  chromEnd int(10) NOT NULL default 0,
  name varchar(15) NOT NULL default '',
  score smallint(5) NOT NULL default 0,
  strand varchar(1) default NULL,
  refNCBI blob NOT NULL,
  refUCSC blob NOT NULL,
  observed varchar(255) NOT NULL default '',
  molType varchar(12) default NULL,
  class varchar(30) NOT NULL default unknown,
  valid varchar(30) NOT NULL default unknown,
  avHet float NOT NULL default 0,
  avHetSE float NOT NULL default 0,
  func varchar(30) NOT NULL default unknown,
  locType varchar(30) default NULL,
  weight int(10) NOT NULL default 0,
  PRIMARY KEY (name,chrom,bin, chromStart, chromEnd)
);

sqlite> .schema ccdsSNP
CREATE TABLE ccdsSNP (

    chromosome      varchar(255),
    chromosomeStart int(10),
    chromosomeEnd   int(10),
    snp             varchar(20),
    score           int(10),
    strand          char(1),

    PRIMARY KEY(snp)
);


sqlite> select * from snp130 limit 1;
#bin|chrom|chromStart|chromEnd|name|score|strand|refNCBI|refUCSC|observed|molType|class|valid|avHet|avHetSE|func|locType|weight
sqlite> select * from snp130 limit 1, 1;
585|chrY|95387|95388|rs28377933|0|+|A|A|A/G|genomic|single|unknown|0.0|0.0|unknown|exact|3

sqlite> select valid, count(*) as count from snp130 group by valid;

    by-1000genomes  566
    by-2hit-2allele 1015
    by-2hit-2allele,by-1000genomes  4
    by-2hit-2allele,by-hapmap       10
    by-cluster      2277
    by-cluster,by-1000genomes       23
    by-cluster,by-2hit-2allele      2161
    by-cluster,by-2hit-2allele,by-1000genomes       11
    by-cluster,by-2hit-2allele,by-hapmap    1
    by-cluster,by-frequency 144
    by-cluster,by-frequency,by-1000genomes  1
    by-cluster,by-frequency,by-2hit-2allele 51
    by-cluster,by-frequency,by-2hit-2allele,by-hapmap       51
    by-cluster,by-frequency,by-2hit-2allele,by-hapmap,by-1000genomes        3
    by-cluster,by-frequency,by-hapmap       118
    by-cluster,by-frequency,by-hapmap,by-1000genomes        4
    by-cluster,by-frequency,by-submitter    10
    by-cluster,by-frequency,by-submitter,by-2hit-2allele    2
    by-cluster,by-frequency,by-submitter,by-2hit-2allele,by-hapmap  4
    by-cluster,by-frequency,by-submitter,by-hapmap  15
    by-cluster,by-hapmap    30
    by-cluster,by-submitter 33
    by-cluster,by-submitter,by-2hit-2allele 15
    by-cluster,by-submitter,by-2hit-2allele,by-1000genomes  1
    by-cluster,by-submitter,by-hapmap       2
    by-frequency    609
    by-frequency,by-1000genomes     1
    by-frequency,by-2hit-2allele    9
    by-frequency,by-2hit-2allele,by-hapmap  28
    by-frequency,by-2hit-2allele,by-hapmap,by-1000genomes   3
    by-frequency,by-hapmap  132
    by-frequency,by-hapmap,by-1000genomes   4
    by-frequency,by-submitter       16
    by-frequency,by-submitter,by-hapmap     5
    by-hapmap       89
    by-submitter    569
    by-submitter,by-1000genomes     4
    by-submitter,by-2hit-2allele    7
    by-submitter,by-hapmap  1
    unknown 89919
    valid   1




PREPARATION
===========


1. LOADED WHOLE hg19 ccdsGene DATA INTO TABLE

ll /nethome/syoung/base/pipeline/ccds/ccds-ucsc/ccdsGene

    -rw-rw-r-- 1 syoung bioinfo 5.4M May  4 14:28 ccdsGene

sqlite3 /nethome/bioinfo/apps/agua/0.4/bin/apps/t/04-Filter-SNP/dbfile/filtersnp.dbl
delete from ccdsGene;
.separator "\t"
.import /nethome/syoung/base/pipeline/ccds/ccds-ucsc/ccdsGene.tsv ccdsGene

OK


2. LOADED WHOLE snp130 dbSNP DATA INTO TABLE

sqlite3 /nethome/bioinfo/apps/agua/0.4/bin/apps/t/04-Filter-SNP/dbfile/filtersnp.dbl

select count(*) from snp130;
    97949

select distinct(chrom) from snp130;
    chrom
    chrY

delete from snp130;

.separator "\t"
.import /nethome/syoung/base/pipeline/dbsnp/snp130.tsv snp130



3. SPLIT snp130 INTO CHROMOSOME-SPECIFIC dbSNP TABLES AND LOAD INTO TABLES

cd /nethome/syoung/base/pipeline/dbsnp
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
grep "chr1  " snp130.tsv > snp130-chr1
...
grep "chr23 " snp130.tsv  > snp130-chr23
ll

    -rw-rw-r--  1 syoung bioinfo  94M May  5 02:23 snp130-chr10
    -rw-rw-r--  1 syoung bioinfo  90M May  5 02:23 snp130-chr11
    -rw-rw-r--  1 syoung bioinfo  88M May  5 02:23 snp130-chr12
    -rw-rw-r--  1 syoung bioinfo  68M May  5 02:23 snp130-chr13
    -rw-rw-r--  1 syoung bioinfo  59M May  5 02:24 snp130-chr14
    -rw-rw-r--  1 syoung bioinfo  58M May  5 02:24 snp130-chr15
    -rw-rw-r--  1 syoung bioinfo  63M May  5 02:24 snp130-chr16
    -rw-rw-r--  1 syoung bioinfo  53M May  5 02:24 snp130-chr17
    -rw-rw-r--  1 syoung bioinfo  52M May  5 02:24 snp130-chr18
    -rw-rw-r--  1 syoung bioinfo  42M May  5 02:24 snp130-chr19
    -rw-rw-r--  1 syoung bioinfo 162M May  5 02:15 snp130-chr1
    -rw-rw-r--  1 syoung bioinfo  48M May  5 02:25 snp130-chr20
    -rw-rw-r--  1 syoung bioinfo  29M May  5 02:25 snp130-chr21
    -rw-rw-r--  1 syoung bioinfo  33M May  5 02:25 snp130-chr22
    -rw-rw-r--  1 syoung bioinfo 155M May  5 02:15 snp130-chr2
    -rw-rw-r--  1 syoung bioinfo 125M May  5 02:15 snp130-chr3
    -rw-rw-r--  1 syoung bioinfo 125M May  5 02:16 snp130-chr4
    -rw-rw-r--  1 syoung bioinfo 113M May  5 02:22 snp130-chr5
    -rw-rw-r--  1 syoung bioinfo 125M May  5 02:22 snp130-chr6
    -rw-rw-r--  1 syoung bioinfo 107M May  5 02:22 snp130-chr7
    -rw-rw-r--  1 syoung bioinfo  96M May  5 02:22 snp130-chr8
    -rw-rw-r--  1 syoung bioinfo 102M May  5 02:23 snp130-chr9
    -rw-rw-r--  1 syoung bioinfo  68M May  5 02:25 snp130-chrX
    -rw-rw-r--  1 syoung bioinfo 8.9M May  5 02:25 snp130-chrY
    -rw-r--r--  1 syoung bioinfo 2.0G May  4 23:54 snp130.header.txt
    -rw-rw-r--  1 syoung bioinfo 2.0G May  5 01:57 snp130


4. REMOVE DUPLICATE LINES

cd /nethome/syoung/base/pipeline/dbsnp

uniq -u snp130-chr1.tsv > TMP; mv -f TMP snp130-chr1
uniq -u snp130-chr2.tsv > TMP; mv -f TMP snp130-chr2
uniq -u snp130-chr3.tsv > TMP; mv -f TMP snp130-chr3
uniq -u snp130-chr4.tsv > TMP; mv -f TMP snp130-chr4
uniq -u snp130-chr5.tsv > TMP; mv -f TMP snp130-chr5
uniq -u snp130-chr6.tsv > TMP; mv -f TMP snp130-chr6
uniq -u snp130-chr7.tsv > TMP; mv -f TMP snp130-chr7
uniq -u snp130-chr8.tsv > TMP; mv -f TMP snp130-chr8
uniq -u snp130-chr9.tsv > TMP; mv -f TMP snp130-chr9
uniq -u snp130-chr10.tsv > TMP; mv -f TMP snp130-chr10
uniq -u snp130-chr11.tsv > TMP; mv -f TMP snp130-chr11
uniq -u snp130-chr12.tsv > TMP; mv -f TMP snp130-chr12
uniq -u snp130-chr13.tsv > TMP; mv -f TMP snp130-chr13
uniq -u snp130-chr14.tsv > TMP; mv -f TMP snp130-chr14
uniq -u snp130-chr15.tsv > TMP; mv -f TMP snp130-chr15
uniq -u snp130-chr16.tsv > TMP; mv -f TMP snp130-chr16
uniq -u snp130-chr17.tsv > TMP; mv -f TMP snp130-chr17
uniq -u snp130-chr18.tsv > TMP; mv -f TMP snp130-chr18
uniq -u snp130-chr19.tsv > TMP; mv -f TMP snp130-chr19
uniq -u snp130-chr20.tsv > TMP; mv -f TMP snp130-chr20
uniq -u snp130-chr21.tsv > TMP; mv -f TMP snp130-chr21
uniq -u snp130-chr22.tsv > TMP; mv -f TMP snp130-chr22
uniq -u snp130-chrX.tsv > TMP; mv -f TMP snp130-chrX
uniq -u snp130-chrY.tsv > TMP; mv -f TMP snp130-chrY



5. LOAD FILES INTO DATABASE

sqlite3 /nethome/bioinfo/apps/agua/0.4/bin/apps/t/04-Filter-SNP/dbfile/filtersnp.dbl


CREATE TABLES snp130_chr1, snp130_chr2, ... 


CREATE TABLE snp130_chr22 (
  bin smallint(5) NOT NULL default 0,
  chrom varchar(31) NOT NULL default '',
  chromStart int(10) NOT NULL default 0,
  chromEnd int(10) NOT NULL default 0,
  name varchar(15) NOT NULL default '',
  score smallint(5) NOT NULL default 0,
  strand varchar(1) default NULL,
  refNCBI blob NOT NULL,
  refUCSC blob NOT NULL,
  observed varchar(255) NOT NULL default '',
  molType varchar(12) default NULL,
  class varchar(30) NOT NULL default unknown,
  valid varchar(30) NOT NULL default unknown,
  avHet float NOT NULL default 0,
  avHetSE float NOT NULL default 0,
  func varchar(30) NOT NULL default unknown,
  locType varchar(30) default NULL,
  weight int(10) NOT NULL default 0,
  PRIMARY KEY (name,chrom,bin, chromStart, chromEnd)
);


LOAD FILES

sqlite3 /nethome/bioinfo/apps/agua/0.4/bin/apps/t/04-Filter-SNP/dbfile/filtersnp.dbl
.separator "\t"

.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr1.tsv snp130_chr1
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr2.tsv snp130_chr2
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr3.tsv snp130_chr3
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr4.tsv snp130_chr4
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr5.tsv snp130_chr5
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr6.tsv snp130_chr6
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr7.tsv snp130_chr7
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr8.tsv snp130_chr8
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr9.tsv snp130_chr9
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr10.tsv snp130_chr10
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr11.tsv snp130_chr11
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr12.tsv snp130_chr12
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr13.tsv snp130_chr13
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr14.tsv snp130_chr14
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr15.tsv snp130_chr15
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr16.tsv snp130_chr16
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr17.tsv snp130_chr17
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr18.tsv snp130_chr18
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr19.tsv snp130_chr19
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr20.tsv snp130_chr20
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr21.tsv snp130_chr21
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr22.tsv snp130_chr22
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chrX.tsv snp130_chrX
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chrY.tsv snp130_chrY


RELOAD DUE TO MIXED UP CHROMOSOME CONTENTS OF EACH FILE

drop table snp130_chr5;
drop table snp130_chr6;
drop table snp130_chr7;
drop table snp130_chr8;
drop table snp130_chr9;
drop table snp130_chr10;
drop table snp130_chr13;
drop table snp130_chr15;
drop table snp130_chr18;
drop table snp130_chr19;
drop table snp130_chr20;
drop table snp130_chr22;


.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr5.tsv snp130_chr5
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr6.tsv snp130_chr6
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr7.tsv snp130_chr7
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr8.tsv snp130_chr8
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr9.tsv snp130_chr9
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr10.tsv snp130_chr10
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr13.tsv snp130_chr13
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr15.tsv snp130_chr15
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr18.tsv snp130_chr18
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr19.tsv snp130_chr19
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr20.tsv snp130_chr20
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr22.tsv snp130_chr22

sqlite> .import /nethome/syoung/base/pipeline/dbsnp/snp130-chr6.tsv snp130_chr6
    Error: columns name, chrom, bin, chromStart, chromEnd are not unique
sqlite> .import /nethome/syoung/base/pipeline/dbsnp/snp130-chr10.tsv snp130_chr10
    Error: columns name, chrom, bin, chromStart, chromEnd are not unique

REMOVE DUPLICATES

uniq -u /nethome/syoung/base/pipeline/dbsnp/snp130-chr6.tsv > /nethome/syoung/base/pipeline/dbsnp/snp130-chr6.uniq.tsv 
mv /nethome/syoung/base/pipeline/dbsnp/snp130-chr6.uniq.tsv /nethome/syoung/base/pipeline/dbsnp/snp130-chr6.tsv  

uniq -u /nethome/syoung/base/pipeline/dbsnp/snp130-chr10.tsv > /nethome/syoung/base/pipeline/dbsnp/snp130-chr10.uniq.tsv 
mv /nethome/syoung/base/pipeline/dbsnp/snp130-chr10.uniq.tsv /nethome/syoung/base/pipeline/dbsnp/snp130-chr10.tsv  


uniq -u snp130-chr1.tsv > TMP; mv -f TMP snp130-chr1
uniq -u snp130-chr2.tsv > TMP; mv -f TMP snp130-chr2
uniq -u snp130-chr3.tsv > TMP; mv -f TMP snp130-chr3
uniq -u snp130-chr4.tsv > TMP; mv -f TMP snp130-chr4
uniq -u snp130-chr5.tsv > TMP; mv -f TMP snp130-chr5
uniq -u snp130-chr6.tsv > TMP; mv -f TMP snp130-chr6
uniq -u snp130-chr7.tsv > TMP; mv -f TMP snp130-chr7
uniq -u snp130-chr8.tsv > TMP; mv -f TMP snp130-chr8
uniq -u snp130-chr9.tsv > TMP; mv -f TMP snp130-chr9
uniq -u snp130-chr10.tsv > TMP; mv -f TMP snp130-chr10




sqlite> select count(*) from snp130_chr1;
1531003
sqlite> select count(*) from snp130_chr2;
1449308
sqlite> select count(*) from snp130_chr3;
1160854
sqlite> select count(*) from snp130_chr4;
1173169
sqlite> select count(*) from snp130_chr5;
1164876
sqlite> select count(*) from snp130_chr6;
1003069
sqlite> select count(*) from snp130_chr7;
984762
sqlite> select count(*) from snp130_chr8;
1003069
sqlite> select count(*) from snp130_chr9;
871060
sqlite> select count(*) from snp130_chr10;
814280
sqlite> select count(*) from snp130_chr11;
823979
sqlite> select count(*) from snp130_chr12;
0
sqlite> select count(*) from snp130_chr13;
546085
sqlite> select count(*) from snp130_chr14;
546085
sqlite> select count(*) from snp130_chr15;
601805
sqlite> select count(*) from snp130_chr16;
601805
sqlite> select count(*) from snp130_chr17;
507214
sqlite> select count(*) from snp130_chr18;
0
sqlite> select count(*) from snp130_chr19;
269128
sqlite> select count(*) from snp130_chr20;
399460
sqlite> select count(*) from snp130_chr21;
269128
sqlite> select count(*) from snp130_chr22;
656406
sqlite> select count(*) from snp130_chrX;
656406
sqlite> select count(*) from snp130_chrY;
97948


TROUBLESHOOTING
===============

ERROR   loading snp130-chr13

sqlite> .separator "\t"
sqlite> .import /nethome/syoung/base/pipeline/dbsnp/snp130-chr13.tsv snp130_chr13

/nethome/syoung/base/pipeline/dbsnp/snp130-chr13.tsv line 619933: expected 18 columns of data but found 5

DIAGNOSIS

LINE IS TOO SHORT

1463	chr13	115109731	115109733	rs57390673	0	+	CA	CA	-/CA	genomic	deletion	unknown	0	0	unknown	range	1
02343	0.201736	intron	exact	1
1368	chr11	102710776	102710777	rs3025092	0	-	G	G	C/T	genomic	single	by-hapmap	0.003976	0.04441	intron	exact	1


SOLUTION

EXCISE LINE BEFORE LOADING

grep -v "02343  0.201736" /nethome/syoung/base/pipeline/dbsnp/snp130-chr13.tsv > /nethome/syoung/base/pipeline/dbsnp/snp130-chr13.tsv.fixed
mv  /nethome/syoung/base/pipeline/dbsnp/snp130-chr13.tsv.fixed /nethome/syoung/base/pipeline/dbsnp/snp130-chr13
.import /nethome/syoung/base/pipeline/dbsnp/snp130-chr13.tsv snp130_chr13

OK








ERROR:

sqlite> .import /nethome/syoung/base/pipeline/dbsnp/snp130-chr1.tsv snp130_chr1
sqlite> .import /nethome/syoung/base/pipeline/dbsnp/snp130-chr2.tsv snp130_chr2

    Error: columns name, chrom, bin, chromStart, chromEnd are not unique


DIAGNOSIS:

-d FLAG OF uniq SHOWS THAT THERE ARE MANY DUPLICATED LINES
    
uniq -d /nethome/syoung/base/pipeline/dbsnp/snp130-chr2.tsv.temp
    1333    chr2    98066731        98066735        rs10578354      0       -       TGTG    TGTG    -/CA      genomic deletion        unknown 0       0       unknown range   3
    1333    chr2    98107645        98107646        rs1375441       0       +       C       C       C/T       genomic single  unknown 0       0       unknown exact   2
    ...

SOLUTION:

USE uniq WITH -u FLAG (UNIQUE ENTRIES ONLY)


cd /nethome/syoung/base/pipeline/dbsnp

uniq -u snp130-chr1.tsv > TMP; mv -f TMP snp130-chr1
uniq -u snp130-chr2.tsv > TMP; mv -f TMP snp130-chr2
uniq -u snp130-chr3.tsv > TMP; mv -f TMP snp130-chr3
uniq -u snp130-chr4.tsv > TMP; mv -f TMP snp130-chr4
uniq -u snp130-chr5.tsv > TMP; mv -f TMP snp130-chr5
uniq -u snp130-chr6.tsv > TMP; mv -f TMP snp130-chr6
uniq -u snp130-chr7.tsv > TMP; mv -f TMP snp130-chr7
uniq -u snp130-chr8.tsv > TMP; mv -f TMP snp130-chr8
uniq -u snp130-chr9.tsv > TMP; mv -f TMP snp130-chr9
uniq -u snp130-chr10.tsv > TMP; mv -f TMP snp130-chr10
uniq -u snp130-chr11.tsv > TMP; mv -f TMP snp130-chr11
uniq -u snp130-chr12.tsv > TMP; mv -f TMP snp130-chr12
uniq -u snp130-chr13.tsv > TMP; mv -f TMP snp130-chr13
uniq -u snp130-chr14.tsv > TMP; mv -f TMP snp130-chr14
uniq -u snp130-chr15.tsv > TMP; mv -f TMP snp130-chr15
uniq -u snp130-chr16.tsv > TMP; mv -f TMP snp130-chr16
uniq -u snp130-chr17.tsv > TMP; mv -f TMP snp130-chr17
uniq -u snp130-chr18.tsv > TMP; mv -f TMP snp130-chr18
uniq -u snp130-chr19.tsv > TMP; mv -f TMP snp130-chr19
uniq -u snp130-chr20.tsv > TMP; mv -f TMP snp130-chr20
uniq -u snp130-chr21.tsv > TMP; mv -f TMP snp130-chr21
uniq -u snp130-chr22.tsv > TMP; mv -f TMP snp130-chr22
uniq -u snp130-chrX.tsv > TMP; mv -f TMP snp130-chrX
uniq -u snp130-chrY.tsv > TMP; mv -f TMP snp130-chrY


CREATED removeDuplicates.pl TO REMOVE LINES WHEN FIELDS ARE DUPLICATE


sqlite> .schema snp130_chr2
CREATE TABLE snp130_chr2 (
  bin smallint(5) NOT NULL default 0,
  chrom varchar(31) NOT NULL default '',
  chromStart int(10) NOT NULL default 0,
  chromEnd int(10) NOT NULL default 0,
  name varchar(15) NOT NULL default '',
  score smallint(5) NOT NULL default 0,
  strand varchar(1) default NULL,
  refNCBI blob NOT NULL,
  refUCSC blob NOT NULL,
  observed varchar(255) NOT NULL default '',
  molType varchar(12) default NULL,
  class varchar(30) NOT NULL default unknown,
  valid varchar(30) NOT NULL default unknown,
  avHet float NOT NULL default 0,
  avHetSE float NOT NULL default 0,
  func varchar(30) NOT NULL default unknown,
  locType varchar(30) default NULL,
  weight int(10) NOT NULL default 0,
  PRIMARY KEY (name,chrom,bin, chromStart, chromEnd)

5       2      1       3          4
name, chrom, bin, chromStart, chromEnd 




chmod 755 /nethome/bioinfo/apps/agua/0.4/bin/apps/utils/removeDuplicates.pl
 
/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/removeDuplicates.pl \
--columns 5,2,1,3,4 \
--inputfile /nethome/syoung/base/pipeline/dbsnp/snp130-chr2.tsv \
--outputfile /nethome/syoung/base/pipeline/dbsnp/snp130-chr2-uniq.tsv 


NB: DID NOT USE removeDuplicates IN THE END, USED uniq INSTEAD (SEE ABOVE)


sort -c -k 5  -k 2  -k 1  -k 3  -k 4 /nethome/syoung/base/pipeline/dbsnp/snp130-chr2.tsv.temp

OK

sort -c /nethome/syoung/base/pipeline/dbsnp/snp130-chr2.tsv.temp

    sort: /nethome/syoung/base/pipeline/dbsnp/snp130-chr2.tsv.temp:2: disorder: 2398        chr2    237752053 237752054       rs1000007       0       -       T       T       A/G     genomic single  by-cluster,by-frequency,by-2hit-2allele,by-hapmap,by-1000genomes  0.40284 0.197838        unknown exact     1



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Mon May  3 12:03:51 EDT 2010
HOW DOES TOPHAT FIND JUNCTIONS 

http://tophat.cbcb.umd.edu/manual.html

How does TopHat find junctions?

TopHat finds splice junctions without a reference annotation. By first mapping RNA-Seq reads to the genome, TopHat identifies potential exons, since many RNA-Seq reads will contiguously align to the genome. Using this initial mapping, TopHat builds a database of possible splice junctions, and then maps the reads against this junction to confirm them.

Short read sequencing machines can currently produce reads 100bp or longer, but many exons are shorter than this, and so would be missed in the initial mapping. TopHat solves this problem by splitting all input reads into smaller segments, and then mapping them independently. The segment alignments are "glued" back together in a final step of the program to produce the end-to-end read alignments.

TopHat generates its database of possible splice junctions from three sources of evidence. The first source is pairings of "coverage islands", which are distinct regions of piled up reads in the initial mapping. Neighboring islands are often spliced together in the transcriptome, so TopHat looks for ways to join these with an intron. The second source is only used when TopHat is run with paired end reads. When reads in a pair come from different exons of a transcript, they will generally be mapped far apart in the genome coordinate space. When this happens, TopHat tries to "close" the gap between them by looking for subsequences of the genomic interval between mates with a total length about equal to the expected distance between mates. The "introns" in this subsequence are added to the database. The third, and strongest, source of evidence for a splice junction is when two segments from the same read are mapped far apart, or when an internal segment fails to map. With long (>=75bp) reads, "GT-AG", "GC-AG" and "AT-AC" introns be found ab initio. With shorter reads, TopHat only reports alignments across "GT-AG" introns


INTRONS
-------

TOPHAT DETECTS THE FOLLOWING TYPES OF INTRONS DEPENDENT ON THE LENGTH OF THE INPUT READS:

long reads (75+bp)      GT-AG GC-AG AT-AC introns found ab initio
short reads (<75bp)     GT-AG introns only (99% of all introns)


SCIENCE MAGAZINE INTRONS SPECIAL, March 1996
http://www.sciencemag.org/cgi/content/summary/271/5256/1690

Messenger RNAs are initially made as long precursor molecules from which final, transcribable mRNAs are assembled. A specialized organelle, the spliceosome, contains small RNAs with pairs of dinucleotides that can pick out complementary pairs of nucleotides at the ends of the introns that are to be spliced together. It has been assumed that these pairs were always GU-AG (or GT-AG in the DNA), but in findings described in this week's issue of Science (p. 1716) and the current issue of Cell (vol. 84, p. 801) a minor class of intron is shown to be flanked by AU-AC (or AT-AC in the DNA). In his Perspective, Mount explains how these maverick introns were discovered and why their existence is so surprising.



AT-AC introns (minor class ~ 0.34% of human introns?)
----------------------------------------------------

A computational scan for U12-dependent introns in the human genome sequence
Aaron Levine and Richard Durbin
http://nar.oxfordjournals.org/cgi/reprint/29/19/4006.pdf


AT-AC Pre-mRNA Splicing Mechanisms and Conservation of Minor Introns in Voltage-Gated Ion Channel Genes
Qiang Wu and Adrian R. Krainer

http://mcb.asm.org/cgi/content/full/19/5/3225

Shortly after the discovery of split genes in 1977, a conserved sequence feature at both ends of cellular and viral introns was recognized, i.e., the presence of GT at the 5' splice site and AG at the 3' splice site, giving rise to the so-called GT-AG rule (8). This rule holds in most cases, but exceptions have been found. For example, GC is occasionally found at the 5' end of certain introns (Table 1) (38). GC-AG introns are processed by the same splicing pathway as conventional GT-AG introns (3). It had long been assumed that removal of all introns from eukaryotic pre-mRNAs took place by the same splicing pathway, until recent developments demonstrated the existence of a second pre-mRNA splicing pathway.

Intron 6 of the gene encoding human P120, a proliferating cell nucleolar antigen, and intron 7 of the gene encoding human CMP, a cartilage matrix protein (matrilin 1), were the first reported examples of introns with AT and AC at the intron ends, instead of GT and AG (38). Intron 6 of the gene encoding Rep-3, a DNA repair protein, and intron 2 of the gene encoding Prospero, a Drosophila melanogaster homeodomain transcription factor, also have AT-AC ends (28). In addition to their distinctive dinucleotide ends, these and other AT-AC introns have highly conserved 5'-splice-site and presumptive branch site 8-nucleotide sequence elements that are not present in the major class of introns, ATATCCTY and TCCTTRAY, respectively. On the basis of these sequence features, it was proposed that the minor U11 and U12 snRNAs, which have regions of complementarity to these elements, are required for splicing of AT-AC introns (28). Important aspects of this prediction were soon verified experimentally (29, 100), and two additional minor snRNAs involved in the novel pre-mRNA splicing pathway were discovered (101).

The AT-AC splicing pathway was originally named after the distinctive sequences of the intron ends (100). It was later found that a few introns with AT-AC ends are processed by the major pathway (120) and, conversely, that some introns with GT-AG ends are spliced by the minor pathway (18). Therefore, the name AT-AC no longer reflects the dinucleotide intron ends per se, but rather it refers to the minor pathway itself. An alternative designation for the two pathways---U2 dependent and U12 dependent---reflects their observed or expected requirements for one of the four snRNAs specific to each pathway (86).



GC-AG introns (~0.7% of total human pre-mRNA introns)
-----------------------------------------------------


AT-AC Pre-mRNA Splicing Mechanisms and Conservation of Minor Introns in Voltage-Gated Ion Channel Genes.

GC-AG introns represent 0.7% of total human pre-mRNA introns.

Analysis of the role of Caenorhabditis elegans GC-AG introns in regulated splicing
http://www.ncbi.nlm.nih.gov/pmc/articles/PMC137088/

GC-AG introns represent 0.7% of total human pre-mRNA introns. To study the function of GC-AG introns in splicing regulation, 196 cDNA-confirmed GC-AG introns were identified in Caenorhabditis elegans. These represent 0.6% of the cDNA- confirmed intron data set for this organism. Eleven of these GC-AG introns are involved in alternative splicing.



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Mon May  3 12:01:47 EDT 2010
USE flagstat TO GET BASIC STATS FROM BAM FILE

/nethome/syoung/base/apps/samtools/0.1.6/samtools flagstat /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.bam

    6625972 in total
    0 QC failure
    0 duplicates
    4529242 mapped (68.36%)
    6625972 paired in sequencing
    0 read1
    0 read2
    1747146 properly paired (26.37%)
    2432512 with itself and mate mapped
    2096730 singletons (31.64%)
    2432512 with mate mapped to a different chr
    921959 with mate mapped to a different chr (mapQ>=5)

[syoung@u01 nospace]$ /nethome/syoung/base/apps/samtools/0.1.6/samtools flagstat /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chrY/out.bam

    6936198 in total
    0 QC failure
    0 duplicates
    4756359 mapped (68.57%)
    6936198 paired in sequencing
    0 read1
    0 read2
    1796114 properly paired (25.89%)
    2576520 with itself and mate mapped
    2179839 singletons (31.43%)
    2576520 with mate mapped to a different chr
    759814 with mate mapped to a different chr (mapQ>=5)




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Mon May  3 02:16:29 EDT 2010
USE tview TO CHECK SNPS PRODUCED BY pileup FOR CHROMOSOME 22

BASIC USAGE

samtools tview aln.sorted.bam ref.fasta

http://wiki.github.com/brentp/methylcode/using-samtools-to-view-alignments



1. INDEX BAM FILE

cd /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22

/nethome/syoung/base/apps/samtools/0.1.6/samtools index \
/scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.bam


2. VIEW ALIGNMENT USING tview

cd /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22

/nethome/syoung/base/apps/samtools/0.1.6/samtools tview  \
/scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.bam \
/nethome/bioinfo/data/sequence/chromosomes/human/hg19/nospace/chr22.fa


    1         11        21        31        41
    NNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNN

     +--------------------------------------+
     |         -=-    Help    -=-           |
     |                                      |
     | ?          This window               |
     | Arrows     Small scroll movement     |
     | h,j,k,l    Small scroll movement     |
     | H,J,K,L    Large scroll movement     |
     | ctrl-H     Scroll 1k left            |
     | ctrl-L     Scroll 1k right           |
     | space      Scroll one screen         |
     | backspace  Scroll back one screen    |
     | g          Go to specific location   |
     | m          Color for mapping qual    |
     | n          Color for nucleotide      |
     | b          Color for base quality    |
     | c          Color for cs color        |
     | z          Color for cs qual         |
     | .          Toggle on/off dot view    |
     | s          Toggle on/off ref skip    |
     | r          Toggle on/off rd name     |
     | N          Turn on nt view           |
     | C          Turn on cs view           |
     | i          Toggle on/off ins         |
     | q          Exit                      |
     |                                      |
     | Underline:      Secondary or orphan  |
     | Blue:    0-9    Green: 10-19         |
     | Yellow: 20-29   White: >=30          |
     +--------------------------------------+




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Sun May  2 12:31:07 EDT 2010
SAMtools PIPING 

http://samtools.sourceforge.net/pipe.shtml

Working on a stream

SAMtools is designed to work on a stream. You can output SAM/BAM to the standard output (stdout) and pipe it to a SAMtools command via standard input (stdin) without generating a temporary file.

For example, the following command runs pileup for reads from library libSC_NA12878_1:

samtools view -ul libSC_NA12878_1 aln.bam | samtools pileup -cf ref.fa -  


where `-u' asks samtools to output an uncompressed BAM. Option `-u' is similar to `-b', but is preferred in piping because it saves time on compression/decompression.


Similarly, you can get the pileup of a particular region with:

samtools view -u aln.bam X:1,000,000-1,100,000 | samtools pileup -  



For more complex filtering, you can print out SAM and use Unix commands to filter it.

For example, if we want to exclude reads in the read group ERR00001 and generate a new BAM, we can do in this way:

samtools view -h in.bam | grep -v "\<RG:Z:ERR00001\>" | samtools view -bS - > out.bam  


or if you want to exclude all the gapped alignments in pileup:

samtools view -h aln.bam | awk '$6!~/[ID]/' | samtools pileup -S -  


In the examples above, we only see how to combine the `view' and `pileup' commands. In fact, most of samtools commands, except indexing and external sorting, recognize an input file `-' as stdin and an output file `-' as stdout. You can run several samtools commands on one stream, which extends the ability of each single command, saves diskspace and reduces wall-clock time.

NOTE: some options in the examples are implemented in the latest SVN (r347 or above) which is not released at the time of my writing this page.



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Wed Apr 28 11:30:07 EDT 2010
PILEUP OUTPUT FORMAT


An indel occupies an additional line. Each indel line consists of chromosome name, coordinate, a star, the genotype, consensus quality, SNP quality, RMS mapping quality, # covering reads, the first alllele, the second allele, # reads supporting the first allele, # reads supporting the second allele and # reads containing indels different from the top two alleles.


EXAMPLE pileup FOR CHROMOSOME 22

head /scratch/syoung/base/pipeline/SRA/NA18507/maq/maq1/chr22/out.filter

chr22   14437955        N       A       57      0       49      10      AA-2NNAAaaAAaa  :91::9:X05
chr22   14437955        *       -NN/-NN 0       0       49      10      -NN     *       1       90
chr22   14442934        N       T       51      0       55      8       Tt-3nnntt-3nnntTTt-3nnn IHX_6451
chr22   14442934        *       -NNN/-NNN       0       0       55      8       -NNN    *       30
chr22   14443496        N       A       72      0       52      18      A$A$a$aAa*A**aA-1NAaAAaA I<FCI4:::29::18XI1
chr22   14443496        *       -N/-N   0       0       52      18      -N      *       1       10
chr22   14443734        N       A       81      0       53      18      a$AaAAAaAAAa-1nA-1NA-1NAa-1naaa   FI2I:I3441:831::4I
chr22   14443734        *       -N/-N   0       0       53      18      -N      *       4       10
chr22   14444980        N       T       78      0       59      17      TTTtttt-1nt-1ntttTttTtt ,I-187W48AA0X:9:5
chr22   14444980        *       -N/-N   0       0       59      17      -N      *       2       10



getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human/hg19/nospace/chr22.fa \
--start 14437950 \
--stop 14437960




SAMTOOLS PILEUP FILE FORMAT

    seq2  156 A  A  10  0  99  11  .$......+2AG.+2AG.+2AGGG <975;:<<<<<
    seq2  156 *  +AG/+AG  71  252  99  11  +AG  *  3  8  0



	INDEL (1ST LINE)
    ----------------

    1     2   3  4  5   6  7   8   9                        10
    seq2  156 A  A  10  0  99  11  .$......+2AG.+2AG.+2AGGG <975;:<<<<<

		1. chromosome
		2. 1-based coordinate
		3. reference base
        4. consensus base
        5. consensus quality (phred)    Phred-scaled probability that the consensus is wrong
        6. SNP quality (phred)          Phred-scaled probability that the consensus is identical to the reference. (For SNP calling, SNP quality is of more importance.)
        7. maximum mapping quality of the reads covering the sites
		8. number of reads covering the site
		9. read bases
		10. phred33 base qualities


	INDEL (2ND LINE)
    ----------------

    1     2   3  4        5   6    7   8   9    10 11 12 13
    seq2  156 *  +AG/+AG  71  252  99  11  +AG  *  3  8  0

    This line indicates that the AG insertion is supported by 3 reads; 8 reads agree with the reference according to the raw alignment; no reads support a third allele. However, SAMtools infers a AG homozygous insertion with a high score 252 because when we realign the reads with the prior of an insertion, we found that the 8 reads mapped without gaps are due to a tandem repeat. 

		1. chromosome
		2. 1-based coordinate
		3. '*' marker for 2nd line 
        4. genotype
        5. ?            ?? maximum mapping quality of the variant reads ??
        6. genotype quality
        7. maximum mapping quality of the reads covering the sites
		8. number of reads covering the site
		9. variant bases ('+' = insert, '-' = deletion)
		10. '*' marker for 2nd line
        11. no. reads that support the SNP
        12. no. reads that are identical to the reference at the SNP position
        13. no. reads that support a third allele
        

	BASIC PILEUP EXAMPLE

		seq1 272 T 24  ,.$.....,,.,.,...,,,.,..^+. <<<+;<<<<<<<<<<<=<;<;7<&



	When consensus calling is switched on (option -c is used), pileup will insert these columns:

        4. consensus base
        5. consensus quality
        6. SNP quality
        7. maximum mapping quality of the reads covering the sites
    
    between the `reference base' and the `read bases' columns. The output looks like this:
	
	seq1  60  T  T  66  0  99  13  ...........^~.^~.   9<<55<;<<<<<<



	NIMBLEGEN SNP PIPELINE OUTPUT FILES, E.G.:
		
		>Reference      Start   End     Ref     Var     Total   Var
		>Accno           Pos    Pos     Nuc     Nuc     Depth   Freq
		>CCDS3.1|Hs36.3|chr1    778     783     CTGGTG  GTGCTAT 5       60%
		>CCDS3.1|Hs36.3|chr1    1016    1016    C       T       4       100%
		>CCDS3.1|Hs36.3|chr1    1078    1078    T       C       4       100%
		>CCDS3.1|Hs36.3|chr1    1084    1084    T       C       4       100%
		>CCDS3.1|Hs36.3|chr1    1102    1102    C       T       4       100%
		>CCDS3.1|Hs36.3|chr1    1166    1166    G       A       5       80%
		>CCDS3.1|Hs36.3|chr1    1182    1182    T       C       5       100%
		>CCDS3.1|Hs36.3|chr1    1359    1359    G       A       6       100%
		



    1.25 -Uses SAMTools_' pileup command to produce a file in the pileup format based on the provided BAM file. 
    1.26 +Uses SAMTools_' pileup command to produce a pileup dataset from a provided BAM dataset. It generated two types of pileup datasets depending on chosen options. If *Call consensus according to MAQ model?* option is set to **No**, the tool produces simple pileup. If the option is set to **Yes**, a ten column pileup dataset with consensus is generated. Both types of datasets are briefly summarized below.
    1.27  
    1.28  .. _SAMTools: http://samtools.sourceforge.net/samtools.shtml
    1.29  
    1.30 +------
    1.31 +
    1.32 +**Types of pileup datasets**
    1.33 +
    1.34 +The description of pileup format below is largely based on information that can be found on SAMTools_ documentation page. The 6- and 10-column variants are described below.
    1.35 +
    1.36 +.. _SAMTools: http://samtools.sourceforge.net/pileup.shtml
    1.37 +
    1.38 +**Six column pileup**::
    1.39 +
    1.40 +    1    2  3  4        5        6
    1.41 + ---------------------------------   
    1.42 + chrM  412  A  2       .,       II
    1.43 + chrM  413  G  4     ..t,     IIIH
    1.44 + chrM  414  C  4     ...a     III2
    1.45 + chrM  415  C  4     TTTt     III7
    1.46 +   
    1.47 +where::
    1.48 +
    1.49 +  Column Definition
    1.50 + ------- ----------------------------
    1.51 +       1 Chromosome
    1.52 +       2 Position (1-based)
    1.53 +       3 Reference base at that position
    1.54 +       4 Coverage (# reads aligning over that position)
    1.55 +       5 Bases within reads where (see Galaxy wiki for more info)
    1.56 +       6 Quality values (phred33 scale, see Galaxy wiki for more)
    1.57 +       
    1.58 +**Ten column pileup**
    1.59 +
    1.60 +The `ten-column`__ pileup incoroporates additional consensus information generated with *-c* option of *samtools pileup* command::
    1.61 +
    1.62 +
    1.63 +    1    2  3  4   5   6   7   8       9       10
    1.64 + ------------------------------------------------
    1.65 + chrM  412  A  A  75   0  25  2       .,       II
    1.66 + chrM  413  G  G  72   0  25  4     ..t,     IIIH
    1.67 + chrM  414  C  C  75   0  25  4     ...a     III2
    1.68 + chrM  415  C  T  75  75  25  4     TTTt     III7
    1.69 +
    1.70 +where::
    1.71 +
    1.72 +  Column Definition
    1.73 + ------- ----------------------------
    1.74 +       1 Chromosome
    1.75 +       2 Position (1-based)
    1.76 +       3 Reference base at that position
    1.77 +       4 Consensus bases
    1.78 +       5 Consensus quality
    1.79 +       6 SNP quality
    1.80 +       7 Maximum mapping quality
    1.81 +       8 Coverage (# reads aligning over that position)
    1.82 +       9 Bases within reads where (see Galaxy wiki for more info)
    1.83 +      10 Quality values (phred33 scale, see Galaxy wiki for more)
    1.84 +
    1.85 +
    1.86 +.. __: http://samtools.sourceforge.net/cns0.shtml





http://samtools.sourceforge.net/cns0.shtml


PILEUP SUMMARY


	BASIC PILEUP EXAMPLE
	
		seq1 272 T 24  ,.$.....,,.,.,...,,,.,..^+. <<<+;<<<<<<<<<<<=<;<;7<&
		seq2 156 A 11  .$......+2AG.+2AG.+2AGGG    <975;:<<<<<
		seq3 200 A 20 ,,,,,..,.-4CACC.-4CACC....,.,,.^~. ==<<<<<<<<<<<::<;2<<

	COLUMNS
	
		1. chromosome
		2. 1-based coordinate
		3. reference base
		4. number of reads covering the site
		5. read bases
		6. base qualities

	
		NB: COLUMN 5 (read base) HAS THE FOLLOWING TYPES:
	
			. 			match to the reference base on the forward strand
			, 			match on the reverse strand, 
			ACGTN		mismatch on the forward strand 
			acgtn		mismatch on the reverse strand
			\+[0-9]+[ACGTNacgtn]+	insertion between this reference position and the next reference position. The length of the insertion is given by the integer in the pattern, followed by the inserted sequence.

			EXAMPLE: 2bp insertions on three reads:

				seq2 156 A 11  .$......+2AG.+2AG.+2AGGG    <975;:<<<<<

			EXAMPLE: 4bp deletions from the reference, supported by two reads:

				seq3 200 A 20 ,,,,,..,.-4CACC.-4CACC....,.,,.^~. ==<<<<<<<<<<<::<;2<<



PILEUP FORMAT



Pileup format is first used by Tony Cox and Zemin Ning at the Sanger Institute. It desribes the base-pair information at each chromosomal position. This format facilitates SNP/indel calling and brief alignment viewing by eyes.

The pileup format has several variants. The default output by SAMtools looks like this:

	seq1 272 T 24  ,.$.....,,.,.,...,,,.,..^+. <<<+;<<<<<<<<<<<=<;<;7<&
	seq1 273 T 23  ,.....,,.,.,...,,,.,..A <<<;<<<<<<<<<3<=<<<;<<+
	seq1 274 T 23  ,.$....,,.,.,...,,,.,...    7<7;<;<<<<<<<<<=<;<;<<6
	seq1 275 A 23  ,$....,,.,.,...,,,.,...^l.  <+;9*<<<<<<<<<=<<:;<<<<
	seq1 276 G 22  ...T,,.,.,...,,,.,....  33;+<<7=7<<7<&<<1;<<6<
	seq1 277 T 22  ....,,.,.,.C.,,,.,..G.  +7<;<<<<<<<&<=<<:;<<&<
	seq1 278 G 23  ....,,.,.,...,,,.,....^k.   %38*<<;<7<<7<=<<<;<<<<<
	seq1 279 C 23  A..T,,.,.,...,,,.,..... ;75&<<<<<<<<<=<<<9<<:<<

where each line consists of chromosome, 1-based coordinate, reference base, the number of reads covering the site, read bases and base qualities. At the read base column, a dot stands for a match to the reference base on the forward strand, a comma for a match on the reverse strand, `ACGTN' for a mismatch on the forward strand and `acgtn' for a mismatch on the reverse strand. A pattern `\+[0-9]+[ACGTNacgtn]+' indicates there is an insertion between this reference position and the next reference position. The length of the insertion is given by the integer in the pattern, followed by the inserted sequence.

Here is an example of 2bp insertions on three reads:

	seq2 156 A 11  .$......+2AG.+2AG.+2AGGG    <975;:<<<<<

Similarly, a pattern `-[0-9]+[ACGTNacgtn]+' represents a deletion from the reference. Here is an exmaple of a 4bp deletions from the reference, supported by two reads:

	seq3 200 A 20 ,,,,,..,.-4CACC.-4CACC....,.,,.^~. ==<<<<<<<<<<<::<;2<<

Also at the read base column, a symbol `^' marks the start of a read segment which is a contiguous subsequence on the read separated by `N/S/H' CIGAR operations. The ASCII of the character following `^' minus 33 gives the mapping quality. A symbol `$' marks the end of a read segment. Start and end markers of a read are largely inspired by Phil Green's CALF format. These markers make it possible to reconstruct the read sequences from pileup.

SAMtools can optionally append mapping qualities to each line of the output. This makes the output much larger, but is necessary when a subset of sites are selected.



Consensus Calling


	The pileup command is able to optionally generate the consensus sequence with the model implemented in MAQ.

	
	When consensus calling is switched on, pileup command will insert the consensus base, consensus quality, SNP quality and maximum mapping quality of the reads covering the sites between the `reference base' and the `read bases' columns. The output looks like this:
	
	seq1  60  T  T  66  0  99  13  ...........^~.^~.   9<<55<;<<<<<<
	seq1  61  G  G  72  0  99  15  .............^~.^y. (;975&;<<<<<<<<
	seq1  62  T  T  72  0  99  15  .$..............    <;;,55;<<<<<<<<
	seq1  63  G  G  72  0  99  15  .$.............^~.  4;2;<7:+<<<<<<<
	seq1  64  G  G  69  0  99  14  ..............  9+5<;;;<<<<<<<
	seq1  65  A  A  69  0  99  14  .$............. <5-2<;;<<<<<<;
	seq1  66  C  C  66  0  99  13  .............   &*<;;<<<<<<8<
	seq1  67  C  C  69  0  99  14  .............^~.    ,75<.4<<<<<-<<
	seq1  68  C  C  69  0  99  14  ..............  576<;7<<<<<8<<
	
	
	Note that consensus quality is the Phred-scaled probability that the consensus is wrong. SNP quality is the Phred-scaled probability that the consensus is identical to the reference. They are different in concept. For SNP calling, SNP quality is of more importance.
	

Short Indel Calling


Pileup also summarises short indels information by correcting the effect of flanking tandem repeats. It is important to note that SAMtools' indel caller is not perfect. A better way would be to do local de novo assembly or local multiple alignment around the candidate indel sites.

Short indels tend to occur around tandem repeats, but the alignment is much harder in these regions given short reads. Reads aligned without gaps may actually contain indels due to wrong alignment. The pileup command fixes this. Here is an example of a 2bp insertion to the reference:

seq2  151 G  G  36  0  99  12  ...........A    :9<;;7=<<<<<
seq2  152 A  A  63  0  99  12  ............    :9<;;<;<<<<<
seq2  153 A  A  63  0  99  12  ............    :7<877=<<<<<
seq2  154 A  A  66  0  99  13  .$...........^~.    :7<97<7<<<<<<
seq2  155 A  A  63  0  99  12  .$...........   7<77<;<<<<<<
seq2  156 A  A  10  0  99  11  .$......+2AG.+2AG.+2AGGG <975;:<<<<<
seq2  156 *  +AG/+AG  71  252  99  11  +AG  *  3  8  0
seq2  157 A  A  57  0  99  10  .$.$........    97<<<<<<<<
seq2  158 A  R  18  18 99  8   GG$G.....   <;;<<<<<
seq2  159 T  T  8   0  99  7   A$A$.....   3:<<<<<


The line with the 3rd column a star indicates that the AG insertion is supported by 3 reads; 8 reads agree with the reference according to the raw alignment; no reads support a third allele. However, SAMtools infers a AG homozygous insertion with a high score 252 because when we realign the reads with the prior of an insertion, we found that the 8 reads mapped without gaps are due to a tandam repeat. This scenario is clearer from the alignment viewer:


http://samtools.sourceforge.net/cns0.shtml




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Sun May  3 17:30:07 EDT 2010
CALF FORMAT AND VCF (Variant Call Format FROM 1000 GENOMES)

MOTIVATION

By avoiding the need to read in the entire alignment this allows fast access to regions of interest even with very large files, making large alignments such as deeply resequenced human genomes manageable.

IMPLEMENTATION

Paired mates and spliced alignments are pointed to using byte offsets, making it possible to jump to the relevant location in the file (using fseek, for example) without reading the intervening region.


CALF FORMAT

http://www.phrap.org/phredphrap/calf.pdf

CALF (Compact ALignment Format)

Version 0.081113

(Comments & suggestions appreciated  please send to Phil Green <phg@u.washington.edu>).

Main features:

(i) In addition to the read-to-reference (or read-to-consensus) multiple sequence alignments
(including strand, mate pair and RNAseq spliced alignment information), a CALF file records
the base qualities and mapping qualities of the aligned reads, and unaligned read data. In
particular all of the information (except prior probabilities) needed for SNP detection and
computation of genotype probabilities at each reference position is present. Since the reads &
base qualities can readily be recovered from the CALF file, arguably it could be the only file
one needs to keep following a next-gen sequencer run.

(ii) It is compact, requiring only about 2 + c bytes per reference sequence position, where c is
the average read depth. For c > 2 this is actually smaller than a FASTQ file of the reads (which
is possible by virtue of encoding a read base and its quality value in a single byte), and for c <
10 it is smaller than a GLF file constructed from the same data.

(iii) The context-dependencies in the CALF read & alignment representations are all local in the
sense that, starting from a particular alignment column, one can reconstruct the part of the
alignment surrounding that column, including the mate-pair and spliced alignment connections
and all base and mapping qualities, by reading relatively short distances forwards and
backwards in the CALF file. By avoiding the need to read in the entire alignment this allows
fast access to regions of interest even with very large files, making large alignments such as
deeply resequenced human genomes manageable. Paired mates and spliced alignments are
pointed to using byte offsets, making it possible to jump to the relevant location in the file
(using fseek, for example) without reading the intervening region.

Conceptually, the format is straightforward: Think of an ordinary text representation of a
multiple alignment, with all sequences written horizontally, and the reference as the first row.
Subsequent rows contain the reads in their aligned locations, with many reads (separated by
spaces) generally present in each row. Both the reference and the reads can contain gap
characters. We convert each alignment column to a (variable-length) 'record' by stripping out
spaces and using one byte to represent each alignment character (base or gap), together with its
quality value, that occurs in the column. A 0 byte terminates the record. Four additional bytes
per read are required to indicate when a read alignment is starting or ending and to record the
strand and mapping quality of the alignment. (The start and end markers allow unambiguous
reconstruction of the alignment from its 'stripped out' reduction). When there is a mate pair or
spliced alignment continuation, additional bytes (usually two or four per read) are needed to
point to it.

Detailed specification:

A CALF file consists of an initial free-form ASCII (plain text) section, and a data section
which may include a record-based representation of one or more multiple alignments and
unaligned reads.

1. ASCII section
This can have an arbitrary number of (\n-terminated) lines, and it is terminated by a 0 byte
(which must appear even if there is no ASCII text). 0 bytes are not allowed within the ASCII
text. Normally this section would specify (at least) the sample from which the reads were
generated (including whether it is cDNA or genomic DNA), library characteristics (e.g. insert
size distributions used for assessing mate-pair consistency), the names & versions of the
reference sequences, and the program used to produce the alignments. Some groups will want
to impose a specific format, but it is probably not desirable to make this part of the specification
because relevant information will vary by project.
2. Data section
This immediately follows the 0 byte that terminates the ASCII section, and consists of a series
of variable-length 'records' representing one or more multiple alignments, each record
corresponding either to a single alignment column, or to an uncovered segment of the reference
(i.e. a block of alignment columns in which the reference but no aligned reads occur).
Uncovered segments can be represented in either of two ways (size only, or packed sequence).
Records are byte structured, i.e. parsing of the record occurs byte by byte (although several
types of information can be present within a single byte). Each record is terminated by a 0 byte.
Each alignment is assumed to correspond to a single contiguous reference sequence. To include
more than one alignment (e.g. for the different chromosomes in a eukaryote genome), simply
concatenate them. As described in section 2.6 below, unaligned read data are included within
alignment records when the read has an aligned mate, and following the last alignment
otherwise.
An empty record (consisting only of a 0 byte) must follow the 0 byte that terminates the last
record in the last alignment. This empty record must appear even when no alignments are given.

Any data that follow it are assumed to represent unaligned reads.

The record byte structures are as follows:

2.1. First byte of a record ('record header byte'). This byte is parsed as (p, s, t)
where 0 ? p ? 15 is the value represented by the four highest-order bits, 0 ? s ? 3 is the value
represented by the next two lower-order bits, and 1 ? t ? 3 is the value represented by the two
lowest-order bits. t indicates the record type (and should never be 0):

    type 1: a single alignment column
    type 2: an uncovered reference segment for which the size (but not sequence) is given
    type 3: an uncovered reference segment for which the sequence (but not size) is given, in
    packed format.

s indicates the type of the previous record; this information is needed for the purpose of
reading backwards in the file. s = 0 when the current record is the first in an alignment
(indicating the beginning of a new reference sequence).
In a type 1 record, p indicates the (possibly ambiguous) reference sequence nucleotide
(A=1, C=2, G=4, T=8, & combinations thereof; 0 denotes a gap character in the reference). In
a type 2 or 3 record, p = 0.
The form of the remaining bytes depends upon the record type, as follows:
2.2. Type 1 record. The bytes following the header byte are (usually) parsed as (n, q),
where 0 ? n ? 3 is the value represented by the two high-order bits, and 0 ? q ? 63 is the value
represented by the remaining six bits. (Bytes immediately following a 'start marker' byte are
parsed differently, as described below). The following cases occur (depending on the values of
q and n):

    1 ? q ? 61: the byte represents a base & quality pair, with n denoting the base (A = 0, C
    = 1, G = 2, T = 3), and q = base quality + 1 (adding 1 ensures the 0 byte cannot occur). Base
    quality values higher than 60 (which essentially never occur in raw reads anyway) must be
    truncated to 60. (In principle 0 qualities should never occur either, since they imply complete
    uncertainty i.e. the base could be represented by N; but we don't enforce this).

    q = 0:
    n = 0: 0 byte (terminates record)
    n = 1: N (the only ambiguity code we allow in reads)
    n = 2: - byte (gap character; also used as mate separator in unaligned data)
    n = 3: * byte (used to delimit unaligned data (see section 2.6 below))

Bytes as above with 0 ? q ? 61 are (except for the 0 byte) referred to collectively as
'base/qual bytes'. Note that the N, -, and * bytes have values 64, 128, and 192 respectively
and are NOT the ASCII bytes representing those characters.
q = 62, n ? 0: 'start marker' byte, indicating that a new read alignment is starting in this
column. ('Start' means the beginning, or left-most end, of the read's alignment, not the 5' end of
the read). The start marker byte is followed by (in order):
(i) (Optionally) an ASCII header, consisting of a 0 byte, followed by ASCII text
(which may not contain an internal 0 byte), followed by another 0 byte. ASCII text prior to the
the first white space character ( , \n, \t, \r, vertical tab, or formfeed)  or the entire field, if no
white space character is present  is presumed to represent the read name. Text following the
first white space character is arbitrary and may be used to designate the read library or other
relevant information. The read name may be omitted by placing a white space character
immediately following the initial 0 byte. Note that the entire ASCII header is optional, as read
names are often unnecessary in next-gen sequencing data and can take up a significant amount
of space.
(ii) a 'strand/mapqual' byte in which the high-order bit indicates strand of the alignment
(0 = top, 1 = bottom), and the low order seven bits represent 1 + mapping quality of the read (0
? mapqual ? 100) (Mapping qualities are defined in (Li, Ruan, & Durbin, Genome Res 2008))
(iii) 2n bytes that point to a spliced alignment or mate pair continuation for this read's
alignment, using the format described in section 2.5 below (n = 0 means there is no
continuation)
(iv) an identical copy of the start marker byte (needed for unambiguous parsing when
reading backwards in the file)
(v) * bytes and base/qual bytes representing the unaligned portion of the read (and/or
unaligned mate) at this end, if any (see section 2.6)
(vi) the base/qual byte corresponding to the first aligned base of the read
The first of the two start marker bytes is called a 'start/start' marker byte.
q = 63, n > 0: 'start marker' byte. As above, except that 4n rather than 2n bytes are
reserved for the continuation pointer information, with the extra 2n bytes used to represent the
offset in reference sequence co-ordinates.
q = 63, n = 0: 'end marker' byte, indicating that the preceding byte is a base/qual byte
corresponding to the last aligned base of a read. If there is an unaligned segment of the read
(and/or an unaligned mate) at this end (section 2.6), it is put between the end marker byte and
the last aligned base/qual byte.
2.3. Type 2 record. There are four bytes following the header byte, giving the size of the
uncovered segment as an unsigned positive integer in big-endian format (to ensure crossplatform
compatibility). (Size 0 segments are not permitted).
2.4. Type 3 record. The bytes following the header byte give a packed representation
(allowing ambiguous nucleotides) of the uncovered segment's sequence, with each byte
representing a successive dinucleotide: bytes are parsed as (p, r) with 1 ? p ? 15 representing
the first base (using the same conventions as for a type 1 record header byte) and 0 ? r ? 15 the
second base; r = 0 only in the last byte for a region that has an odd number of bases. The
segment must have at least one base.
2.5. Continuation pointers. The 2n bytes used to represent the continuation pointer
following a strand/mapqual byte are parsed as follows: In the first byte, the four highest order
bits are parsed as (a, b, c) where 0 ? a ? 3 (encoded by the two highest-order bits) indicates the
type of continuation: a = 0 means spliced alignment, while a > 0 means mate pair continuation
with the value of a roughly indicating library insert size (1 = small insert, 2 = medium, 3 =
large); b = 0 if the continuation has orientation and spacing consistent with library expectations,
5
and = 1 otherwise; and c indicates which end of the current reads alignment the continuation is
from: 0 = start, 1 = end.
The remaining 16n - 4 bits of the 2n bytes represent a signed integer giving the byte offset to
that continuation, computed as the byte location of the start/start marker byte of the
continuation, minus the current start/start byte location; thus upstream continuations have
negative offsets while downstream continuations have positive offsets. To ensure platform
independence and simplify parsing, integers are represented as follows: the highest-order bit
(immediately following the c bit above) is the sign bit (1 for a negative integer and 0
otherwise), while the remaining 16n  5 bits represent the absolute value of the offset, in bigendian
format. (Note that for negative integers this is NOT the commonly used 2s complement
convention.) Continuations may go into a different alignment (chromosome), or to an unaligned
read. In the latter case, the data for the unaligned mate should be included at the appropriate
end of the aligned read as described in section 2.6 below, and the byte offset value should be set
to 0.
Since up to 44 bits are available to represent the offset, multi-terabyte files can be
accommodated.
For start markers of type q = 63, n > 0 the above 2n bytes are immediately followed by
another 2n bytes representing a signed integer (using the above convention) that gives the offset
in reference sequence coordinates rather than bytes. (There are no special bits in these bytes.)
Reference coordinates follow the convention defined in section 2.8 below.
2.6. Unaligned reads and read segments. Unaligned segments at the beginning or end
of a read may be included by putting a byte sequence that consists of a * byte, followed by the
base/qual bytes for the segment, followed by another * byte, just after the copy of the start
marker byte, or just before the end marker byte (as appropriate) for the read. Data for the
unaligned mate of an aligned read is also included in this way, using 1, 2, or 3 - bytes at the
appropriate end of the unaligned reads sequence (see below) to designate it as such. One can
include both an unaligned portion of the aligned read, and an entire unaligned mate, at the same
end of the aligned portion of the read.
Unaligned reads not mated to an aligned read are placed after the empty record that follows the
last alignment (these reads may not be pointed to by any aligned read). Such data are given as a
sequence of r base/qual bytes, where r is the read length, followed by a 0 byte. Optionally, an
ASCII header may be included by placing the following immediately in front of the r base/qual
bytes: a start-marker byte (with n = 0), followed by a 0 byte, followed by ASCII text, followed
by another 0 byte, followed by another start-marker byte. (Note that start-marker bytes are
needed only when an ASCII header is included, and that end-marker bytes, mapqual bytes, and
continuation pointer bytes are never used.) A pair of unaligned mates are represented as a
single sequence in which the (usually uncomplemented) first read is followed by one, two or
three - bytes (to indicate library insert size category), followed by the (usually reverse
complemented) mate read. The - bytes thus implicitly represent the (unknown) sequence
between the two mates. The 0 byte that terminates one unaligned read's (or read-pairs) data is
followed immediately by the data for the next unaligned read.
6
2.7. Tags. A base of the reference may be tagged by including a 0-length read  i.e. one
for which the end marker byte immediately follows the start marker byte copy, and there are no
aligned base/qual bytes  at the corresponding location. The text of the tag is placed into an
ASCII header field for the read. Similarly a segment of the reference may be tagged by
including a mate pair of 0-length reads that flank the segment.
2.8. Reference sequence coordinates. To accommodate offsets between distinct
reference sequences while also allowing for gaps in the reference, we adopt the following
coordinate convention: bases of the 1st reference sequence (of length a bases) have coordinates
1 through a, bases of the 2d reference sequence (of length b) have coordinates a + 2 (rather than
a + 1) through a + b + 1, etc. Gap characters within a reference sequence are assigned the
coordinate of the nearest reference base to the left. Gaps past the right end of a reference
sequence are assigned the coordinate of the last reference base, while gaps preceding the left
end of a reference sequence are assigned a coordinate one less than the first reference sequence
base. (Such gaps occur when an aligned read extends beyond the reference sequence to which it
is aligned. The reason for skipping a base coordinate position between two successive
reference sequences is to allow gaps at the right end of the first reference to have distinct
coordinates from those at the left end of the second reference).
Notes:
(1) Indexing into a CALF file may be needed for rapidly accessing particular sites in the
reference sequences or reads. (Note however that sequences, quality values, pointers to mate
pairs, and read names or information about particular reads need not be stored separately, as
they all can be included in the CALF file; and that ASCII headers, and tags (2.7 above), are
flexible enough to accommodate most internal labeling requirements.) We have not yet
specified a standard format for index files, but some reasonable principles are
(i) indices should refer to CALF file locations by (absolute) byte number within the file;
(ii) in addition to the byte number, the index should also give the (absolute) reference
sequence co-ordinate (using 1 for the first base in the first reference sequence, and 0 for
unaligned reads);
(iii) the only types of file bytes that should be referenced are record header or terminator
bytes, base/qual bytes not lying within unaligned reads or read segments, start/start or end
marker bytes, and bytes internal to a type 3 (uncovered reference region in packed format)
record. As discussed in note (4) below, except for type 3 record bytes all of these byte types are
mutually distinguishable from each other by examining their low order 6 bits and the previous
byte, so the index only needs to indicate whether or not the byte is a type 3 record byte.
One possible format for an index file is an ASCII file in which successive lines give a
byte location (as ASCII digits, and for type 3 record bytes only, a suffix _0 or _1 indicating
the low order four bits or the high order four bits respectively  the suffix has the dual purpose
of indicating that it is a type 3 record byte and specifying the precise reference sequence
7
nucleotide), followed by a reference sequence co-ordinate, optionally followed by a feature (e.g.
start of a new chromosome) and any ancillary information regarding the feature.
(2) CALF files consisting solely of a reference sequence in packed format, or solely of
unaligned reads, are consistent with the specification. For example, the latter case would be
indicated by having two consecutive 0 bytes between the initial ASCII text and the unaligned
read data.
(3) Extraneous gap characters should always be deleted from uncovered regions of the
reference before conversion to CALF format, to ensure that 0 bytes do not occur within type 3
records and that the region size in a type 2 record is unambiguous. Note that very small
uncovered regions may be more efficiently represented using several type 1 records (each
consisting of a header byte + terminator) than type 2 or 3.
(4) File parsing issues: The specification is designed to permit unambiguous parsing of the
alignment (or unaligned reads) while reading either forwards or backwards in the file, starting
from any byte that heads or terminates a record or that is of base/qual, start/start or end marker
type (excluding base/qual bytes within unaligned reads or read segments). The type of any such
byte can be determined by virtue of (i) the value q of the low-order 6 bits satisfies q = 62 or 63
for start and end marker bytes, but 0 ? q ? 61 for record header and base/qual bytes, and (ii)
header bytes are always preceded by a 0 byte whereas base/qual bytes outside of unaligned
reads or read segments never are. Strand/mapqual bytes, bytes within continuation pointers,
bytes within ASCII headers of reads, or interior bytes of type 2 or type 3 records are not
internally distinguishable in this manner, but do not cause a problem during forwards or
backwards parsing starting from one of the other byte types, because their locations are known
by virtue of the surrounding start marker bytes or record type indicators, together with the facts
that type 2 records are of fixed size, whereas type 3 records never contain internal 0 bytes.
Parsing can also start within a type 3 record provided it is known to be such, using the fact that
0 bytes delimit the record boundaries.
The initial ASCII section is not necessarily internally recognizable but does not need to be, as it
is not indexed into from the data section.
Forwards parsing will always succeed all the way to the end of the file, but backwards parsing
may only succeed as far as the beginning of the current alignment (because the type of the last
record in the preceding alignment is not known). 'Jumping' to another alignment via
continuation pointers and further parsing within that alignment always succeeds, in either
direction.
(5) Most operations on CALF files are straightforward, and do not require much memory
provided one uses an appropriate indexing scheme. As an example, we outline a simple
algorithm that can be used to merge several CALF files having the same reference sequence(s)
but different sets of aligned reads: The to-be-merged input files are read in parallel record by
record while simultaneously writing the new file, keeping in memory essentially just the current
merged record as it is being constructed and, for each input file, an index of byte locations of
read starts in the input and merged files. At each successive position in the reference sequence,
8
create an initial merged type 1 (alignment column) record by concatenating the type 1 records
at that position from the input files (stripping out the extra copies of the header and terminator
bytes), and then modify this record as follows:
(i) for start markers pointing to downstream continuations:
(a) increase the number of allocated continuation pointer bytes if necessary, to
be sure they are enough to be able to represent the new pointer value in the merged file once it
is known (which won't be until later)  when in doubt, use the maximum of 6 bytes (setting n =
3 in the start-marker byte). Keep all of the other continuation pointer information (including the
special bit values, and the numerical value of the byte offset) the same as in the input file.
(b) put into the in-memory index for this file an entry that indicates the byte
locations of the start marker in the input file, and in the merged file (which is now known
because the merged file is being concurrently written).
(ii) for start markers pointing to upstream continuations:
(a) compute the input file byte location of the upstream continuation start marker
(by adding the input file byte location of the current start marker to the input file byte offset)
and use this to look up in the index the corresponding location in the merged file;
(b) compute the new (merged file) byte offset, by subtracting the merged file
location of the current start from that of the upstream continuation start. If the new offset is
different from the old (input file) offset, then put the new offset into the continuation pointer for
the current start (using as few bytes as possible), and rewrite the offset value at the upstream
start marker in the merged file to be the negative of the new offset (without changing the
number of bytes previously allocated as in (i) (a) above, so as not to invalidate intervening byte
offsets). Keep other information at the current start marker the same.
(d) delete the index entry for the upstream start marker.
Then write the merged record into the new file.
There are some additional bookkeeping issues related to uncovered region (type 2 and 3)
records, which need to be appropriately altered since these regions will differ among the input
files, and to the fact that gaps in the reference may differ among the merged files.
Since an index entry is deleted as soon as the downstream mate is reached, which is usually
quite soon, in general the indices do not get very large. However, the above strategy can
involve a fair amount of non-sequential disk access in order to rewrite the continuation pointer
bytes at the upstream mates. To reduce this, one can keep a few thousand records for the
growing merged file in memory before writing, updating their pointer information in memory
when possible.
Removing duplicates, or making other changes to the alignment or to the file (for example,
reducing the number of bytes used for continuation pointers at upstream mates following the
initial construction of a CALF file) can be handled using a similar approach  in such cases one
would have a single input file and an output file. Note that if only minor changes to the
alignment are involved (for example, removal of one read) the entire process will be quite fast
because, with the above algorithm, non-sequential disk accesses are required only for those
continuation pointers that bridge all or part of the modified region.

One can use a similar indexing approach in alignment programs to create an initial CALF file
from an internal representation of the alignments (roughly speaking, this is a little like merging
a large number of separate files each with one aligned read or mate pair).

(6) There is some redundancy/inefficiency in the specification, which conceivably could be
removed:

(i) In principle one only needs to specify upstream continuations, or only downstream
continuations, rather than both, since the other can be inferred. However the cost of this is
context-dependence locality  e.g. if only upstream continuations are specified, one might need
to read all the way to the end of the file before knowing the location of a reads downstream
continuation.
(ii) If one starts from a (conceptual) alignment in which there is only one read per row,
then one always knows how many reads are 'active' in a given alignment column, so the need
for a separate start byte could be avoided (any unexpected non-zero/non-end-marker byte would
imply the beginning of a new read). One could probably also avoid having a second copy of the
start marker byte by cleverer encoding. However, this would complicate parsing backwards
(and merging), for relatively little savings.
(iii) Instead of using byte locations to define the continuation pointers, one could instead
keep a counter value which increases by 1 each time a start/start or end byte is encountered as
the alignments and unaligned reads are processed. Thus the value assigned to a start or end
occurring within a column C of the alignment would be 2N + M, where N is the number of
'completed' reads (reads for which the read end lies either entirely to the left of C, or within C
but above the position being considered), and M is the number of reads which have started but
not yet ended. The continuation pointer would then be computed as a difference in counter
values rather than byte values. This method has the advantages over byte offsets of being
independent of the specific byte representation of the alignments, and of often requiring fewer
bytes, but it forfeits the ability to rapidly access the relevant file location without an index.
Comments & suggestions are appreciated  please send to Phil Green at phg@u.washington.edu.


I thank Heng Li and Richard Durbin for comments on an earlier draft.

Version notes:
0.080914: first to be distributed
0.080915: clarifies byte-parsing notation
0.080922: allow placing of unaligned mates near their aligned mates, up to three mate-pair
size-insert libraries, refseq co-ordinate offsets.
0.080925: allow inclusion of unaligned parts of read, simpler format for unaligned read
data. Algorithm for merging CALF files (in notes).
0.080926: change mate-separator character in unaligned data to - (to avoid conflict with
delineators of unaligned segments)
0.081003: allow optional ASCII headers for reads
0.081113: clarifies format for representing negative continuation pointers, and that
uncovered reference segments cannot have length 0; imposes conventions regarding location of
10
read names within ASCII headers, use of 0 length reads to tag sites or segments in reference,
and co-ordinate system for reference sequences.



VCF FORMAT

http://1000genomes.org/wiki/doku.php?id=1000_genomes:analysis:vcfv3.2


VCF (Variant Call Format) version 3.2

0. Example

VCF is a text file format (most likely stored in a compressed manner). It contains metainformation lines, a header line, and then data lines each containing information about a position in the genome.

There is an option whether to contain genotype information on samples for each position or not.

Example:

    ##format=PCFv1
    ##fileDate=20090805
    ##source=myImputationProgramV3.1
    ##reference=1000GenomesPilot-NCBI36
    ##phasing=partial
    #CHROM  POS     ID        REF   ALT    QUAL  FILTER  INFO                                 FORMAT       NA00001         NA00002         NA00003
    20      14370   rs6054257 G     A      29    0       NS=58;DP=258;AF=0.786;DB;H2          GT:GQ:DP:HQ  0|0:48:1:51,51  1|0:48:8:51,51  1/1:43:5
    20      13330   .         T     A      3     q10     NS=55;DP=202;AF=0.024                GT:GQ:DP:HQ  0|0:49:3:58,50  0|1:3:5:65,3    0/0:41:3
    20      1110696 rs6040355 A     G,T    67    0       NS=55;DP=276;AF=0.421,0.579;AA=T;DB  GT:GQ:DP:HQ  1|2:21:6:23,27  2|1:2:0:18,2    2/2:35:4
    20      10237   .         T     .      47    0       NS=57;DP=257;AA=T                    GT:GQ:DP:HQ  0|0:54:7:56,60  0|0:48:4:51,51  0/0:61:2
    20      123456  microsat1 G     D4,IGA 50    0       NS=55;DP=250;AA=G                    GT:GQ:DP     0/1:35:4        0/2:17:2        1/1:40:3


This example shows in order a good simple SNP, a possible SNP that has been filtered out because its quality is below 10, a site at which two alternate alleles are called, with one of them (T) being ancestral (possibly a reference sequencing error), a site that is called monomorphic reference, i.e. with no alternate alleles, and a microsatellite with two alternative alleles, one a deletion of 4 bases, and the other an insertion of two bases (GA). Genotype data are given for three samples, two of which are phased and the third unphased, with per sample genotype quality, depth and haplotype qualities given as well as the genotypes (the latter only for the phased samples). The microsatellite calls are unphased.











++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Wed Apr 14 03:14:11 EDT 2010
TEST SUITE DOS COMMAND TO REDIRECT STDERR


E:\0.4\bin\apps\t>perl 04.Filter-SNP.t > out2 2<&1



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Wed Apr 14 03:14:11 EDT 2010
INSTALLED COMPLETE ccds SEQUENCE TABLE (42 MB TEXT FILE) FOR SNP FILTER 

PROBLEM
=======

TEST SUITE SQLITE DATABASE ccdsSeq TABLE MISSING THIS SEQUENCE:

sqlite> SELECT sequence from ccdsSeq WHERE id='CCDS48208.1';


EVEN THOUGH IT'S IN THE ccdsGene TABLE:

sqlite> SELECT * from ccdsGene WHERE name='CCDS48208.1';

750     CCDS48208.1     chrY    +       21749110        21751989        21749110
        21751989        3       21749110,21751406,21751968,     21749393,2175149
8,21751989,     0               cmpl    cmpl    0,1,0,


BUT SEQUENCE IS PRESENT IN UCSC DOWNLOAD OF CCDS:

CCAGGCTAGCTCTTCAACCATCACCACTGGACAAATATCACCCTAATTAC
AACTGA
>hg19_ccdsGene_CCDS48208.1 range=chrY:21749111-21751989 5'pad=0 3'pad=0 strand=+ repeatMasking=none
ATGGAAGAAGCTGGACTTTGTGGGTTAAGAGAGAAAGCAGATATGTTGTG
TAACTCTGAATCACATGATATTCTTCAACATCAAGACTCAAATTGCAGTG
CCACAAGTAATAAACATTTATTGGAAGATGAAGAAGGCCGTGACTTTATA
ACAAAGAACAGGAGTTGGGTGAGCCCAGTGCACTGCACACAAGAGTCAAG
AAGGGAGCTTCCTGAGCAAGAAGTAGCCCCTCCGTCTGGTCAGCAAGCTT
TACAATGCAACAGGAACAAAGAAAAAGTCTTAGGAAAAGAAGTTTTATTA
TTGATGCAAGCCCTAAACACTCTTTCGACTCCAGAGGAGAAGCTGGCAGC
TCTCTGTAAGAAATATGCTGATCTTGGAAATTCACCTCTTCTATAG


SOLUTION
========

1. CREATE MYSQL ON ngsdev:

CREATE TABLE ccdsSeq (
    id VARCHAR(20),
    sequence TEXT,
    primary key(id)
)


2. DOWNLOAD FASTA FILE AND PARSE OUT HEADER AND SPACE TO LEAVE TSV:

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/nospaces.pl --inputfile /nethome/syoung/base/pipeline/snpfilter/ccds/ccds-seq --outputfile '
 
perl -i -p -e "s/hg19_ccdsGene_//g" ccds-nospace.fa
perl -i -p -e "s/range=[^\n]+\n//g" ccds-nospace.fa
perl -i -p -e "s/>//g" ccds-nospace.fa



3. LOAD INTO ngsdev DATABASE

LOAD DATA INFILE /nethome/syoung/base/pipeline/snpfilter/ccds/ccds-nospace.fa INTO TABLE ccdsSeq;


        LOAD DATA local INFILE '/nethome/syoung/base/pipeline/snpfilter/ccds/ccds-nospace.fa' INTO TABLE ccdsSeq;
        Query OK, 23731 rows affected, 47508 warnings (4.26 sec)
        Records: 23754  Deleted: 0  Skipped: 23  Warnings: 47508


4. INSERT ROW WHEN IT FAILS TO LOAD:


INSERT INTO ccdsSeq values('CCDS48208.1', 'ATGGAAGAAGCTGGACTTTGTGGGTTAAGAGAGAAAGCAGATATGTTGTGTAACTCTGAATCACATGATATTCTTCAACATCAAGACTCAAATTGCAGTGCCACAAGTAATAAACATTTATTGGAAGATGAAGAAGGCCGTGACTTTATAACAAAGAACAGGAGTTGGGTGAGCCCAGTGCACTGCACACAAGAGTCAAGAAGGGAGCTTCCTGAGCAAGAAGTAGCCCCTCCGTCTGGTCAGCAAGCTTTACAATGCAACAGGAACAAAGAAAAAGTCTTAGGAAAAGAAGTTTTATTATTGATGCAAGCCCTAAACACTCTTTCGACTCCAGAGGAGAAGCTGGCAGCTCTCTGTAAGAAATATGCTGATCTTGGAAATTCACCTCTTCTATAG');
Query OK, 1 row affected (0.00 sec)


++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Wed Apr  7 00:59:29 EDT 2010
FILTER CHROMOSOME 22 TEST DATA BY CCDS 


DOWNLOAD snp130 SQL FILE
wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/snp130.sql


CREATE snp130 TABLE IN snpfilter.dbl
====================================

.read E:/base/pipeline/snpfilter/snp130/snp130-sqlite.sql

    CREATE TABLE snp130 (
      bin smallint(5) NOT NULL default 0,
      chrom varchar(31) NOT NULL default '',
      chromStart int(10) NOT NULL default 0,
      chromEnd int(10) NOT NULL default 0,
      name varchar(15) NOT NULL default '',
      score smallint(5) NOT NULL default 0,
      strand varchar(1) default NULL,
      refNCBI blob NOT NULL,
      refUCSC blob NOT NULL,
      observed varchar(255) NOT NULL default '',
      molType varchar(12) default NULL,
      class varchar(30) NOT NULL default unknown,
      valid varchar(30) NOT NULL default unknown,
      avHet float NOT NULL default 0,
      avHetSE float NOT NULL default 0,
      func varchar(30) NOT NULL default unknown,
      locType varchar(30) default NULL,
      weight int(10) NOT NULL default 0,
      PRIMARY KEY (name,chrom,bin, chromStart, chromEnd)
    );


.separator "\t"

.import E:/0.4/bin/apps/t/04-Filter-SNP/inputs/chrY/snp130-chrY.txt snp130



CREATE TABLE ccdsGene IN snpfilter.dbl
======================================

.read E:/0.4/bin/apps/t/04-Filter-SNP/inputs/chrY/ccdsGene-sqlite.sql

CREATE TABLE ccdsGene (
    bin smallint(5) NOT NULL,
    name varchar(255) NOT NULL,
    chrom varchar(255) NOT NULL,
    strand char(1) NOT NULL,
    txStart int(10) NOT NULL,
    txEnd int(10) NOT NULL,
    cdsStart int(10) NOT NULL,
    cdsEnd int(10) NOT NULL,
    exonCount int(10) NOT NULL,
    exonStarts longblob NOT NULL,
    exonEnds longblob NOT NULL,
    score int(11) NOT NULL,
    name2 varchar(255) NOT NULL,
    cdsStartStat TEXT NOT NULL,
    cdsEndStat TEXT NOT NULL,
    exonFrames longblob NOT NULL,
    PRIMARY KEY (chrom,bin, name)
);

.separator "\t"

.import E:/0.4/bin/apps/t/04-Filter-SNP/inputs/chrY/ccdsGene-chrY.txt ccdsGene




** USED EXISTING ccdsSeq TABLE IN snpfilter.dbl ** 


###CREATE TABLE ccdsSeq IN snpfilter.dbl
###=====================================
###
###
###.read E:/0.4/bin/apps/t/04-Filter-SNP/inputs/chrY/ccdsSeq-sqlite.sql
###
###CREATE TABLE ccdsSeq (
###    name        varchar(30) NOT NULL,
###    chromosome  varchar(30) NOT NULL,
###    start       varchar(30) NOT NULL,
###    stop        varchar(30) NOT NULL,
###    strand      varchar(30) NOT NULL,
###    sequence    TEXT NOT NULL,
###   
###   PRIMARY KEY (name, chromosome) 
###);
###
###
###.separator "\t"
###.import E:/0.4/bin/apps/t/04-Filter-SNP/inputs/chrY/ccdsSeq-chrY.txt ccdsSeq
###
###
###DOWNLOADED SEQUENCE FOR CCDS 
###
###perl -p -i -e "s/\*/-/g" ccds-chr22.seq
###[syoung@u03 chr22]$ perl -p -i -e "s/\+\s+\-/+/g" ccds-chr22.seq
###[syoung@u03 chr22]$ perl -p -i -e "s/CCDS/\nCCDS/g" ccds-chr22.seq
###[syoung@u03 chr22]$ em ccds-chr22.seq
###
###    ...    
###    CCDS42975.1     chr22   17264509        17288963        -       ATGGAGACAGTGTTTGAAGAG
###    ...





++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Wed Apr  7 00:55:29 EDT 2010
SORT CHROMOSOME 22 TEST DATA FILE 454HCDiffs-header-chr22.txt

CREATE FileTools::sort AND sortfile.pl

chmod 755 /nethome/bioinfo/apps/agua/0.4/bin/apps/utils/sortfile.pl

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/sortfile.pl \
--inputfile /nethome/syoung/base/pipeline/snpfilter/sortfile/454HCDiffs-header-chr22.txt \
--outputfile /nethome/syoung/base/pipeline/snpfilter/sortfile/454HCDiffs-header-chr22-sorted.txt \
--column 2 \
--numeric 


    >CCDS13750.1|Hs36.3|chr22	665	665	A	CC	3	100%
    >CCDS13753.1|Hs36.3|chr22	275	287	TCAGGCAGGCGCT	GCGGGGGCA	7	43%
    >CCDS13753.1|Hs36.3|chr22	374	377	CGGT	TACTGG	3	100%
    >CCDS13754.1|Hs36.3|chr22	865	865	T	A	8	87%
    >CCDS13758.1|Hs36.3|chr22	279	279	T	C	3	100%
    >CCDS13758.1|Hs36.3|chr22	291	291	G	A	3	100%

                            |
                            |
                            |
                            V

    >CCDS13891.1|Hs36.3|chr22	15	15	G	A	3	100%
    >CCDS43037.1|Hs36.3|chr22	25	25	G	C	3	100%
    >CCDS13775.1|Hs36.3|chr22	33	33	T	C	3	100%
    >CCDS43037.1|Hs36.3|chr22	36	36	G	A	3	100%
    >CCDS13841.1|Hs36.3|chr22	37	37	A	CAC	3	100%
    >CCDS43037.1|Hs36.3|chr22	40	40	G	A	3	100%
    >CCDS13775.1|Hs36.3|chr22	44	44	C	T	3	100%
    


AND IN REVERSE IF NEEDED:

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/sortfile.pl \
--inputfile /nethome/syoung/base/pipeline/snpfilter/sortfile/454HCDiffs-header-chr22.txt \
--outputfile /nethome/syoung/base/pipeline/snpfilter/sortfile/454HCDiffs-header-chr22-sorted-reverse.txt \
--column 2 \
--numeric \
--reverse

    [syoung@u01 sortfile]$ head *reverse*
    >CCDS33603.1|Hs36.3|chr22       6097    6097    G       A       10      30%
    >CCDS33603.1|Hs36.3|chr22       5733    5733    T       C       9       100%
    >CCDS33603.1|Hs36.3|chr22       5568    5568    C       T       10      30%
    >CCDS33603.1|Hs36.3|chr22       5500    5501    GG      A       9       78%
    >CCDS33603.1|Hs36.3|chr22       5376    5377    GG      AC      6       83%
    >CCDS33603.1|Hs36.3|chr22       5310    5310    C       T       5       60%
    >CCDS33603.1|Hs36.3|chr22       5132    5132    A       C       5       100%
    >CCDS33603.1|Hs36.3|chr22       5072    5072    A       G       5       100%
    >CCDS33603.1|Hs36.3|chr22       5065    5065    A       G       12      33%
    >CCDS33603.1|Hs36.3|chr22       4998    4998    C       G       13      69%


open failed:

/nethome/syoung/base/pipeline/snpfilter/sortfile/454HCDiffs-header-chr22.txt-sorted.txt

http://www.pixelbeat.org/cmdline.html

	sort file1 file2 | uniq	Union of unsorted files
 	sort file1 file2 | uniq -d	Intersection of unsorted files
 	sort file1 file1 file2 | uniq -u	Difference of unsorted files
 	sort file1 file2 | uniq -u	Symmetric Difference of unsorted files
 	join -t'\0' -a1 -a2 file1 file2	Union of sorted files
 	join -t'\0' file1 file2	Intersection of sorted files
 	join -t'\0' -v2 file1 file2	Difference of sorted files
 	join -t'\0' -v1 -v2 file1 file2	Symmetric Difference of sorted files


NAME
       sort - sort lines of text files

SYNOPSIS
       sort [OPTION]... [FILE]...

DESCRIPTION
       Write sorted concatenation of all FILE(s) to standard output.

       Mandatory arguments to long options are mandatory for short options to
o.  Ordering options:

       -b, --ignore-leading-blanks
              ignore leading blanks

       -d, --dictionary-order
              consider only blanks and alphanumeric characters

       -f, --ignore-case
              fold lower case to upper case characters

       -g, --general-numeric-sort
              compare according to general numerical value

       -i, --ignore-nonprinting
              consider only printable characters

       -M, --month-sort
              compare (unknown) < JAN < ... < DEC

       -n, --numeric-sort
              compare according to string numerical value

       -r, --reverse
              reverse the result of comparisons

       Other options:

       -c, --check
              check whether input is sorted; do not sort

       -k, --key=POS1[,POS2]
              start a key at POS1, end it at POS2 (origin 1)

       -m, --merge
              merge already sorted files; do not sort

       -o, --output=FILE
              write result to FILE instead of standard output

       -s, --stable
              stabilize sort by disabling last-resort comparison

       -S, --buffer-size=SIZE
              use SIZE for main memory buffer

       -t, --field-separator=SEP
              use SEP instead of non-blank to blank transition

       -T, --temporary-directory=DIR
              use DIR for temporaries, not $TMPDIR or  /tmp;  multiple  optio
ns  specify  multiple
              directories

       -u, --unique
              with  -c,  check  for strict ordering; without -c, output only 
the first of an equal
              run

       -z, --zero-terminated
              end lines with 0 byte, not newline

       --help display this help and exit

       --version
              output version information and exit

       POS is F[.C][OPTS], where F is the field number and C the character po
sition in the  field.
       OPTS  is one or more single-letter ordering options, which override gl
obal ordering options
       for that key.  If no key is given, use the entire line as the key.

       SIZE may be followed by the following multiplicative suffixes: % 1% of
 memory, b 1, K  1024
       (default), and so on for M, G, T, P, E, Z, Y.

       With no FILE, or when FILE is -, read standard input.

       ***  WARNING  *** The locale specified by the environment affects sort
 order.  Set LC_ALL=C
       to get the traditional sort order that uses native byte values.


http://www.pixelbeat.org/docs/env.html


Each process on linux has an associated list of name value pairs called the environment. A process can manipulate its environment and the environment of its children, but not vice versa. In a shell process one can interactively control the environment, including controlling what variables are provided (exported) to child processes.
setting local variables
To set a variable in the shell's environment only, you do name=value in bash, and set name=value in tcsh.
setting variables seen by children
To create an exported variable, you do export name=value in bash, and setenv name value in tcsh respectively.
setting just for children
Another thing to note is that bash allows you to set a variable just for the subprocess with name=value program. For e.g. LANG=C sort will set the LANG=C variable for the sort program, while leaving the shell's LANG variable alone. The same thing can be achieved in tcsh with the env program. For e.g. env LANG=C sort
reading variables
To refer to a particular name one uses $name, so you can do echo $name for e.g. In bash, you can see all variables using the set command, and all exported variables using printenv program. For tcsh set shows variables that are not exported, and printenv is the same as for bash except that it's a shell builtin.
Environment uses
An environment variable can be used for any purpose by a process. In the example above, "sort" will sort in ASCII order when LANG=C. In the shell, environment variables are commonly used while programming, for standard variable storage. Also in the shell, special variable names can be used to communicate to and from the shell. An example of communication to the shell is, setting the PATH variable will tell the shell in which directories to look for commands. An example of communication from the shell is, the shell always sets the PWD variable appropriately as the current working directory is changed. Considering that children inherit the exported environment of their parent, and most processes can trace their ancestry to a shell, the shell startup files are a very common/handy place to set environment variables. To get details on these startup files, for bash at least, do: info bash "Bash Features" "Bash Startup Files".



 LATER, FOR WINDOWS
 http://www.trilug.org/~chilcote/Perl/flatfiles.html

	## OPEN FILE AND READ INTO lines
	open(FILE, $inputfile) or die "Can't open input file: $inputfile\n";
	my $lines;
    my $i = 0;
    while (<FILE>) { $$lines[$i++] = $_; }
	
    sub byColumn {
		while ( a_array 
		my $aa = 
		
		((substr $a, 8, 12) cmp (substr $b, 8, 12)); }
	
     sort the array of rows using name sort into sorted_lines array
    my @sorted_lines = sort byColumn @$lines;
    
     write sorted array to standard output
    foreach my $line (@sorted_lines) { print $line; }	

sub specificSort2
{
    @first = split( '\t', $a );
    @second = split( '\t', $b );

    $compare = ( $first[2] cmp $second[2] );           # job number
    if ( $compare != 0 ) { return ( $compare ); }

    $compare = ( $first[6] cmp $second[6] );           # period
    if ( $compare != 0 ) { return ( $compare ); }

    $compare = ( $first[3] cmp $second[3] );           # product
    if ( $compare != 0 ) { return ( $compare ); }

    $compare = ( $first[4] <=> $second[4] );           # system price
    if ( $compare != 0 ) { return ( $compare ); }

    $compare = ( $first[5] <=> $second[5] );           # net price
    return ( $compare );
}



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Tue Apr  6 19:39:25 EDT 2010
CHROMOSOME Y TEST DATA

PROBLEM: NOT ENOUGH.

SOLUTION: USE CHR22


cd /p/NGS/syoung/base/pipeline/nimblegen-run1
grep chrY SI*/ccds/*.txt


SID9638_exon_Map/ccds/454AllDiffs-headers-SNPs.txt:

CCDS35471.1  chrY    132     132     T       C       11  18%      9975666 9975666 synonymous      GCT     GCC     Alanine Alanine +                       +


SID9638_exon_Map/ccds/454AllDiffs-headers.txt:

>CCDS35471.1|Hs36.3|chrY  132     132     T       C       11  18%



SID9638_exon_Map/ccds/454AllDiffs.txt:

>CCDS35471.1|Hs36.3|chrY  132     132     T       C       11      18%






++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Thu Apr  1 14:01:25 EDT 2010
RECHECKED FLANKINGS WITH COMPLEMENTS FOR REVERSE STRAND - ALL OKAY

rs11556996
==========

dbSNP CCCTCCAGCATGTGGGCTATCCGCAG[A/G]TCCAGGTACCGCACCCCGGCATCCA
UCSC                  CTATCCGCAG  G  TCCAGGTACC

>hg19_snp130_rs11556996 range=chrY:157352-157372 5'pad=10 3'pad=10 strand=- repeatMasking=none
CTATCCGCAGGTCCAGGTACC

COMPLEMENT SEQUENCE:

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/complement.pl \
--input CTATCCGCAGGTCCAGGTACC

GGTACCTGGACCTGCGGATAG

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 157352 \
--stop 157372

GGTACCTGGACCTGCGGATAG


NB: CHECKED SEQUENCE MATCH ON CHROMOSOME AND FOUND PERFECT MATCH AT COMPLETELY DIFFERENT POSITION

CHECK POSITION:

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/findMatch.pl \
--query GGTACCTGGACCTGCGGATAG \
--targetfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrX.nospace.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/matches/rs35966551-chrX.match

    207351

gcagctggatgccggggtgcGGTACCTGGACCTGCGGATAGcccacatgctggagggctcg

OK!!


rs35966551
==========

>hg19_snp130_rs35966551 range=chrY:157421-157440 5'pad=10 3'pad=10 strand=- repeatMasking=none
CACCAGCGCCGTTGTGTACA

COMPLEMENT SEQUENCE:

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/complement.pl \
--input CACCAGCGCCGTTGTGTACA

TGTACACAACGGCGCTGGTG

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 157421 \
--stop 157440

Bases 157421..157440
TGTACACAACGGCGCTGGTG

OK!!





rs2556479
=========

>hg19_snp130_rs2556479 range=chrY:27769648-27769668 5'pad=10 3'pad=10 strand=- repeatMasking=none
GTGTTTCTGTTATTCCTTAAG

Complement
CTTAAGGAATAACAGAAACAC

Bases 27769648..27769668
CTTAAGGAATAACAGAAACAC   



rs2556478
=========

>hg19_snp130_rs2556478 range=chrY:27769752-27769772 5'pad=10 3'pad=10 strand=- repeatMasking=none
CTAGTCCAATCGCAGGGCCAT

Complement
ATGGCCCTGCGATTGGACTAG

Bases 27769752..27769772
ATGGCCCTGCGATTGGACTAG



rs3876202
=========

>hg19_snp130_rs3876202 range=chrY:27769939-27769959 5'pad=10 3'pad=10 strand=- repeatMasking=none
CATGCCTCCCTTGCTGTCAGC

Complement
GCTGACAGCAAGGGAGGCATG

Bases 27769939..27769959
GCTGACAGCAAGGGAGGCATG



rs2681289
=========

>hg19_snp130_rs2681289 range=chrY:27770601-27770621 5'pad=10 3'pad=10 strand=- repeatMasking=none
TATATCCCAACAGAGGTATTC

Complement
GAATACCTCTGTTGGGATATA

Bases 27770601..27770621
GAATACCTCTGTTGGGATATA








++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Thu Apr  1 14:00:25 EDT 2010
REPLY FROM dbSNP WITH FLANKINGS URL GIVING IDENTICAL SEQUENCE AS UCSC'S MARGINS


Hi Stuart,

Do you mean their flankings?  You can go to http://www.ncbi.nlm.nih.gov/projects/SNP/ and search the rs under "Search by IDs on All Assemblies".

I tried rs9785927 and it looks on chrX.

Sincerely,

Hua Zhang

---- END OF MESSAGE BODY.  PLEASE DO NOT CHANGE THE DATA BELOW ---- SK#:17:141:7:35:879440

Please leave the subject line unchanged, and do not change the message at end from the line with "END OF MESSAGE BODY" to the end.
 
The following summarizes the status of your request:
Current status of the ticket #15819388 is:
       Queue: snp-admin
        Area: 
     Subject: alternative FTP site?
       Owner: 
  Requestors: syoung@med.miami.edu
      Status: open

*** Ticket URL below is for internal NCBI admin use only ***
  Ticket URL: http://iebrt.ncbi.nlm.nih.gov/rt/bin/cgi/webrt.fcgi?serial_num=15819388


 Transaction: Mail sent by 'zhahua' (17123113)



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Wed Mar 31 22:59:53 EDT 2010
SNP TRACKS AND ZERO- AND ONE-BASED COORDINATES

Database/browser start coordinates differ by 1 base	
http://genome.ucsc.edu/FAQ/FAQtracks#tracks1

 	
Question: 
"I am confused about the start coordinates for items in the refGene table. It looks like you need to add "1" to the starting point in order to get the same start coordinate as is shown by the Genome Browser. Why is this the case?"

Response:
Our internal database representations of coordinates always have a zero-based start and a one-based end. We add 1 to the start before displaying coordinates in the Genome Browser. Therefore, they appear as one-based start, one-based end in the graphical display. The refGene.txt file is a database file, and consequently is based on the internal representation.

We use this particular internal representation because it simplifies coordinate arithmetic, i.e. it eliminates the need to add or subtract 1 at every step. Unfortunately, it does create some confusion when the internal representation is exposed or when we forget to add 1 before displaying a start coordinate. However, it saves us from much trickier bugs.

In summary, if you use a database dump file but would prefer to see the one-based start coordinates, you will always need to add 1 to each start coordinate.



Overlap SNPs vs. random SNPs	
http://genome.ucsc.edu/FAQ/FAQtracks.html
 	
Question: 
"Some assemblies have tracks for both overlap SNPs (snpNIH) and random SNPs (snpTsc). Where are these defined? Where do you get your SNP data?"

Response:
You can obtain detailed information about any track from its associated description page (opened by clicking on the mini-button to the left of the displayed track). Click the "View table schema" link on the description page to display the schema and other information for the primary table underlying the annotation track.

The SNP tracks show single nucleotide polymorphisms, which are single nucleotide positions in the genomic sequence for which two or more alternative alleles are present at appreciable frequency (traditionally at least 1%) in the human population. The Overlap SNPs occur only where two clones of different haplotypes overlap. These SNPs can be useful in confirming the assembly of putative overlaps. Random SNPs are the results of a large number of reads taken from random positions in the genome. If you're trying to estimate the rate of variation in a region, you'd use the TSC reads and perhaps normalize them further by the number of reads actually read in that region. If you just want a SNP to use as a marker, both sets are valuable.

The SNP tracks are third party tracks. The snpTsc data are obtained from the SNP Consortium and the random SNP data are obtained from dbSNP. Both accession types start with rs, e.g. rs792507. The dispersal of the two types of SNPs may be viewed anywhere in the Genome Browser. They are disjoint as sets, but otherwise fully interdigitated.



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Wed Mar 31 17:59:53 EDT 2010
MESSAGE TO dbSNP


Hi Hua,

Thank you for your message regarding your FTP site - it was working fine today when I tried it.

I was wondering if you could help with another issue related to dbSNP? Could you please let me know where I can find the surrounding genomic sequence for the following dbSNP entries:

rs9785927
rs68110282
rs73174495
rs3876418
rs11556996
rs35966551
rs2556479
rs2556478
rs3876202
rs2681289


I've been unable to locate with confidence several SNPs on the Y chromosome that I downloaded from UCSC with a 10bp margin on each side. They do not align well to their expected positions, nor do they align well to any other positions. I'm wondering if there may be some error in the UCSC margin sequence step. To check this for sure, I need to know the original sequences of the SNPs as they were submitted to dbSNP. I thought I would be able to find them in the snp130Seq.txt file that I downloaded from your FTP site but I couldn't find any of the above dbSNP identifiers in the rs_chY.fas file I downloaded.

Of the ten SNPs I checked manually, the following four SNPs align to chromosome Y according to their start/stop positions:

START OF CHROMOSOME Y
rs9785927
rs68110282
rs73174495

rs3876418
END OF CHROMOSOME Y


These six SNPs DO NOT align to chromosome Y according to their start/stop positions:

START OF CHROMOSOME Y
rs11556996
rs35966551

rs2556479
rs2556478
rs3876202
rs2681289
END OF CHROMOSOME Y


Please find my detailed report below.

Cheers,

Stuart.


Stuart Young
Post Doctoral Research Associate
Center for Computational Sciences
University of Miami
1120 NW 14th St, Miami, FL
305-243-4539
syoung@med.miami.edu






CHECK CHROMOSOMAL POSITIONS OF FIRST 5 ENTRIES IN snp130-chrY-intersect-CCDS.fa
===============================================================================


head /nethome/syoung/base/pipeline/snpfilter/chrY/snp130-chrY-intersect-CCDS.fa

    >hg19_snp130_rs9785927 range=chrY:150850-150870 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    CTCTGATGGGTGGGCAGGTGA
    #>hg19_snp130_rs68110282 range=chrY:150850-150870 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    #CTCTGATGGGTGGGCAGGTGA
    >hg19_snp130_rs73174495 range=chrY:157352-157372 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    GGTACCTGGACCTGCGGATAG
    >hg19_snp130_rs11556996 range=chrY:157352-157372 5'pad=10 3'pad=10 strand=- repeatMasking=none
    CTATCCGCAGGTCCAGGTACC
    >hg19_snp130_rs35966551 range=chrY:157421-157440 5'pad=10 3'pad=10 strand=- repeatMasking=none
    CACCAGCGCCGTTGTGTACA

cd /nethome/syoung/base/pipeline/snpfilter/chrY
ll 
-rw-r--r--  1 syoung bioinfo 8.9M Mar 27 17:31 snp130-chrY
-rw-r--r--  1 syoung bioinfo  54K Mar 29 00:54 snp130-chrY-intersect-CCDS.fa


rs9785927 AND rs68110282 (IDENTICAL POSITIONS)
==============================================

>hg19_snp130_rs9785927 range=chrY:150850-150870 5'pad=10 3'pad=10 strand=+ repeatMasking=none
CTCTGATGGGTGGGCAGGTGA


getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 150850 \
--stop 150870

Bases 150850..150870
CTCTGATGGGTGGGCAGGTGA
CTCTGATGGGTGGGCAGGTGA

-- PERFECT MATCH - SNP IS SAME AS REFERENCE SEQUENCE!


rs73174495
==========

>hg19_snp130_rs73174495 range=chrY:157352-157372 5'pad=10 3'pad=10 strand=+ repeatMasking=none
GGTACCTGGACCTGCGGATAG

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 157352 \
--stop 157372

Bases 157352..157372
GGTACCTGGACCTGCGGATAG
GGTACCTGGACCTGCGGATAG

OK!


rs11556996
==========

>hg19_snp130_rs11556996 range=chrY:157352-157372 5'pad=10 3'pad=10 strand=- repeatMasking=none
CTATCCGCAGGTCCAGGTACC

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 157352 \
--stop 157372

Bases 157352..157372
GGTACCTGGACCTGCGGATAG
CTATCCGCAGGTCCAGGTACC
****  *********  ****


***VERY LOW IDENTITY BETWEEN THE SNP SEQUENCE AND THE REFERENCE***
***A PROBLEM WITH THE ORIGINAL SNP ALIGNMENT ???***


rs35966551
==========

>hg19_snp130_rs35966551 range=chrY:157421-157440 5'pad=10 3'pad=10 strand=- repeatMasking=none
CACCAGCGCCGTTGTGTACA

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 157421 \
--stop 157440

Bases 157421..157440
TGTACACAACGGCGCTGGTG
CACCAGCGCCGTTGTGTACA
****** **  ** ******


SANITY CHECK TO MAKE SURE THE REFERENCE IS FOUND ON ITSELF:

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/findMatch.pl \
--query TGTACACAACGGCGCTGGTG \
--targetfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/matches/rs35966551-REF-chrY.match

157420
cctgcactttgtccatatggTGTACACAACGGCGCTGGTGgaggtgcggccgggctgagg
                    TGTACACAACGGCGCTGGTG

OK, PERFECT MATCH



NEXT CHECK FOR SNP ON Y CHROMOSOME:

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/findMatch.pl \
--query GTGTACA \
--targetfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/matches/rs35966551-chrY.match

157419
acctgcactttgtccatatgGTGTACAcaacggcgctggtggaggtg
       CACCAGCGCCGTTGTGTACA
        *****  *** *


A POOR MATCH ON THE Y CHROMOSOME. MANY DIFFERENCES AND ALSO SHIFTED
LEFTWARDS SO IT DOESN'T LOOK LIKE A CORRECT MATCH. NO ENTRY IN THE
rs_fasta CHROMOSOME Y FILE FOR THIS SNP....


CHECK FOR SNP ON X CHROMOSOME:

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/findMatch.pl \
--query CACCAGCGCCGTTGTGTACA \
--targetfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrX.nospace.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/matches/rs35966551-chrX.match


NO MATCH, ALTHOUGH THE SNP IS SUPPOSEDLY FOUND ON BOTH THE X AND Y CHROMOSOME:

[syoung@u01 tables]$ grep -n rs35966551 ../tables/snp130.txt
17651100:586    chrX    207430  207430  rs35966551      0       -       -       -       -/C     genomic       insertion       unknown 0       0       unknown between 3
18307164:586    chrY    157430  157430  rs35966551      0       -       -       -       -/C     genomic       insertion       unknown 0       0       unknown between 3



CHECK LAST 5 ENTRIES IN dbSNP THAT INTERSECT WITH THE CCDS
==========================================================


tail /nethome/syoung/base/pipeline/snpfilter/chrY/snp130-chrY-intersect-CCDS.fa

    >hg19_snp130_rs2556479 range=chrY:27769648-27769668 5'pad=10 3'pad=10 strand=- repeatMasking=none
    GTGTTTCTGTTATTCCTTAAG
    >hg19_snp130_rs2556478 range=chrY:27769752-27769772 5'pad=10 3'pad=10 strand=- repeatMasking=none
    CTAGTCCAATCGCAGGGCCAT
    >hg19_snp130_rs3876202 range=chrY:27769939-27769959 5'pad=10 3'pad=10 strand=- repeatMasking=none
    CATGCCTCCCTTGCTGTCAGC
    >hg19_snp130_rs3876418 range=chrY:27770038-27770058 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    CTCATACAATCCAATTGTACT
    >hg19_snp130_rs2681289 range=chrY:27770601-27770621 5'pad=10 3'pad=10 strand=- repeatMasking=none
    TATATCCCAACAGAGGTATTC


rs2556479
=========

    >hg19_snp130_rs2556479 range=chrY:27769648-27769668 5'pad=10 3'pad=10 strand=- repeatMasking=none
    GTGTTTCTGTTATTCCTTAAG

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 27769648 \
--stop 27769668

Bases 27769648..27769668
CTTAAGGAATAACAGAAACAC   
GTGTTTCTGTTATTCCTTAAG
* ******* ********* *


rs2556478
=========

>hg19_snp130_rs2556478 range=chrY:27769752-27769772 5'pad=10 3'pad=10 strand=- repeatMasking=none
CTAGTCCAATCGCAGGGCCAT

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 27769752 \
--stop 27769772

Bases 27769752..27769772
ATGGCCCTGCGATTGGACTAG
CTAGTCCAATCGCAGGGCCAT
* * *  *******  * * *


rs3876202
=========

>hg19_snp130_rs3876202 range=chrY:27769939-27769959 5'pad=10 3'pad=10 strand=- repeatMasking=none
CATGCCTCCCTTGCTGTCAGC

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 27769939 \
--stop 27769959

Bases 27769939..27769959
GCTGACAGCAAGGGAGGCATG
CATGCCTCCCTTGCTGTCAGC
**  * ** *** ** *  **

***ALIGNMENT PROBLEM?***



rs3876418
=========

>hg19_snp130_rs3876418 range=chrY:27770038-27770058 5'pad=10 3'pad=10 strand=+ repeatMasking=none
CTCATACAATCCAATTGTACT

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 27770038 \
--stop 27770058

Bases 27770038..27770058
CTCATACAATCCAATTGTACT
CTCATACAATCCAATTGTACT

OK!!!


rs2681289
=========

>hg19_snp130_rs2681289 range=chrY:27770601-27770621 5'pad=10 3'pad=10 strand=- repeatMasking=none
TATATCCCAACAGAGGTATTC

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa \
--start 27770601 \
--stop 27770621

Bases 27770601..27770621
GAATACCTCTGTTGGGATATA
TATATCCCAACAGAGGTATTC
* ***  *******  *****

***ALIGNMENT PROBLEM?***











-----Original Message-----
From: RT - Hua Zhang [mailto:rt@ncbi.nlm.nih.gov] 
Sent: Wednesday, March 31, 2010 10:48 AM
To: Young, Stuart
Subject: [snp-admin] (zhahua) alternative FTP site? [NCBI tracking system #15819388]

------ MESSAGE BODY. YOU MAY CHANGE IT OR ADD COMMENTS ABOVE ------

Dear Stuart,
Could you please try again?  This must be a temporary network glitch because I
just tried and it works.

Sincerely,

Hua Zhang

---- END OF MESSAGE BODY.  PLEASE DO NOT CHANGE THE DATA BELOW ----
SK#:8:101:0:38:6267775

Please leave the subject line unchanged, and do not change the message
at end from the line with "END OF MESSAGE BODY" to the end.
 
The following summarizes the status of your request:
Current status of the ticket #15819388 is:
       Queue: snp-admin
        Area: 
     Subject: alternative FTP site?
       Owner: 
  Requestors: syoung@med.miami.edu
      Status: resolved

*** Ticket URL below is for internal NCBI admin use only ***
  Ticket URL: http://iebrt.ncbi.nlm.nih.gov/rt/bin/cgi/webrt.fcgi?serial_num=15819388


 Transaction: Status changed to 'resolved' by zhahua (17121314)
 Transaction: Mail sent by 'zhahua' (17121315)

------- END OF TRNSACTION DATA.  YOU MAY ADD COMMENTS BELOW -------




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

ftp://ftp.ncbi.nih.gov/snp/

ftp://ftp.ncbi.nih.gov/snp/organisms/ organism_tax_id/rs_fasta/


mkdir /nethome/syoung/base/pipeline/snpfilter/dbsnp
cd /nethome/syoung/base/pipeline/snpfilter/dbsnp

wget -c ftp://ftp.ncbi.nih.gov/snp/organisms/human_9606/rs_fasta/rs_chY.fas.gz


++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Tue Mar 30 23:55:53 EDT 2010
TEST EXON PREDICTOR WITH SNPS FROM INTERSECTION OF CCDS AND SNP 130 IN CHROMOSOME Y

LOCATION OF REFSEQ 40:

/nethome/bioinfo/data/sequence/genes/human/refseq/40/refseqgene.genomic.fna


1. TRIED LOOKING MANUALLY FOR CODING dbSNPs

>hg19_snp130_rs2521574 range=chrY:21905065-21905105 5'pad=20 3'pad=20 strand=+ repeatMasking=none
TTTGGACGCGAGGAGTAAATCAAATGGTACCAACTTCTACT

FIRST TOOK WHOLE SNP + FLANKING 20 BP SEGMENTS:

chmod 755 /nethome/bioinfo/apps/agua/0.4/bin/apps/utils/findMatch.pl

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/findMatch.pl \
--query TTTGGACGCGAGGAGTAAATCAAATGGTACCAACTTCTACT \
--targetfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrY.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/matches/rs2521574-chrY.match

AS EXPECTED, NO MATCHES WERE FOUND. NOW TRIED FLANKS OF SNP:


/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/findMatch.pl \
--query TTTGGACGCGAGGAGTAA \
--targetfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrY.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/matches/rs2521574-chrY.match

21905064
tacctccagttcatttagccTTTGGACGCGAGGAGTAAatctgaaattgtcaacttct
                                         
/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/findMatch.pl \
--query CAACTTCTACT \
--targetfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrY.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/matches/rs2521574-chrY.match

NO MATCH FOR THE WHOLE 20 BP MARGIN, BUT A MATCH FOR THE LAST 11 BP!!!

...

21905094
aggagtaaatctgaaattgtCAACTTCTACTgcaaaaggaggctgccaatc


CONCLUSION:

THE CO-OCCURRENCE OF MULTIPLE SNPS CLOSE TOGETHER MAKES ABSOLUTE 100% MATCHING IMPOSSIBLE


>hg19_snp130_rs2521574 range=chrY:21905065-21905105 5'pad=20 3'pad=20 strand=+ repeatMasking=none
TTTGGACGCGAGGAGTAAATCAAATGGTACCAACTTCTACT


21905064
tacctccagttcatttagccTTTGGACGCGAGGAGTAAatctgaaattgtcaacttct
                    TTTGGACGCGAGGAGTAAATCAAATGGTACCAACTTCTACT
                                         ** *** **
                                         OTHER SNPS
                                         




CONFIRM SNP AND REFSEQ SEQUENCES BY EXTRACTING BASES FROM chromosome Y
======================================================================

1. EXTRACT THE WHOLE SEQUENCE FROM A SINGLE-FASTA FILE
TO AN OUTPUT FILE WITH NO LINE RETURNS IN THE SEQUENCE

mkdir /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace

chmod 755 /nethome/bioinfo/apps/agua/0.4/bin/apps/utils/nospaces.pl

CREATE A SINGLE NOSPACE FILE

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/nospaces.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrY.fa \
--outputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa

head /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace/chrY.nospace.fa


CREATE A NOSPACE FILE FOR EVERY FILE IN THE INPUT DIRECTORY

/nethome/bioinfo/apps/agua/0.4/bin/apps/utils/nospaces.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19 \
--outputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/nospace

head /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrY.nospace.fa
head /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrX.nospace.fa



2. FROM A FASTA FILE WITH NO SPACES IN THE SEQUENCE, EXTRACT THE BASES STARTING AT ZERO AFTER THE FASTA HEADER

CHECK dbSNP SEQUENCE 

>hg19_snp130_rs2521574 range=chrY:21905065-21905105 5'pad=20 3'pad=20 strand=+ repeatMasking=none
TTTGGACGCGAGGAGTAAATCAAATGGTACCAACTTCTACT

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrY.nospace.fa \
--start 21905065 \
--stop 21905086

TTTGGACGCGAGGAGTAAATCT


getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrY.nospace.fa \
--start 21905086 \
--stop 21905105

TGAAATTGTCAACTTCTACT

                   dbSNP rs2521574
                     |
                     |
                     v
                        OTHER SNPs
                     ** *** **
                     TGAAATTGTCAACTTCTACT
TTTGGACGCGAGGAGTAAATCAAATGGTACCAACTTCTACT
TTTGGACGCGAGGAGTAAATCT



*** LATER (REFSEQ FTP IS DOWN, AGAIN) ***
3. CHECK THE SEQUENCE OF REFSEQ ENTRIES MATCHES THE REFERENCE SEQUENCE

head /nethome/bioinfo/data/sequence/genes/human/refseq/40/refseqgene.genomic.fna


    >gi|239582715|ref|NG_012280.1| Homo sapiens colony stimulating factor 2 receptor, alpha, low-affinity (granulocyte-macrophage) (CSF2RA) on chromosome X Y
    ACAGTGCCAGTTCCAGCAGCCTTGGTGAACCGTCTGGTTGAGCTCTTGGGAAGATAAACTTCTCTACATCAATGTCAAAA
    GGAAGATATGAGCCTTTGACAAGAATATCCACCATGATGCCCAGTTCCAGCAGCCTGGGTGAGCCATCTGGTTGAGCTCT
    TGGGAAGATAAACTTCTCTACATCAATGTCAACAAGAAGATATGAGCCTTTGACAAAAAGATCCACCATGATGCCCAGTT
    CCAGCAGCCTGGGTGAGCCATCTGGTTGAGCTCTTGGGAAGATAAACTTCTCTACATCAATGTCAACAAGAAGATATGAG
    CCTTTGACAAAAAGATCCACCGTGATGCCCAGTTCCAGCAGCCTGGCTGAGCCATCTGGTTGAGCTCTTGGGAAGATAAG
    CTTCTCTACATCAATGTCAACAAGAAGATATGAGCCTTTGACAAAAAGATCCACCGTGATGCCCAGTTCCAGCAGCCTGG
    CTGAGCCATCTGGTTGAGCTCTTGGGAAGATAAACTTCTCTACATCAATGTCAACAAGAAGATATGAGCCTTTGACAAAA
    AGATCCACCATGATGCCCAGTTCCAGCAGCCTGGCTGAGCCATCTGGTTGAGCTCTTGGGAAGATAAACTTCTCTACATC
    AATGTCAACAAGAAGATATGAGCCTTTGACAAAAAGATCCACCATGATGCCCAGTTCCAGCAGCCTGGCTGAGCCATCTG



    >gi|254911083|ref|NG_012515.1| Homo sapiens potassium voltage-gated channel, Shal-related subfamily, member 1 (KCND1) on chromosome X
    TGGTTTTATGAAAACTAGCATTCAGATTCAGAGCACATGTTACATCTGGTTGTTTTATGGCCCTTAAATCTCTTTAGTGC
    GGTCCCTTTTTTCCTGAGACCAATTTGTTGAAGAGGCCAGCCCAGTCACCCCACAGGAAGTATGCTACCTTTTGGGTTTT
    TCTGCTGGCTTCCTGGTGGTATGATTTAACATGTCCCTCTCTTCCAGTTTTCCTGTCAGCTGAAAGTTAGATCTCATTTG
    CTTTGGGATCTTCCTTCAATCCTCTCCACAAGGCTCTGATGTGGTTACTCTCTACCCCCATTTAGGCAGAGGAGAAAACA
    GAGTCTGAGGGTACCAAGATGGGCCAACAGTCCCAGCTTCAGGGCCCATGTTCTCTCACCCACCTCTGGCCTGGTTCTCC
    TCCCCAGTCCCTGACACCTGTCTGGGGTCGGTGGTGCTGAGCCCGGGGCTGGCCTCTCCCCTTCTCTTTCCTGCAGTCCT
    TATCCAGCAGCCCTCAAGCCCAGCCCCCTCGGCCAGCAGAGCTGTCAGATGAGGAAGTGGCTGAGCTCTTTCAGCGGCTG
    
    

4. SELECT TOP 100 snp130CodingDbSnp.txt AND TOP 100 NON-CODING ENTRIES IN snp130.txt
(I.E., THEY DO NOT HAVE A CORRESPONDING ENTRY IN snp130CodingDbSnp.txt)





    
    
    
    
    
    
    

head -n 2 /nethome/syoung/base/pipeline/snpfilter/tables/refGene.txt

    1934    NM_001174101    chr5    +       176873795       176883285       176882068       176883122       3       176873795,176881829,176882724,  176873961,176882495,176883285,  0       PRR7    cmpl    cmp-1,0,1,
    1934    NM_030567       chr5    +       176873795       176883285       176882068       176883122       4       176873795,176880956,176881829,176882724,        176873961,176881041,176882495,176883285,   PRR7     cmpl    cmpl    -1,-1,0,1,
    1934    NM_001174102    chr5    +       176875325       176883283       176882068       176883122       3       176875325,176881829,176882724,  176875408,176882495,176883283,  0       PRR7    cmpl    cmp-1,0,1,
    1719    NM_001174092    chrX    -       148678216       148713487       148679670       148713263       6       148678216,148681217,148681966,148685652,148690313,148713225,    148679915,148681341,148682143,148685736,148690521,148713487,        0       TMEM185A        cmpl    cmpl    1,0,0,0,2,0,
    1719    NM_032508       chrX    -       148678216       148713487       148679670       148713263       7       148678216,148681217,148681966,148685652,148690313,148692969,148713225,  148679915,148681341,148682143,148685736,148690521,148693146,148713487,      0       TMEM185A        cmpl    cmpl    1,0,0,0,2,2,0,












[syoung@u02 tables]$ tail -n5 *txt

==> ccdsGene.txt <==
796     CCDS14801.1     chrY    +       27768589        27770674        27768589        27770674        2       27768589,27770601,      27770181,27770674,      0               cmpl    cmpl    0,2,
1035    CCDS14769.4     chrY    +       59106539        59107406        59106539        59107406        1       59106539,       59107406,       0               cmpl    cmpl    0,
129     CCDS48199.1     chrY    +       59222135        59274621        59222135        59274621        6       59222135,59230781,59233166,59252482,59272370,59274552,  59222216,59230919,59233257,59252550,59272463,59274621,      0               cmpl    cmpl    0,0,0,1,0,0,
129     CCDS14770.4     chrY    +       59222135        59274621        59222135        59274621        7       59222135,59228291,59230781,59233166,59252482,59272370,59274552, 59222281,59228349,59230919,59233257,59252550,59272463,59274621,     0               cmpl    cmpl    0,2,0,0,1,0,0,
1037    CCDS14771.4     chrY    +       59330430        59343080        59330430        59343080        9       59330430,59335576,59336119,59336347,59337090,59337948,59338753,59340193,59342486,       59330458,59335690,59336231,59336526,59337236,59338150,59338859,59340278,59343080,   0               cmpl    cmpl    0,1,1,2,1,0,1,2,0,

==> ccdsInfo.txt <==
CCDS9997.1      H       OTTHUMT00000276508      OTTHUMP00000178739
CCDS9998.1      H       ENST00000331782 ENSP00000328169
CCDS9998.1      N       NM_002226.3     NP_002217.3
CCDS9999.1      H       ENST00000347004 ENSP00000328566
CCDS9999.1      N       NM_145159.1     NP_660142.1

==> refGene.txt <==
1934    NM_001174101    chr5    +       176873795       176883285       176882068       176883122       3       176873795,176881829,176882724,  176873961,176882495,176883285,  0       PRR7    cmpl    cmp-1,0,1,
1934    NM_030567       chr5    +       176873795       176883285       176882068       176883122       4       176873795,176880956,176881829,176882724,        176873961,176881041,176882495,176883285,   PRR7     cmpl    cmpl    -1,-1,0,1,
1934    NM_001174102    chr5    +       176875325       176883283       176882068       176883122       3       176875325,176881829,176882724,  176875408,176882495,176883283,  0       PRR7    cmpl    cmp-1,0,1,
1719    NM_001174092    chrX    -       148678216       148713487       148679670       148713263       6       148678216,148681217,148681966,148685652,148690313,148713225,    148679915,148681341,148682143,148685736,148690521,148713487,        0       TMEM185A        cmpl    cmpl    1,0,0,0,2,0,
1719    NM_032508       chrX    -       148678216       148713487       148679670       148713263       7       148678216,148681217,148681966,148685652,148690313,148692969,148713225,  148679915,148681341,148682143,148685736,148690521,148693146,148713487,      0       TMEM185A        cmpl    cmpl    1,0,0,0,2,2,0,

==> snp130CodingDbSnp.txt <==
752     chrY    21897362        21897362        rs3212285       NM_004653       1       2       8,42,   A,T,    ACG,TCG,        T,S,
752     chrY    21905084        21905084        rs2521574       NM_004653       2       2       8,42,   G,A,    AGA,AAA,        R,K,
758     chrY    22744515        22744515        rs58802313      NM_004681       3       2       8,3,    G,A,    TTG,TTA,        L,L,
759     chrY    22921767        22921767        rs34581739      NM_001039567    3       2       8,3,    G,A,    TCG,TCA,        S,S,
760     chrY    22942896        22942896        rs34459399      NM_001039567    3       2       8,3,    T,C,    GCT,GCC,        A,A,

==> snp130Seq.txt <==
rs73628952      18668679253
rs73628953      18668679820
rs73628954      18668680387
rs74162238      18668680954
rs74175439      18668681521

==> snp130.txt <==
1035    chrY    59033138        59033139        rs55686319      0       +       T       T       C/T     genomic single  unknown 0       0       unknown exact   1
1035    chrY    59033158        59033159        rs28447236      0       +       A       A       A/G     genomic single  unknown 0       0       unknown exact   1
1035    chrY    59033299        59033300        rs62604356      0       +       C       C       C/T     genomic single  unknown 0       0       unknown exact   1
1035    chrY    59033356        59033357        rs62604357      0       +       A       A       A/C     genomic single  unknown 0       0       unknown exact   1
1035    chrY    59033374        59033375        rs62604358      0       +       T       T       C/T     genomic single  unknown 0       0       unknown exact   1




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Tue Mar 30 17:49:53 EDT 2010
ENSEMBL 'SNP EFFECTS PREDICTOR'

SNP effect Data
http://uswest.ensembl.org/info/website/upload/index.html

The 'SNP Effect Predictor' tool which appears as an option when you click on Manage your Data allows you to upload a set of variation data and predict the effect of the variants. This requires the data to be uploaded in a very simple tab-separated format, containing five columns that correspond to:

 chromosome name, chromosome start position, chromosome end position, allele and strand

The data must contain all of the columns in the same order as appears below.

eg:

1   881907    881906    -/C   +
5   140532    140532    T/C   +
12  1017956   1017956   T/A   +
2   946507    946507    G/C   +
14  19584687  19584687  C/T   -
19  66520     66520     G/A   +
8   150029    150029    A/T   +   

This tool predicts the consequence of this SNP, the amino acid position and change (if the SNP falls within a protein) and the SNP identifier of known SNPs that occur at this position. The output columns are:

 Uploaded Variation, Location, Transcript, Consequence, Relative position in protein, Amino acid change, Corresponding Variation 
Note, this prediction is only available for species that have variation databases. The SNP Effect predictor will use the data from the current Ensembl assembly and gene build.

It is also possible to use the API to predict the effects of SNPs. This is the best method for large datasets. Here is an example in the Variation API Tutorial.





NICE HISTORY OF THE HUMAN GENOME PROJECT

http://www.sanger.ac.uk/about/history/hgp/




dbSNP 130 WAS CREATED BASED ON THE GENOME REFERENCE CONSORTIUM'S HUMAN 37 BUILD

GENOME REFERENCE CONSORTIUM
http://www.ncbi.nlm.nih.gov/projects/genome/assembly/grc/human/index.shtml


FTP SITE NOT WORKING



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Tue Mar 30 17:48:53 EDT 2010
DESCRIPTION OF CCDS

(
SEE ALSO NCBI CCDS HOMEPAGE
http://www.ncbi.nlm.nih.gov/projects/CCDS/CcdsBrowse.cgi
Initial results from the Consensus CDS project are now available from the participants' genome browser Web sites. In addition, CCDS identifiers are indicated on the relevant NCBI RefSeq and Entrez Gene records and in Map Viewer displays of RNA (RefSeq) and Gene annotations on the reference assembly. CCDS reports can be accessed by following provided links, or by directly querying the underlying database using the query interface provided at the top of this page.
)



NOTE: CCDS START COORDINATES ARE 0-based, not 1-based
http://genome.ucsc.edu/FAQ/FAQtracks#tracks1


UCSC CCDS DESCRIPTION
http://genome.ucsc.edu/cgi-bin/hgTables

CCDS (ccdsGene) Track Description
Description

This track shows human genome high-confidence gene annotations from the Consensus Coding Sequence (CCDS) project. This project is a collaborative effort to identify a core set of human protein-coding regions that are consistently annotated and of high quality. The long-term goal is to support convergence towards a standard set of gene annotations on the human genome.

Collaborators include:

European Bioinformatics Institute (EBI)
National Center for Biotechnology Information (NCBI)
University of California, Santa Cruz (UCSC)
Wellcome Trust Sanger Institute (WTSI)
Methods

CDS annotations of the human genome were obtained from two sources: NCBI RefSeq and a union of the gene annotations from Ensembl and Vega, collectively known as Hinxton.

Genes with identical CDS genomic coordinates in both sets become CCDS candidates. The genes undergo a quality evaluation, which must be approved by all collaborators. The following criteria are currently used to assess each gene:

an initiating ATG, a valid stop codon, and no in-frame stop codons
ability to be translated from the genome reference sequence without frameshifts
recognizable splicing sites
no intersection with putative pseudogene predictions
supporting transcripts and protein homology
conservation evidence with other species
A unique CCDS ID is assigned to the CCDS, which links together all gene annotations with the same CDS. CCDS gene annotations are under continuous review, with periodic updates to this track.

Credits

This track was produced at UCSC from data downloaded from the CCDS project web site.

References

Pruitt KD, Harrow J, Harte RA, Wallin C, Diekhans M, Maglott DR, Searle S, Farrell CM, Loveland JE, Ruef BJ et al. The consensus coding sequence (CCDS) project: Identifying a common protein-coding gene set for the human and mouse genomes. Genome Res. 2009 Jun 4. [Epub ahead of print]

Hubbard T, Barker D, Birney E, Cameron G, Chen Y, Clark L, Cox T, Cuff J, Curwen V, Down T, et al. The Ensembl genome database project. Nucl. Acids Res. 2002 Jan 1;30(1):38-41.

Pruitt KD, Tatusova T, Maglott DR. NCBI Reference Sequence (RefSeq): a curated non-redundant sequence database of genomes, transcripts and proteins. Nucl. Acids Res. 2005 Jan 1;33(Database Issue):D501-D504.




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Tue Mar 30 17:47:53 EDT 2010
DOWNLOADED CCDS, refSeq, snp130Seq, snp130CodingDbSnp TABLES FROM UCSC


CONCLUSION: USE THE snp130CodingDbSnp TABLE peptide FIELD AND THE snp130 TABLE func FIELD TO VERIFY MISSENSE/SYNONYMOUS CALLS BASED ON EXONIC POSITION TRANSLATED TO FRAME POSITION 


Schema for snp130Seq

Database: hg19    Primary Table: snp130Seq    Row Count: 17,804,034

Format description: Information about sequences contained in rs_fasta files described in snpExtFile

    field	example	SQL type	description
    acc	rs242	varchar(255)	rsId of sequence
    file_offset	0	bigint(20)	byte offset of sequence in file

Connected Tables and Joining Fields

    hg19.gwasCatalog.name (via snp130Seq.acc)
    hg19.snp130.name (via snp130Seq.acc)
    hg19.snp130CodingDbSnp.name (via snp130Seq.acc)
    hg19.snp130Exceptions.name (via snp130Seq.acc)
    hg19.snp130OrthoPt2Pa2Rm2.name (via snp130Seq.acc)


Sample Rows
 	
    acc	file_offset
    rs242	0
    rs538	291
    rs546	1181
    rs549	2071
    rs568	2822
    rs665	3384
    rs672	3646
    rs677	3919
    rs685	4809
    rs699	5620


Schema for snp130CodingDbSnp

Database: hg19    Primary Table: snp130CodingDbSnp    Row Count: 198,493

Format description: Annotations of the effects of SNPs on translated protein sequence.

    field	example	SQL type	info	description
    bin	585	smallint(6)	range	Indexing field to speed chromosome range queries.
    chrom	chr1	varchar(255)	values	Reference sequence chromosome or scaffold
    chromStart	69551	int(10) unsigned	range	Start position in chromosome
    chromEnd	69551	int(10) unsigned	range	End position in chromosome
    name	rs55874132	varchar(255)	values	Reference SNP identifier
    transcript	NM_001005484	varchar(255)	values	Accession of the transcript modified by SNP
    frame	3	enum('1','2','3')	values	Frame of transcript's codon modified by SNP
    alleleCount	2	int(11)	range	Number of annotated alleles for SNP
    funcCodes	8,3,	longblob	 	dbSNP function codes (e.g. 42=missense)
    alleles	G,C,	longblob	 	Observed nucleotide alleles corresponding to funcCodes
    codons	GCG,GCC,	longblob	 	Codons corresponding to funcCodes
    peptides	A,A,	longblob	 	Amino acid sequence corresponding to funcCodes

Connected Tables and Joining Fields

    hg19.gwasCatalog.name (via snp130CodingDbSnp.name)
    hg19.snp130.name (via snp130CodingDbSnp.name)
    hg19.snp130Exceptions.name (via snp130CodingDbSnp.name)
    hg19.snp130OrthoPt2Pa2Rm2.name (via snp130CodingDbSnp.name)
    hg19.snp130Seq.acc (via snp130CodingDbSnp.name)

Sample Rows
 	
    bin	chrom	chromStart	chromEnd	name	transcript	frame	alleleCount	funcCodes	alleles	codons	peptides
    585	chr1	69551	69551	rs55874132	NM_001005484	3	2	8,3,	G,C,	GCG,GCC,	A,A,
    585	chr1	88168	88168	rs940550	XM_001724183	2	2	8,42,	C,T,	GCC,GTC,	A,V,
    585	chr1	88171	88171	rs940551	XM_001724183	2	2	8,42,	G,A,	CGT,CAT,	R,H,
    585	chr1	88215	88215	rs2103136	XM_001724183	1	2	8,42,	A,G,	ATC,GTC,	I,V,
    585	chr1	88264	88264	rs940552	XM_001724183	2	2	8,42,	C,T,	TCT,TTT,	S,F,
    585	chr1	88337	88337	rs55700207	XM_001724183	3	2	8,3,	G,A,	GAG,GAA,	E,E,
    590	chr1	753404	753404	rs61770173	XM_001724496	3	2	8,3,	G,T,	CCG,CCT,	P,P,
    590	chr1	753424	753424	rs3131970	XM_001724496	1	2	8,42,	A,G,	ACA,GCA,	T,A,
    590	chr1	753473	753473	rs2073814	XM_001724496	3	2	8,3,	G,C,	CTG,CTC,	L,L,
    591	chr1	856040	856040	rs61769717	XM_001724524	3	2	8,3,	C,T,	CGC,CGT,	R,R,


funcCodes
3   synonymous
8   cds reference
42  missense




dbSNP FUNCTION CODES
====================

http://www.ncbi.nlm.nih.gov/bookshelf/br.fcgi?book=helpsnpfaq&part=Schema.SchemaTable_Definiti#Schema.SNPFunctionCode_Tabl

SNPFunctionCode is a small lookup table of SNP functional codes, and has a grand total of 19 lines:

    1 locus: mrna_acc and protein_acc both null. 2003-02-03 16:01:00.0 other 1
    2 coding: coding 2003-02-03 16:01:00.0 cSNP 1
    3 cds-synon: synonymous change 2003-02-03 16:01:00.0 cSNP 1
    4 cds-nonsynon: nonsynonymous change 2003-02-03 16:01:00.0 cSNP 1
    5 UTR: untranslated region 2003-02-03 16:01:00.0 other 0
    6 intron: intron 2003-02-03 16:01:00.0 other 0
    7 splice-site: splice-site 2003-02-03 16:01:00.0 other 0
    8 cds-reference: contig reference 2003-02-03 16:01:00.0 other 1
    9 synonymy unknown coding: synonymy unknown 2003-02-03 16:01:00.0 other 1
    11 GeneSegment: In gene segment with null mrna and protein. ex. IGLV4-69.
    geneId=28784 2006-12-04 12:49:00.0 other 1
    13 nearGene-3: within 3' 0.5kb to a gene. 2006-11-21 00:00:00.0 other 0
    15 nearGene-5: within 5' 2kb to a gene 2006-11-21 00:00:00.0 other 0
    41 nonsense 2005-08-01 00:00:00.0 cSNP 1
    42 missense 2005-08-01 00:00:00.0 cSNP 1
    44 frameshift In coding region. 2005-08-01 00:00:00.0 cSNP 1
    53 UTR-3: 3 prime untranslated region 2005-08-01 00:00:00.0 other 0
    55 UTR-5: 5 prime untranslated region 2005-08-01 00:00:00.0 other 0
    73 splice-3: 3 prime acceptor dinucleotide 2005-08-01 00:00:00.0 other 0
    75 splice-5:5 prime donor dinucleotide 2005-08-01 00:00:00.0 other 0



http://www.ncbi.nlm.nih.gov/bookshelf/br.fcgi?book=helpsnpfaq&part=Schema.dbSNP_Build_Updates_

I noticed that b127 SNPs are no longer associated with function class codes 1,2,5, and 7. Does dbSNP no longer use these function class codes?

See answer
As of build 127, function codes 1, 5 and 7 have been modified into two digit codes that will more precisely indicate the location of a SNP. The two digit codes have function codes 1, 5 or 7 as the first digit, each of these numbers keeping its original meaning, and 3 or 5 as the second digit, indicating whether the SNP is 3 or 5 to the region of interest. So the new function codes are as follows:

Function code 13: nearGene-3

Where:
1=locus region 
3= SNP is 3 to and 0.5kb away from gene

Function code 15: nearGene-5

Where: 
1=locus region 
5= SNP is 5 to and 2kb away from gene

Function code 53: UTR-3

Where:
5= UTR (untranslated region)
3= SNP located in the 3 untranslated region

Function code 55: UTR-5



The column names of all dbSNP tables are in this file:

ftp://ftp.ncbi.nih.gov/snp/organisms/human_9606/database/organism_schema/human_9606_table.sql.gz

For your two tables, search for these lines in the above file:

CREATE TABLE [SNP] (

CREATE TABLE [b129_SNPContigLoc_36_3] (

There is some documentation about dbSNP online at NCBI; sometimes I 
have had better luck finding relevant sections with Google than with 
searching it on NCBI's site.

These files are also helpful in decoding important columns of those 
tables:

(under ftp://ftp.ncbi.nih.gov/snp/organisms/human_9606/database)
  /shared_data/LocTypeCode.bcp.gz
  /shared_data/SnpClassCode.bcp.gz
  /shared_data/SnpFunctionCode.bcp.gz
  /shared_data/SnpValidationCode.bcp.gz


For any further questions about the details of dbSNP files, the best 
list is dbSNP's:  snp-admin at ncbi.nlm.nih.gov .  

Hope that helps, and feel free to send any questions about the UCSC 
Genome website and tools to genome at soe.ucsc.edu.



Function Code 41: Nonsense (coding nonsynonymous)

changes to the Stop codon

Function Code 42: Missense (coding nonsynonymous)

alters codon to make an altered amino acid in protein product

Function Code 44: Frameshift (coding nonsynonymous)

indel SNP causing frameshift

You can find up-to-date function codes and their definitions in the SnpFunctionCode.bcp.gz table located in the /shared_data directory of the dbSNP FTP site. (10/27/08) gd

ftp://ftp.ncbi.nih.gov/snp/organisms/human_9606/database/shared_data/SnpFunctionCode.bcp.gz






ALL 6 TABLES
============

CREATE TABLE `ccdsGene` (
  `bin` smallint(5) unsigned NOT NULL,
  `name` varchar(255) NOT NULL,
  `chrom` varchar(255) NOT NULL,
  `strand` char(1) NOT NULL,
  `txStart` int(10) unsigned NOT NULL,
  `txEnd` int(10) unsigned NOT NULL,
  `cdsStart` int(10) unsigned NOT NULL,
  `cdsEnd` int(10) unsigned NOT NULL,
  `exonCount` int(10) unsigned NOT NULL,
  `exonStarts` longblob NOT NULL,
  `exonEnds` longblob NOT NULL,
  `score` int(11) default NULL,
  `name2` varchar(255) NOT NULL,
  `cdsStartStat` enum('none','unk','incmpl','cmpl') NOT NULL,
  `cdsEndStat` enum('none','unk','incmpl','cmpl') NOT NULL,
  `exonFrames` longblob NOT NULL,
  KEY `chrom` (`chrom`,`bin`),
  KEY `name` (`name`),
  KEY `name2` (`name2`)
)




CREATE TABLE `ccdsInfo` (
  `ccds` char(12) NOT NULL,
  `srcDb` char(1) NOT NULL,
  `mrnaAcc` char(18) NOT NULL,
  `protAcc` char(18) NOT NULL,
  KEY `ccds` (`ccds`),
  KEY `mrnaAcc` (`mrnaAcc`)
)


CREATE TABLE `refGene` (
  `bin` smallint(5) unsigned NOT NULL default '0',
  `name` varchar(255) NOT NULL default '',
  `chrom` varchar(255) NOT NULL default '',
  `strand` char(1) NOT NULL default '',
  `txStart` int(10) unsigned NOT NULL default '0',
  `txEnd` int(10) unsigned NOT NULL default '0',
  `cdsStart` int(10) unsigned NOT NULL default '0',
  `cdsEnd` int(10) unsigned NOT NULL default '0',
  `exonCount` int(10) unsigned NOT NULL default '0',
  `exonStarts` longblob NOT NULL,
  `exonEnds` longblob NOT NULL,
  `score` int(11) default NULL,
  `name2` varchar(255) NOT NULL default '',
  `cdsStartStat` enum('none','unk','incmpl','cmpl') NOT NULL default 'none',
  `cdsEndStat` enum('none','unk','incmpl','cmpl') NOT NULL default 'none',
  `exonFrames` longblob NOT NULL,
  KEY `chrom` (`chrom`,`bin`),
  KEY `name` (`name`),
  KEY `name2` (`name2`)
)


CREATE TABLE `snp130CodingDbSnp` (
  `bin` smallint(6) NOT NULL,
  `chrom` varchar(255) NOT NULL,
  `chromStart` int(10) unsigned NOT NULL,
  `chromEnd` int(10) unsigned NOT NULL,
  `name` varchar(255) NOT NULL,
  `transcript` varchar(255) NOT NULL,
  `frame` enum('1','2','3') NOT NULL,
  `alleleCount` int(11) NOT NULL,
  `funcCodes` longblob NOT NULL,        <= dbSNP function codes (e.g. 42=missense)
  `alleles` longblob NOT NULL,
  `codons` longblob NOT NULL,
  `peptides` longblob NOT NULL,
  KEY `chrom` (`chrom`(8),`bin`),
  KEY `name` (`name`(20))
)


CREATE TABLE `snp130` (
  `bin` smallint(5) unsigned NOT NULL default '0',
  `chrom` varchar(31) NOT NULL default '',
  `chromStart` int(10) unsigned NOT NULL default '0',
  `chromEnd` int(10) unsigned NOT NULL default '0',
  `name` varchar(15) NOT NULL default '',
  `score` smallint(5) unsigned NOT NULL default '0',
  `strand` enum('+','-') default NULL,
  `refNCBI` blob NOT NULL,
  `refUCSC` blob NOT NULL,
  `observed` varchar(255) NOT NULL default '',
  `molType` enum('unknown','genomic','cDNA') default NULL,
  `class` enum('unknown','single','in-del','het','microsatellite','named','mixed','mnp','insertion','deletion') NOT NULL default 'unknown',
  `valid` set('unknown','by-cluster','by-frequency','by-submitter','by-2hit-2allele','by-hapmap','by-1000genomes') NOT NULL default 'unknown',
  `avHet` float NOT NULL default '0',
  `avHetSE` float NOT NULL default '0',
  `func` set('unknown','coding-synon','intron','near-gene-3','near-gene-5','nonsense','missense','frameshift','untranslated-3','untranslated-5') NOT NULL default 'unknown',
  `locType` enum('range','exact','between','rangeInsertion','rangeSubstitution','rangeDeletion') default NULL,
  `weight` int(10) unsigned NOT NULL default '0',
  KEY `name` (`name`),
  KEY `chrom` (`chrom`,`bin`)
)

CREATE TABLE `snp130Seq` (
  `acc` varchar(255) NOT NULL default '',
  `file_offset` bigint(20) NOT NULL default '0',
  PRIMARY KEY  (`acc`)
)


dbSNP MAPPING TO REFSEQ (EXONS)
===============================

INDIRECT MAPPING:


                    dbSNP <-> CCDS <-> REFSEQ

snp130CodingDbSnp.transcript <-> ccdsInfo.mrnaAcc <-> refGene.name

                        EXON POSITIONS

snp130CodingDbSnp.chromStart    ccdsGene.exonStarts <-> refGene.exonStarts
                                                     ^
                                                     |
                                    The exon positions match except that refGene also 
                                    includes (presumably) noncoding transcribed sequence
                                    at both ends
                                                    


SELECT A RECORD FROM ccdsInfo TO GET A CCDS ID WITH A REFSEQ ID:

[syoung@u02 tables]$ head ccdsInfo.txt 

    CCDS10.1        H       ENST00000379268 ENSP00000368570
    CCDS10.1        N       NM_004195.2     NP_004186.1     <===== USE REFSEQ ID: NM_004195
    CCDS100.2       H       ENST00000377411 ENSP00000366628
    CCDS100.2       N       NM_024980.4     NP_079256.4
    CCDS1000.1      H       ENST00000368849 ENSP00000357842
    CCDS1000.1      N       NM_020127.2     NP_064512.1
    CCDS10000.1     H       ENST00000339418 ENSP00000339175
    CCDS10000.1     H       ENST00000392568 ENSP00000376349
    CCDS10000.1     N       NM_177533.3     NP_803877.2
    CCDS10000.1     H       OTTHUMT00000074545      OTTHUMP00000163909


[syoung@u02 tables]$ grep NM_004195.2 snp130CodingDbSnp.txt

    593     chr1    1139415 1139415 rs11466694      NM_004195       2       2      8,42,    G,A,    CGA,CAA,        R,Q,
    593     chr1    1141823 1141823 rs11466676      NM_004195       2       2      8,42,    C,G,    ACG,AGG,        T,R,


ccdsGene CONTAINS EXON POSITIONS:

grep "CCDS10.1" ccdsGene.txt

    593     CCDS10.1        chr1    -       1139223 1141951 1139223 1141951 5           1139223,1139413,1139778,1140749,1141764,        1139348,1139616,1139866,1140872,1141951,        0               cmpl    cmpl    1,2,1,1,0,


refGene ALSO CONTAINS EXON POSITIONS:

grep NM_004195 refGene.txt

    593     NM_004195       chr1    -       1138888 1142089 1139223 1141951 5      1138888,1139413,1139778,1140749,1141764, 1139348,1139616,1139866,1140872,1142089 TNFRSF18 cmpl    cmpl    1,2,1,1,0,


    **NOTICE** DISAGREEMENT IN START OF FIRST EXON BUT AGREEMENT AFTERWARDS, THEN AN ADDITIONAL EXON IN THE REFSEQ ENTRY:
    
                    START       STOP
    CCDS STOP:      1139223     1141951        <=== TAKE THE CCDS FOR 'EXONIC' TEST
    REFSEQ STOP:    1138888     1142089
    
    ASSUMPTION: THE OVERALL AGREEMENT MEANS THE FRAMES ARE THE SAME (CHECK LATER)


    CONCLUSION: USE THE snp130CodingDbSnp TABLE peptide FIELD AND THE snp130 TABLE func FIELD TO VERIFY MISSENSE/SYNONYMOUS CALLS BASED ON EXONIC POSITION TRANSLATED TO FRAME POSITION 
    
    585     chr1    69551   69551   rs55874132      NM_001005484    3       2      8,3,    G,C,    GCG,GCC,        A,A,
    


snp130 CONTAINS THE SAME SNP INFO INCLUDING missense/exact INFO:

grep -n rs55874132 snp130.txt

    585        chr1    69551   69552   rs55874132      0       +       G       G       C/G     genomic       single  unknown 0       0       coding-synon    exact   1


grep rs11466694 snp130.txt

    593     chr1    1139415 1139416 rs11466694      0       -       C       C      A/G      genomic single  unknown 0.021503        0.101435        intron,missense exact    1




[syoung@u02 tables]$ head ccdsGene.txt 
585     CCDS30547.1     chr1    +       69090   70008   69090   70008   1      69090,   70008,  0               cmpl    cmpl    0,
587     CCDS41220.1     chr1    +       367658  368597  367658  368597  1      367658,  368597, 0               cmpl    cmpl    0,
589     CCDS41221.1     chr1    -       621095  622034  621095  622034  1      621095,  622034, 0               cmpl    cmpl    0,
591     CCDS2.2 chr1    +       861321  879533  861321  879533  13      861321,865534,866418,871151,874419,874654,876523,877515,877789,877938,878632,879077,879287,     861393,865716,866469,871276,874509,874840,876686,877631,877868,878438,878757,879188,879533,     0               cmpl    cmpl    0,0,2,2,1,1,1,2,1,2,1,0,0,
591     CCDS3.1 chr1    -       880073  894620  880073  894620  19      880073,880436,880897,881552,881781,883510,883869,886506,887379,887791,888554,889161,889383,891302,891474,892273,892478,894308,894594,   880180,880526,881033,881666,881925,883612,883983,886618,887519,887980,888668,889272,889462,891393,891595,892405,892653,894461,894620,   0               cmpl    cmpl    1,1,0,0,0,0,0,2,0,0,0,0,2,1,0,0,2,2,0,
591     CCDS30550.1     chr1    +       896073  900571  896073  900571  12     896073,896672,897008,897205,897734,898083,898488,898716,899299,899486,899728,900342,     896180,896932,897130,897427,897851,898297,898633,898884,899388,899560,899910,900571,    0               cmpl    cmpl    0,2,1,0,0,0,1,2,2,1,0,2,
591     CCDS4.1 chr1    +       901911  909955  901911  909955  16      901911,902083,905656,905900,906065,906258,906492,906703,907454,907667,908240,908565,908879,909212,909695,909821,        901994,902183,905803,905981,906138,906386,906588,906784,907530,907804,908390,908706,909020,909431,909744,909955,        0      cmpl     cmpl    0,2,0,0,0,1,0,0,0,1,0,0,0,0,0,1,
592     CCDS44034.1     chr1    -       934438  935353  934438  935353  3      934438,934905,935071,    934812,934993,935353,   0               cmpl    cmpl   1,0,0,
592     CCDS5.1 chr1    -       934438  935353  934438  935353  4       934438,934905,935071,935245,    934812,934993,935167,935353,    0               cmpl   cmpl     1,0,0,0,
592     CCDS6.1 chr1    +       948953  949858  948953  949858  2       948953,949363,  948956,949858,  0               cmpl    cmpl    0,0,
[syoung@u02 tables]$ mv ccdsInfo.txt ccdsInfo.txt.gz
[syoung@u02 tables]$ gunzip ccdsInfo.txt.gz 
[syoung@u02 tables]$ head ccdsInfo.txt 
CCDS10.1        H       ENST00000379268 ENSP00000368570
CCDS10.1        N       NM_004195.2     NP_004186.1
CCDS100.2       H       ENST00000377411 ENSP00000366628
CCDS100.2       N       NM_024980.4     NP_079256.4
CCDS1000.1      H       ENST00000368849 ENSP00000357842
CCDS1000.1      N       NM_020127.2     NP_064512.1
CCDS10000.1     H       ENST00000339418 ENSP00000339175
CCDS10000.1     H       ENST00000392568 ENSP00000376349
CCDS10000.1     N       NM_177533.3     NP_803877.2
CCDS10000.1     H       OTTHUMT00000074545      OTTHUMP00000163909

[syoung@u02 tables]$ grep NM_004195.2 snp130CodingDbSnp.txt
593     chr1    1139415 1139415 rs11466694      NM_004195       2       2      8,42,    G,A,    CGA,CAA,        R,Q,
593     chr1    1141823 1141823 rs11466676      NM_004195       2       2      8,42,    C,G,    ACG,AGG,        T,R,




DOWNLOADED TO PEGASUS
==========================


FROM NCBI FTP SITE
ftp://ftp.ncbi.nih.gov/refseq/H_sapiens/RefSeqGene/


REFSEQ 
March 17, 2010: RefSeq Release 40 
ftp://ftp.ncbi.nih.gov/refseq/release/

cd /nethome/bioinfo/data/sequence/genes/refseq/human/40

wget -c ftp://ftp.ncbi.nih.gov/refseq/H_sapiens/RefSeqGene/refseqgene.genomic.fna.gz
wget -c ftp://ftp.ncbi.nih.gov/refseq/H_sapiens/RefSeqGene/refseqgene.genomic.gbff.gz

head refseqgene.genomic.fna 

    >gi|239582715|ref|NG_012280.1| Homo sapiens colony stimulating factor 2 receptor, alpha, low-affinity (granulocyte-macrophage) (CSF2RA) on chromosome X Y
    ACAGTGCCAGTTCCAGCAGCCTTGGTGAACCGTCTGGTTGAGCTCTTGGGAAGATAAACTTCTCTACATCAATGTCAAAA
    GGAAGATATGAGCCTTTGACAAGAATATCCACCATGATGCCCAGTTCCAGCAGCCTGGGTGAGCCATCTGGTTGAGCTCT
    TGGGAAGATAAACTTCTCTACATCAATGTCAACAAGAAGATATGAGCCTTTGACAAAAAGATCCACCATGATGCCCAGTT
    CCAGCAGCCTGGGTGAGCCATCTGGTTGAGCTCTTGGGAAGATAAACTTCTCTACATCAATGTCAACAAGAAGATATGAG
    CCTTTGACAAAAAGATCCACCGTGATGCCCAGTTCCAGCAGCCTGGCTGAGCCATCTGGTTGAGCTCTTGGGAAGATAAG
    CTTCTCTACATCAATGTCAACAAGAAGATATGAGCCTTTGACAAAAAGATCCACCGTGATGCCCAGTTCCAGCAGCCTGG
    CTGAGCCATCTGGTTGAGCTCTTGGGAAGATAAACTTCTCTACATCAATGTCAACAAGAAGATATGAGCCTTTGACAAAA
    AGATCCACCATGATGCCCAGTTCCAGCAGCCTGGCTGAGCCATCTGGTTGAGCTCTTGGGAAGATAAACTTCTCTACATC
    AATGTCAACAAGAAGATATGAGCCTTTGACAAAAAGATCCACCATGATGCCCAGTTCCAGCAGCCTGGCTGAGCCATCTG


LOCATION OF REFSEQ 40:

/nethome/bioinfo/data/sequence/genes/human/refseq/40/refseqgene.genomic.fna



FROM UCSC DOWNLOAD (HTTP) SITE

http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/

CCDS

cd /nethome/syoung/base/pipeline/snpfilter/tables
wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/ccdsGene.sql
wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/ccdsGene.txt

REFSEQ

cd /nethome/syoung/base/pipeline/snpfilter/tables
wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/refGene.sql
wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/refGene.txt


CODING SEQUENCE dbSNPs

cd /nethome/syoung/base/pipeline/snpfilter/tables
wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/snp130CodingDbSnp.sql  
wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/snp130CodingDbSnp.txt.gz

#### WGET STALLS
#### SO HAD TO DOWNLOAD WITH FIREFOX ONTO hplaptop AND SSH OVER TO PEGASUS
####wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/snp130.sql
####wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/snp130.txt.gz  
####wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/snp130Seq.sql
####wget http://hgdownload.cse.ucsc.edu/goldenPath/hg19/database/snp130Seq.txt.gz   


Schema for snp130CodingDbSnp

Database: hg19    Primary Table: snp130CodingDbSnp    Row Count: 198,493

    Format description: Annotations of the effects of SNPs on translated protein sequence.
    field	example	SQL type	info	description
    bin	585	smallint(6)	range	Indexing field to speed chromosome range queries.
    chrom	chr1	varchar(255)	values	Reference sequence chromosome or scaffold
    chromStart	69551	int(10) unsigned	range	Start position in chromosome
    chromEnd	69551	int(10) unsigned	range	End position in chromosome
    name	rs55874132	varchar(255)	values	Reference SNP identifier
    transcript	NM_001005484	varchar(255)	values	Accession of the transcript modified by SNP
    frame	3	enum('1','2','3')	values	Frame of transcript's codon modified by SNP
    alleleCount	2	int(11)	range	Number of annotated alleles for SNP
    funcCodes	8,3,	longblob	 	dbSNP function codes (e.g. 42=missense)
    alleles	G,C,	longblob	 	Observed nucleotide alleles corresponding to funcCodes
    codons	GCG,GCC,	longblob	 	Codons corresponding to funcCodes
    peptides	A,A,	longblob	 	Amino acid sequence corresponding to funcCodes
    
    Connected Tables and Joining Fields

        hg19.gwasCatalog.name (via snp130CodingDbSnp.name)
        hg19.snp130.name (via snp130CodingDbSnp.name)
        hg19.snp130Exceptions.name (via snp130CodingDbSnp.name)
        hg19.snp130OrthoPt2Pa2Rm2.name (via snp130CodingDbSnp.name)
        hg19.snp130Seq.acc (via snp130CodingDbSnp.name)
    
    Sample Rows
        
    bin	chrom	chromStart	chromEnd	name	transcript	frame	alleleCount	funcCodes	alleles	codons	peptides
    585	chr1	69551	69551	rs55874132	NM_001005484	3	2	8,3,	G,C,	GCG,GCC,	A,A,
    585	chr1	88168	88168	rs940550	XM_001724183	2	2	8,42,	C,T,	GCC,GTC,	A,V,
    585	chr1	88171	88171	rs940551	XM_001724183	2	2	8,42,	G,A,	CGT,CAT,	R,H,
    585	chr1	88215	88215	rs2103136	XM_001724183	1	2	8,42,	A,G,	ATC,GTC,	I,V,
    585	chr1	88264	88264	rs940552	XM_001724183	2	2	8,42,	C,T,	TCT,TTT,	S,F,
    585	chr1	88337	88337	rs55700207	XM_001724183	3	2	8,3,	G,A,	GAG,GAA,	E,E,
    590	chr1	753404	753404	rs61770173	XM_001724496	3	2	8,3,	G,T,	CCG,CCT,	P,P,
    590	chr1	753424	753424	rs3131970	XM_001724496	1	2	8,42,	A,G,	ACA,GCA,	T,A,
    590	chr1	753473	753473	rs2073814	XM_001724496	3	2	8,3,	G,C,	CTG,CTC,	L,L,
    591	chr1	856040	856040	rs61769717	XM_001724524	3	2	8,3,	C,T,	CGC,CGT,	R,R,





NOTES
=====


MAPPING OF CCDS TO REFSEQ

http://blog.gmane.org/gmane.science.biology.ensembl.devel/month=20081101


Ewan Birney | 6 Nov 16:28
  
Re: Mapping Ensembl gene ids to Entrez gene?

The Xref mapping is now increasingly complex. In this case, we have
actually 3 levels of mapping I think - Glenn and Ian to correct me:

   1. If the Havana group has curated the link to HGNC and EntrezGene,
we inherit that - it overrides others

   2. If we have a CCDS match between Ensembl and NCBI, the RefSeq  
assignment
comes from the NCBI CCDS to RefSeq mapping

   3. Otherwise we do protein-level comparison

 From the RefSeq mapping (from the above mapping) we inhereit EntrezGene
mapping and, for HGNCs not assigned via method (1), HGNC mappings.

As (1) is 10,000 and growing, and (2) is 18,000 transcripts, 16,000  
genes
and growing, actually the method (3) is slowly being pushed out. 1 and 2
of course will handle complex situations far better, and also will be
inherently more stable.

Have I got this right Ian/Glenn?

We should update the language we use on the web site to describe
all of this.

On 6 Nov 2008, at 14:27, Stefan Kirov wrote:

> This actually brings a question I have on the EG-ENS mapping. Why go
(Continue reading)




NBCI Cancer Genome Workbench (CGWB) - View Cancer Genomic Data

Schema for SNPs (129) - Simple Nucleotide Polymorphisms (dbSNP build 129)
  
https://cgwb.nci.nih.gov/cgi-bin/hgTables?db=hg18&hgta_group=varRep&hgta_track=snp129&hgta_table=snp129&hgta_doSchema=describe+table+schema




Interpreting and Configuring the Graphical Display

Variants are shown as single tick marks at most zoom levels. When viewing the track at or near base-level resolution, the displayed width of the SNP corresponds to the width of the variant in the reference sequence. Insertions are indicated by a single tick mark displayed between two nucleotides, single nucleotide polymorphisms are displayed as the width of a single base, and multiple nucleotide variants are represented by a block that spans two or more bases.

The configuration categories reflect the following definitions (not all categories apply to this assembly):

 Class: Describes the observed alleles
Single - single nucleotide variation: all observed alleles are single nucleotides (can have 2, 3 or 4 alleles)
In-del - insertion/deletion
Heterozygous - heterozygous (undetermined) variation: allele contains string '(heterozygous)'
Microsatellite - the observed allele from dbSNP is variation in counts of short tandem repeats
Named - the observed allele from dbSNP is given as a text name
No Variation - no variation asserted for sequence
Mixed - the cluster contains submissions from multiple classes
Multiple Nucleotide Polymorphism - alleles of the same length, length > 1, and from set of {A,T,C,G}
Insertion - the polymorphism is an insertion relative to the reference assembly
Deletion - the polymorphism is a deletion relative to the reference assembly
Unknown - no classification provided by data contributor
 Validation: Method used to validate the variant (each variant may be validated by more than one method)
By Frequency - at least one submitted SNP in cluster has frequency data submitted
By Cluster - cluster has at least 2 submissions, with at least one submission assayed with a non-computational method
By Submitter - at least one submitter SNP in cluster was validated by independent assay
By 2 Hit/2 Allele - all alleles have been observed in at least 2 chromosomes
By HapMap - validated by HapMap project
Unknown - no validation has been reported for this variant
 Function: Predicted functional role (each variant may have more than one functional role)
Locus Region - variation within 2000 bases of gene, but not in transcript (in build 127 and before, the keyword was locus, but since build 128, the more specific terms near-gene-3 and near-gene-5 are used)
Coding - Synonymous - no change in peptide for allele with respect to reference assembly (coding-synon)
Coding - Non-Synonymous - change in peptide for allele with respect to reference assembly (coding-nonsynon in build 127; nonsense, missense, frameshift since build 128)
Untranslated - variation in transcript, but not in coding region interval (untranslated in build 127; untranslated-3, untranslated-5 since build 128)
Intron - variation in intron, but not in first two or last two bases of intron
Splice Site - variation in first two or last two bases of intron (splice-site in build 127; splice-3, splice-5 since build 128)
Reference (coding) - allele observed in a coding region of the reference sequence (cds-reference)
Unknown - no known functional classification
 Molecule Type: Sample used to find this variant
Note: the dbSNP release 129 fasta headers have swapped values: "genomic" for "cDNA" SNPs and vice versa. UCSC has swapped them back, so the displayed molecule type should be correct but might disagree with files downloaded from dbSNP.
Genomic - variant discovered using a genomic template
cDNA - variant discovered using a cDNA template
Unknown - sample type not known
 Average heterozygosity: Calculated by dbSNP as described here
Average heterozygosity should not exceed 0.5 for bi-allelic single-base substitutions.
 Weight: Alignment quality assigned by dbSNP
Weight can be 0, 1, 2, 3 or 10.
Weight = 1 are the highest quality alignments.
Weight = 0 and weight = 10 are excluded from the data set.
A filter on maximum weight value is supported, which defaults to 3.
Insertions/Deletions

dbSNP uses a class called 'in-del'. We compare the length of the reference allele to the length(s) of observed alleles; if the reference allele is shorter than all other observed alleles, we change 'in-del' to 'insertion'. Likewise, if the reference allele is longer than all other observed alleles, we change 'in-del' to 'deletion'.

UCSC Annotations

UCSC checks for several unusual conditions that may indicate a problem with the mapping, and reports them in the Annotations section if found:

The dbSNP reference allele is not the same as the UCSC reference allele, i.e. the bases in the mapped position range.
Class is single, in-del, mnp or mixed and the UCSC reference allele does not match any observed allele.
In NCBI's alignment of flanking sequences to the genome, part of the flanking sequence around the SNP does not align to the genome.
Class is single, but the size of the mapped SNP is not one base.
Class is named and indicates an insertion or deletion, but the size of the mapped SNP implies otherwise.
Class is single and the format of observed alleles is unexpected.
The length of the observed allele(s) is not available because it is too long.
Multiple distinct insertion SNPs have been mapped to this location.
At least one observed allele contains an ambiguous IUPAC base (e.g. R, Y, N).
Another condition, which does not necessarily imply any problem, is noted:
Class is single and SNP is tri-allelic or quad-allelic.

UCSC Re-alignment of flanking sequences


dbSNP determines the genomic locations of SNPs by aligning their flanking sequences to the genome. UCSC displays SNPs in the locations determined by dbSNP, but does not have access to the alignments on which dbSNP based its mappings. Instead, UCSC re-aligns the flanking sequences to the neighboring genomic sequence for display on SNP details pages. While the recomputed alignments may differ from dbSNP's alignments, they often are informative when UCSC has annotated an unusual condition.

Data Sources

The data that comprise this track were extracted from database dump files and headers of fasta files downloaded from NCBI. The database dump files were downloaded from ftp://ftp.ncbi.nih.gov/snp/organisms/ organism_tax_id/database/ (e.g. for Human, organism_tax_id = human_9606). The fasta files were downloaded from ftp://ftp.ncbi.nih.gov/snp/organisms/ organism_tax_id/rs_fasta/

Coordinates, orientation, location type and dbSNP reference allele data were obtained from b129_SNPContigLoc_36_3.bcp.gz and b129_SNPContigInfo_36_3.bcp.gz.
b129_SNPMapInfo_36_3.bcp.gz provided the alignment weights.
Functional classification was obtained from b129_SNPContigLocusId_36_3.bcp.gz.
Validation status and heterozygosity were obtained from SNP.bcp.gz.
The header lines in the rs_fasta files were used for molecule type, class and observed polymorphism.



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Mon Mar 29 22:01:38 EDT 2010
HAPMAP SNP FILES AND GFF FILES FOR GBROWSE

1. DOWNLOADED chromosome Y FROM HAPMART

http://hapmap.ncbi.nlm.nih.gov/biomart/martview/73434557b807820267df04454e02633a

    chromosome
    position
    strand
    marker id
    population id
    alleles
    reference allele


ON pegasus:

head /nethome/syoung/base/pipeline/snpfilter/hapmap27-chrY.txt
    
    chromosome      position        strand  marker id       population id   alleles reference allele
    chrY    104742  +       rs6649873       1       G/T     T
    chrY    109805  +       rs6423165       1       A/G     A
    chrY    109922  +       rs6608381       1       C/T     T
    chrY    118624  +       rs6644972       1       A/G     G
    chrY    141935  +       rs6655397       1       A/G     G
    chrY    142439  +       rs6603172       1       C/T     T
    chrY    142664  +       rs6644970       1       A/G     G
    chrY    160116  +       rs1132353       1       C/T     T
    chrY    169118  +       rs35047434      1       C/T     T


1. DOWNLOADED DATA FROM NCBI

wget http://hapmap.ncbi.nlm.nih.gov/downloads/genotypes/latest_phaseIII_ncbi_b36/hapmap_format/consensus/genotypes_chr1_ASW_phase3.2_consensus.b36_fwd.txt.gz


head genotypes_chr1_ASW_phase3.2_consensus.b36_fwd.txt 
    rs# alleles chrom pos strand assembly# center protLSID assayLSID panelLSID QCcode NA19625 NA19700 NA19701 NA19702 NA19703 NA19704 NA19705 NA19708 NA19712 NA19711 NA19818 NA19819 NA19828 NA19835 NA19834 NA19836 NA19902 NA19901 NA19900 NA19904 NA19919 NA19908 NA19909 NA19914 NA19915 NA19916 NA19917 NA19918 NA19921 NA20129 NA19713 NA19982 NA19983 NA19714 NA19985 NA20128 NA20126 NA20127 NA20277 NA20276 NA20279 NA20282 NA20281 NA20284 NA20287 NA20288 NA20290 NA20289 NA20291 NA20292 NA20295 NA20294 NA20297 NA20300 NA20301 NA20302 NA20317 NA20319 NA20322 NA20333 NA20332 NA20335 NA20334 NA20337 NA20336 NA20340 NA20341 NA20343 NA20342 NA20344 NA20345 NA20346 NA20347 NA20348 NA20349 NA20350 NA20357 NA20356 NA20358 NA20359 NA20360 NA20363 NA20364
    rs10458597 C/T chr1 554484 + ncbi_b36 bbs urn:lsid:bbs.hapmap.org:Protocol:Phase3_Draft1:1 urn:lsid:bbs.hapmap.org:Assay:Phase3_Draft1_rs10458597:1 urn:lsid:dcc.hapmap.org:Panel:US_African-30-trios:3 QC+ CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC
    rs2185539 C/T chr1 556738 + ncbi_b36 bbs urn:lsid:bbs.hapmap.org:Protocol:Phase3_Draft1:1 urn:lsid:bbs.hapmap.org:Assay:Phase3_Draft1_rs2185539:1 urn:lsid:dcc.hapmap.org:Panel:US_African-30-trios:3 QC+ CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC CC





help@hapmap.org

http://hapmap.ncbi.nlm.nih.gov/downloads/genotypes/00README.txt
###-  HapMap individual genotypes -### 

This directory contains datafiles with genotypes on all SNPs
produced by HapMap genotyping centers, and more recently, other
independent sources, such as Affymetrix and Illumina, and submitted 
to the DCC. Genotypes correspond to the four HapMap populations: 
90 Caucasian individuals from 30 CEPH family trios, 90 individuals 
from 30 family trios from the Ibadan people (Nigeria, West Africa), 
and 90 unrelated individuals from Southeast Asia (45 Han Chinese from 
Beijin, and 45 Japanese from Tokyo).

See project website (http://www.hapmap.org) for further information 
on samples and overall scientific goals.

Data files are available for bulk download from this directory. Another 
way to retrieve data is to browse a genomic region in the GBrowse 
viewer on the project website (http://www.hapmap.org/cgi-perl/gbrowse)
and then use the SNP Genotype Data dumper plugin. A third way to download 
genotying data is to use the Genotype attributes page of the HapMart 
application at http://hapmart.hapmap.org/BioMart/martview

File format. In general, genotype files consists of tab-delimited text 
files with at least the following columns:

Col1: refSNP rs# identifier at the time of release (NB might merge 
      with another rs# in the future)
Col2: SNP alleles according to dbSNP
Col3: chromosome that SNP maps to 
Col4: chromosome position of SNP, in basepairs on reference sequence
Col5: strand of reference sequence that SNP maps to
Col6: version of reference sequence assembly
Col7: HapMap genotype center that produced the genotypes
Col8: LSID for HapMap protocol used for genotyping
Col9: LSID for HapMap assay used for genotyping
Col10: LSID for panel of individuals genotyped
Col11: QC-code, currently 'QC+' for all entries (for future use)
Col12 and on: observed genotypes of samples, one per column, sample 
identifiers in column headers (Coriell catalog numbers, example: 
NA10847). Duplicate samples have .dup suffix.








http://hapmap.ncbi.nlm.nih.gov/downloads/gbrowse/
http://hapmap.ncbi.nlm.nih.gov/downloads/gbrowse/latest/gff/

    Omim_jun07.gff.gz                                   23-Feb-2009 08:59  9.8K  
    chromInfo_hg18.gff.gz                               23-Feb-2009 08:59  634   
    ctgPos.gff.gz                                       23-Feb-2009 08:59  5.1K  
    cytoBand_hg18.gff.gz                                23-Feb-2009 08:59   11K  
    dbsnp_chimp_B36.gff.gz                              23-Feb-2009 08:59  139M  
    encodeRegions.gff.gz                                23-Feb-2009 08:59  716   
    ensembl_gene_B36.gff.gz                             23-Feb-2009 08:59  5.0M  
    final_DGV_hg18.gff.gz                               23-Feb-2009 08:59  146K  
    gt+allele_freqs_chr1_CEU_r24_nr.b36_fwd.gff.gz      23-Feb-2009 04:17   11M  
    gt+allele_freqs_chr1_CHB_r24_nr.b36_fwd.gff.gz      23-Feb-2009 04:17   11M  
    gt+allele_freqs_chr1_JPT+CHB_r24_nr.b36_fwd.gff.gz  23-Feb-2009 04:18   12M  
    gt+allele_freqs_chr1_JPT_r24_nr.b36_fwd.gff.gz      23-Feb-2009 04:17   11M  
    gt+allele_freqs_chr1_YRI_r24_nr.b36_fwd.gff.gz      23-Feb-2009 04:17   12M  
    gt+allele_freqs_chr2_CEU_r24_nr.b36_fwd.gff.gz      23-Feb-2009 04:26   12M  
    ...
    
   
http://hapmap.ncbi.nlm.nih.gov/downloads/gbrowse/2009-02_phaseII+III/gff/




++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Mon Mar 29 14:01:38 EDT 2010
RE-DOWNLOADED hg19


1. DOWNLOADED TO hg19.new

mkdir -p /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19.new
cd /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19.new
wget -c http://hgdownload.cse.ucsc.edu/goldenPath/hg19/chromosomes/chrY.fa.gz 
...
wget -c http://hgdownload.cse.ucsc.edu/goldenPath/hg19/chromosomes/chr1.fa.gz 

 llOK!

2. CHECK WITH diff SHOWS THAT NEWLY DOWNLOADED hg19 chrY IS VERY DIFFERENT TO
THE EXISTING 'hg19 chrY'
cd /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19.new


3. CHECK IF THE EXISTING 'hg19 chrY' IS IN REALITY hg18 chrY

mkdir -p /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg18
cd /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg18

wget http://hgdownload.cse.ucsc.edu/goldenPath/hg18/chromosomes/chrY.fa.gz 

YES!

    [syoung@u01 hg18]$ diff chrY.fa ../hg19/chrY.fa
    [syoung@u01 hg18]$
    
AND SAME FOR CHRX
 diff chrX.fa ../hg18/chrX.fa


NB: DOWNLOAD WITH rsync AND wget STALLED

cd /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg18
rsync -avzP rsync://hgdownload.cse.ucsc.edu/goldenPath/hg18/chromosomes/chrX.fa.gz .



SO RENAMED hg19 TO hg18 AND CREATED hg19 DIRECTORY (AND DOWNLOADED hg19 CHROMOSOMES)


THEN RERAN snpFinder.pl WITH REAL hg19/chrY.fa

cd /nethome/syoung/base/pipeline/snpfilter/snpfinder
chmod 755 /nethome/bioinfo/apps/agua/0.4/bin/apps/snpFinder.pl

/nethome/bioinfo/apps/agua/0.4/bin/apps/snpFinder.pl \
--inputfile /nethome/syoung/base/pipeline/snpfilter/snp130-chrY-intersect-CCDS.fa \
--referencefile /nethome/bioinfo/data/sequence/chromosomes/human-fa/hg19/chrY.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/snpfinder/snp130-chrY-vs-chrY


    Run time: 00:00:19
    Completed /nethome/bioinfo/apps/agua/0.4/bin/apps/snpFinder.pl
    11:05PM, 29 March 2010
    ****************************************
    
    
ll /nethome/syoung/base/pipeline/snpfilter/snpfinder/snp130-chrY-vs-chrY
    -rw-rw-rw- 1 syoung bioinfo 27K Mar 29 23:05 /nethome/syoung/base/pipeline/snpfilter/snpfinder/snp130-chrY-vs-chrY









If you plan to download a large file or multiple files from this 
directory, we recommend that you use ftp rather than downloading the 
files via our website. To do so, ftp to hgdownload.cse.ucsc.edu, then 
go to the directory goldenPath/hg19/chromosomes. To download multiple 
files, use the "mget" command:

    mget <filename1> <filename2> ...
    - or -
    mget -a (to download all the files in the directory)

Alternate methods to ftp access.
    
Using an rsync command to download the entire directory:
    rsync -avzP rsync://hgdownload.cse.ucsc.edu/goldenPath/hg19/chromosomes/ .
For a single file, e.g. chrM.fa.gz
    rsync -avzP rsync://hgdownload.cse.ucsc.edu/goldenPath/hg19/chromosomes/chrM.fa.gz .
    
Or with wget, all files:
    wget --timestamping 
        'ftp://hgdownload.cse.ucsc.edu/goldenPath/hg19/chromosomes/*'
With wget, a single file:
    wget --timestamping 
        'ftp://hgdownload.cse.ucsc.edu/goldenPath/hg19/chromosomes/chrM.fa.gz' 
        -O chrM.fa.gz
    



++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Sun Mar 28 23:55:00 EST 2010
CREATED snpFinder.pl TO VERIFY THE POSITIONS OF SNPS


mkdir -p /nethome/syoung/base/pipeline/snpfilter/snpfinder

cd /nethome/syoung/base/pipeline/snpfilter/snpfinder
chmod 755 /nethome/bioinfo/apps/agua/0.4/bin/apps/snpFinder.pl

/nethome/bioinfo/apps/agua/0.4/bin/apps/snpFinder.pl \
--inputfile /nethome/syoung/base/pipeline/snpfilter/snp130-chrY-intersect-CCDS.fa \
--referencefile /nethome/bioinfo/data/sequence/chromosomes/human-fa/chrY.fa \
--outputfile /nethome/syoung/base/pipeline/snpfilter/snpfinder/snp130-chrY-vs-chrY


MATCH POSITIONS AND dbSNP LOCATION DO NOT CONCUR.

E.G.:


hg19_snp130_rs2241625 range=chrY:4967162-4967182 5'pad=10 3'pad=10 strand=+ repeatMasking=none
ATCCAGTTGATGAAAGTAAGT
sequence ATCCAGTTGA.GAAAGTAAGT matches ATCCAGTTGATGAAAGTAAGT at position 5127725

getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/chrY.fa \
--start 4967152 \
--stop 4967172

cagggtgtgctgtcgcctaac




getbases.pl \
--inputfile /nethome/bioinfo/data/sequence/chromosomes/human-fa/chrY.fa \
--start 5127705 \
--stop 5127725

ATCCAGTTGATGAAAGTAAGT

STRANGE OUTPUT:


    
    
    $_: hg19_snp130_rs2524442 range=chrY:4925457-4925477 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    CTGACGTAGGCATAAACGGAG
    name: rs2524442
    chromosome: chrY
    start: 4925457
    stop: 4925477
    sequence: CTGACGTAGGCATAAACGGAG
    sequence: CTGACGTAGG.ATAAACGGAG
    sequence CTGACGTAGG.ATAAACGGAG matches CTGACGTAGGCATAAACGGAG at position 5085186
    $_: hg19_snp130_rs2563382 range=chrY:4966350-4966370 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    AGGATACCTATGTGATGAAAG
    name: rs2563382
    chromosome: chrY
    start: 4966350
    stop: 4966370
    sequence: AGGATACCTATGTGATGAAAG
    sequence: AGGATACCTA.GTGATGAAAG
    $_: hg19_snp130_rs2571659 range=chrY:4966416-4966436 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    TTTTGCAAGTAAGTGTTACTG
    name: rs2571659
    chromosome: chrY
    start: 4966416
    stop: 4966436
    sequence: TTTTGCAAGTAAGTGTTACTG
    sequence: TTTTGCAAGT.AGTGTTACTG
    sequence TTTTGCAAGT.AGTGTTACTG matches TTTTGCAAGTAAGTGTTACTG at position 5126964
    $_: hg19_snp130_rs6618811 range=chrY:4966579-4966599 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    CAGCAATCTAGTCTCCAACAT
    name: rs6618811
    chromosome: chrY
    start: 4966579
    stop: 4966599
    sequence: CAGCAATCTAGTCTCCAACAT
    sequence: CAGCAATCTA.TCTCCAACAT
    sequence CAGCAATCTA.TCTCCAACAT matches CAGCAATCTAGTCTCCAACAT at position 5127130
    $_: hg19_snp130_rs2563383 range=chrY:4966917-4966937 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    ATCATGAAATTCCTTTCAGAT
    name: rs2563383
    chromosome: chrY
    start: 4966917
    stop: 4966937
    sequence: ATCATGAAATTCCTTTCAGAT






++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Sun Mar 28 23:31:00 EST 2010
BLAT DOWNLOADED SNP130 AGAINST HG19 TO FIND REAL POSITIONS AND SEE IF THEY RECONCILE WITH GIVEN POSITIONS


ON PEGASUS


1. QUERY SEQUENCE IS CHROMOSOME Y, 10BP PADDED snp130 DOWNLOADED FROM UCSC

head /nethome/syoung/base/pipeline/snpfilter/snp130-chrY-intersect-CCDS.fa

    >hg19_snp130_rs9785927 range=chrY:150850-150870 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    CTCTGATGGGTGGGCAGGTGA
    >hg19_snp130_rs68110282 range=chrY:150850-150870 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    CTCTGATGGGTGGGCAGGTGA
    >hg19_snp130_rs73174495 range=chrY:157352-157372 5'pad=10 3'pad=10 strand=+ repeatMasking=none
    GGTACCTGGACCTGCGGATAG
    >hg19_snp130_rs11556996 range=chrY:157352-157372 5'pad=10 3'pad=10 strand=- repeatMasking=none
    CTATCCGCAGGTCCAGGTACC
    >hg19_snp130_rs35966551 range=chrY:157421-157440 5'pad=10 3'pad=10 strand=- repeatMasking=none
    CACCAGCGCCGTTGTGTACA


ll /nethome/syoung/base/pipeline/snpfilter/snp130-chrY-intersect-CCDS.fa

    -rw-r--r-- 1 syoung bioinfo 54K Mar 29 00:54 snp130-chrY-intersect-CCDS.fa

2. TARGET DATABASE IS hg19 CHROMOSOME Y

/nethome/bioinfo/data/sequence/chromosomes/human-fa/chrX.fa



3. BLAT FOR PERFECT HITS ONLY

1. RUN IN pipeline/snpfilter/blat

mkdir /nethome/syoung/base/pipeline/snpfilter/blat
cd /nethome/syoung/base/pipeline/snpfilter/blat


/nethome/syoung/base/apps/blat/34/blat \
/nethome/bioinfo/data/sequence/chromosomes/human-fa/chrY.fa \
/nethome/syoung/base/pipeline/snpfilter/snp130-chrY-intersect-CCDS.fa \
-fastMap \
-t=dna -q=dna -dots=100 \
-out=blast8 \
-minIdentity=99 \
-maxGap=0 \
/nethome/syoung/base/pipeline/snpfilter/blat/snp130-chrY-vs-chrY.v2

    Loaded 57772954 letters in 1 sequences
    ...Searched 26721 bases in 280 sequences



head /nethome/syoung/base/pipeline/snpfilter/blat/snp130-chrY-vs-chrY

    hg19_snp130_rs67739891  chrY    100.00  144     0       0       1       144     147425  147568  4.7e-78 288.0
    hg19_snp130_rs67739891  chrY    100.00  77      0       0       57      133     147543  147619  7.0e-38 155.0
    hg19_snp130_rs72571828  chrY    100.00  11225   0       0       1       11225   23739659        23750883        0.0e+00 21686.0
    hg19_snp130_rs72571828  chrY    99.90   10801   8       2       1       10801   23728814        23739611        0.0e+00 20809.0
    hg19_snp130_rs72571828  chrY    99.84   9562    11      4       1       9559    25404340        25394780        0.0e+00 18383.0
    hg19_snp130_rs72571828  chrY    99.87   6336    7       1       4891    11225   23785063        23778728        0.0e+00 12221.0
    hg19_snp130_rs72571828  chrY    99.86   5911    8       0       4891    10801   25410298        25404388        0.0e+00 11395.0
    hg19_snp130_rs72571828  chrY    99.85   5255    3       2       5547    10801   23723517        23728766        0.0e+00 10115.0
    hg19_snp130_rs72571828  chrY    99.83   4671    6       2       4891    9559    25358932        25363602        0.0e+00 8982.0
    hg19_snp130_rs72571828  chrY    99.82   1624    3       0       9602    11225   25363645        25365268        0.0e+00 3147.0



-out=type   Controls output file format.  Type is one of:

    psl - Default.  Tab separated format, no sequence
    pslx - Tab separated format with sequence
    axt - blastz-associated axt format
    maf - multiz-associated maf format
    sim4 - similar to sim4 format
    wublast - similar to wublast format
    blast - similar to NCBI blast format
    blast8- NCBI blast tabular format
    blast9 - NCBI blast tabular format with comments



OUTPUT RATHER STRANGE - MANY MISSING HITS, LARGE SNP SEGMENTS WITH MANY MULTIPLE HITS.

... SO CREATED snpFinder.pl ABOVE TO VERIFY THE POSITIONS OF SNPS






ALIGNMENT OUTPUT FILE FORMATS

http://genome.ucsc.edu/FAQ/FAQformat


PSL format	
 	
PSL lines represent alignments, and are typically taken from files generated by BLAT or psLayout. See the BLAT documentation for more details. All of the following fields are required on each data line within a PSL file:

matches - Number of bases that match that aren't repeats
misMatches - Number of bases that don't match
repMatches - Number of bases that match but are part of repeats
nCount - Number of 'N' bases
qNumInsert - Number of inserts in query
qBaseInsert - Number of bases inserted in query
tNumInsert - Number of inserts in target
tBaseInsert - Number of bases inserted in target
strand - '+' or '-' for query strand. For translated alignments, second '+'or '-' is for genomic strand
qName - Query sequence name
qSize - Query sequence size
qStart - Alignment start position in query
qEnd - Alignment end position in query
tName - Target sequence name
tSize - Target sequence size
tStart - Alignment start position in target
tEnd - Alignment end position in target
blockCount - Number of blocks in the alignment (a block contains no gaps)
blockSizes - Comma-separated list of sizes of each block
qStarts - Comma-separated list of starting positions of each block in query
tStarts - Comma-separated list of starting positions of each block in target
Example:
Here is an example of an annotation track in PSL format. Note that line breaks have been inserted into the PSL lines in this example for documentation display purposes. Click here for a copy of this example that can be pasted into the browser without editing.

track name=fishBlats description="Fish BLAT" useScore=1
59 9 0 0 1 823 1 96 +- FS_CONTIG_48080_1 1955 171 1062 chr22
    47748585 13073589 13073753 2 48,20,  171,1042,  34674832,34674976,
59 7 0 0 1 55 1 55 +- FS_CONTIG_26780_1 2825 2456 2577 chr22
    47748585 13073626 13073747 2 21,45,  2456,2532,  34674838,34674914,
59 7 0 0 1 55 1 55 -+ FS_CONTIG_26780_1 2825 2455 2676 chr22
    47748585 13073727 13073848 2 45,21,  249,349,  13073727,13073827,
Be aware that the coordinates for a negative strand in a PSL line are handled in a special way. In the qStart and qEnd fields, the coordinates indicate the position where the query matches from the point of view of the forward strand, even when the match is on the reverse strand. However, in the qStarts list, the coordinates are reversed.

Example:
Here is a 30-mer containing 2 blocks that align on the minus strand and 2 blocks that align on the plus strand (this sometimes can happen in response to assembly errors): 

0         1         2         3 tens position in query  
0123456789012345678901234567890 ones position in query   
            ++++          +++++ plus strand alignment on query   
    --------    ----------      minus strand alignment on query   

Plus strand:   
     qStart=12 
     qEnd=31 
     blockSizes=4,5 
     qStarts=12,26 
                  
Minus strand:   
     qStart=4 
     qEnd=26 
     blockSizes=10,8 
     qStarts=5,19   
Essentially, the minus strand blockSizes and qStarts are what you would get if you reverse-complemented the query. However, the qStart and qEnd are not reversed. To convert one to the other:
     qStart = qSize - revQEnd
     qEnd = qSize - revQStart


++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Fri Mar 26 23:21:00 EST 2010
TEST filterSNP.pm


QUERY
=====

1. CHROMOSOME Y MAQ SNP PREDICTIONS

chrY cns.snp RESULTS FOR 
/p/NGS/syoung/base/pipeline/run12+15/1.4.0/lane1/maq

    ...
    chrY    57765940        T       G       4       1       7.00    0       4       N       26      N
    chrY    57766137        C       T       4       1       7.00    0       4       N       26      N
    chrY    57766200        T       A       0       2       4.00    0       6       T       27      W
    chrY    57766493        A       G       4       1       3.00    0       4       N       26      N
    chrY    57766782        T       C       4       1       7.00    0       4       N       26      N
    chrY    57767087        G       C       4       1       0.00    0       0       N       26      N
    chrY    57767088        C       A       0       2       7.00    0       0       C       27      M
    chrY    57767114        C       G       3       7       7.00    0       18      C       26      S
    chrY    57767602        T       C       0       2       6.50    0       4       T       27      Y
    chrY    57768304        A       C       4       1       5.00    0       4       N       26      N


cd /p/NGS/syoung/base/pipeline/run12+15/1.4.0/lane1/maq
grep chrY cns.snp > scrollMatch-chrY-maq.txt
scp scrollMatch-chrY-maq.txt syoung@pegasus.ccs.miami.edu:/nethome/bioinfo/apps/agua/0.4/bin/apps/t/03-FileTools
syoung@pegasus.ccs.miami.edu's password: 

scrollMatch-chrY-maq.txt                                               100%  108KB 107.5KB/s   00:00

CREATED SHORT VERSION WITH 100 LINES:

scrollMatch-chrY-maq-100.txt



MAQ cns.snp FILE COLUMN HEADINGS

http://maq.sourceforge.net/maq-manpage.shtml


SEE ALSO NEXTGEN WIKI
CARDIAC VARIATION
MAQ coverage and SNP calls
http://gouda.ccs.miami.edu:8090/display/NextGen/Cardiac+variation

head scrollMatch-chrY-maq.txt

    chromosome	position	reference	consensus	phred	readdepth	coverage	maxmappingqual	minneighbourqual	LLRsecondarycalls	thirdbestcall
    
    chrY    108200  T       G       4       1       0.00    4       4       N26N
    chrY    108204  C       T       4       1       0.00    4       4       N26N
    chrY    108208  C       T       4       1       0.00    4       4       N26N
    chrY    118889  C       T       4       1       15.00   0       4       N26N
    chrY    156812  C       T       4       1       0.00    0       4       N26N
    chrY    156821  C       T       4       1       0.00    0       4       N26N
    chrY    158552  C       G       4       1       6.00    0       4       N26N
    chrY    165137  C       G       4       1       0.00    0       4       N26N
    chrY    165144  T       G       4       1       0.00    0       4       N26N
    chrY    165145  T       C       4       1       0.00    0       4       N26N


CREATED BY 

maq cns2snp in.cns > out.snp


Each line consists of chromosome, position, reference base, consensus base, Phred-like consensus quality, read depth, the average number of hits of reads covering this position, the highest mapping quality of the reads covering the position, the minimum consensus quality in the 3bp flanking regions at each side of the site (6bp in total), the second best call, log likelihood ratio of the second best and the third best call, and the third best call.

The 5th column is the key criterion when you judge the reliability of a SNP. However, as this quality is only calculated assuming site independency, you should also consider other columns to get more accurate SNP calls. Script command maq.pl SNPfilter is designed for this (see below).

The 7th column implies whether the site falls in a repetitive region. If no read covering the site can be mapped with high mapping quality, the flanking region is possibly repetitive or in the lack of good reads. A SNP at such site is usually not reliable.

The 8th column roughly gives the copy number of the flanking region in the reference genome. In most cases, this number approaches 1.00, which means the region is about unique. Sometimes you may see non-zero read depth but 0.00 at the 7th column. This indicates that all the reads covering the position have at least two mismatches. Maq only counts the number of 0- and 1-mismatch hits to the reference. This is due to a complex technical issue.

The 9th column gives the neighbouring quality. Filtering on this column is also required to get reliable SNPs. This idea is inspired by NQS, although NQS is initially designed for a single read instead of a consensus.




TARGET
======

DOWNLOADED snp130 FOR chrY FROM UCSC TO HERE:

head /nethome/bioinfo/apps/agua/0.4/bin/apps/t/03-FileTools/inputs/snp130-chrY 

    #bin    chrom   chromStart      chromEnd        name    score   strand  refNCBI refUCSC observed   molType  class   valid   avHet   avHetSE func    locType weight
    585     chrY    95387   95388   rs28377933      0       +       A       A       A/G     genomic single      unknown 0       0       unknown exact   3
    585     chrY    95444   95445   rs28422153      0       +       T       T       C/T     genomic single      unknown 0       0       unknown exact   3
    585     chrY    95980   95981   rs56098252      0       +       G       G       A/G     genomic single      unknown 0       0       unknown exact   3
    585     chrY    96881   96882   rs6608429       0       -       C       C       A/G     genomic single      by-cluster      0       0       unknown exact   3
    585     chrY    96892   96893   rs67781295      0       +       G       G       -/G     genomic deletion    unknown 0       0       unknown exact   3


dbSNP  TABLE

func FIELD
'unknown','coding-synon','intron','near-gene-3','near-gene-5','nonsense','missense','frameshift','untranslated-3','untranslated-5'

valid FIELD
'unknown','by-cluster','by-frequency','by-submitter','by-2hit-2allele','by-hapmap','by-1000genomes'


NB: AVERAGE HETEROZYGOSITY CALCULATED HERE
http://www.ncbi.nlm.nih.gov/SNP/Hetfreq.html








++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Tues Jan 6 23:04:24 EDT 2008
DOWNLOAD CCDS AND 1000 GENOMES SOLEXA DATA ONTO kronos

INDEX OF DATA

ftp://ftp-trace.ncbi.nih.gov/1000genomes/sequence_index.txt

PARSE OUT SOLEXA DATA AND USE DEEPVAC TO DOWNLOAD ALL SOLEXA FILES FROM 1000 GENOMES FTP ON kronos:

ftp://ftp-trace.ncbi.nih.gov/1000genomes/sequence_index.txt


./deepvac.pl --url ftp://ftp.ncbi.nlm.nih.gov/pub/CCDS/current_human/ --outputdir /home/syoung/base/pipeline/exome/ccds

    Run time: 00:06:51
    Completed ./deepvac.pl
    11:27PM, 6 January 2009
    ****************************************


GET CCDS SNPs

http://genome.ucsc.edu/cgi-bin/hgTables?hgsid=119033890&clade=mammal&org=Human&db=hg18&hgta_group=genes&hgta_track=ccdsGene&hgta_table=0&hgta_regionType=genome&position=chrX%3A151073054-151383976&hgta_outputType=primaryTable&hgta_outFileName=

